<%
  empty_mask_class = "cover-choose-image _empty_image_in_slide #{classes}"
  resized_width = ''
  resized_height = ''
  orientation = nil
  if image
    width = image.media_element.width
    height = image.media_element.height
    url = image.media_element.url
    mask = '_mask_y'
    style_negative = "top:#{image.alignment}px"
    style_positive = "top:#{-image.alignment}px"
    orientation = "height=\"#{resize_height(width, height, slide.kind)}\""
    if horizontal_mask?(width, height, slide.kind)
      mask = '_mask_x'
      style_negative = "left:#{image.alignment}px"
      style_positive = "left:#{-image.alignment}px"
      orientation = "width=\"#{resize_width(width, height, slide.kind)}\""
    end
  end
%>


<div id="media_element_<%= position %>_in_slide_<%= slide.id %>" class="_image_container_in_lesson_editor">
  
  <% if image %>
    <%= hidden_field_tag "media_element_align_#{position}", "#{image.alignment}", :class =>"media_element_align_#{position} _input_align" %>
    <%= hidden_field_tag "media_element_#{position}", image.media_element_id, :class => "media-tag-#{position} _input_image_id" %>
  <% else %>
    <%= hidden_field_tag "media_element_align_#{position}", "0", :class =>"media_element_align_#{position} _input_align" %>
    <%= hidden_field_tag "media_element_#{position}", "", :class => "media-tag-#{position} _input_image_id" %>
  <% end %>
  
  <div class="mask <%= slide.kind %>-p<%= position %> <%= mask %> _full_image_in_slide" style="display:<%= image.nil? ? 'none'.html_safe : 'block'.html_safe %>">
    <a class="show-gallery _show_image_gallery_in_lesson_editor" data-position="<%= position %>" style="<%= style_negative %>">
      <span class="rollover rollover-image _rollover" style="<%= style_positive %>">
        <span class="add-image"></span>
      </span>
      <img src="<%= url %>" class="_slide_image <%= slide.kind %>-p<%= position %>" <%= orientation.nil? ? '' : orientation.html_safe %>/>
    </a>
    <%= text_field_tag "caption_#{position}", (image.nil? ? '' : image.caption), :class => "caption", :placeholder => t('captions.image_caption_placeholder'), :maxlength => "60" %>
  </div>
  
  <div class="<%= empty_mask_class.html_safe %>" style="display:<%= image.nil? ? 'block'.html_safe : 'none'.html_safe %>">
    <a class="show-gallery _show_image_gallery_in_lesson_editor" data-position="<%= position %>"><%= image_tag "choose-image.png" %></a>
    <br/>
    <%= t('captions.choose_image') %>
  </div>
  
</div>
