<%
  resize = ''
  alignment = ''
  if image
    width = image.media_element.width
    height = image.media_element.height
    url = image.media_element.url
    orientation = 'vertical'
    alignment = "top:#{image.alignment}px"
    resize = "height=\"#{resize_height(width, height, slide.kind)}\""
    if is_horizontal?(width, height, slide.kind)
      orientation = 'horizontal'
      alignment = "left:#{image.alignment}px"
      resize = "width=\"#{resize_width(width, height, slide.kind)}\""
    end
  end
%>


<div id="media_element_<%= position %>_in_slide_<%= slide.id %>" class="image editable">
  
  <% if image %>
    <%= hidden_field_tag "media_element_align_#{position}", image.alignment.to_s, :class => 'align' %>
    <%= hidden_field_tag "media_element_#{position}", image.media_element_id, :class => 'image-id' %>
  <% else %>
    <%= hidden_field_tag "media_element_align_#{position}", '0', :class => 'align' %>
    <%= hidden_field_tag "media_element_#{position}", '', :class => 'image-id' %>
  <% end %>
  
  <div class="mask <%= orientation %> <%= image.nil? ? 'hidden' : 'visible' %>">
    <div class="alignable" style="<%= alignment %>" data-rolloverable="true">
      <img src="<%= url %>" <%= resize.html_safe %>/>
    </div>
    <span class="add hidden" data-position="<%= position %>" title="<%= t('titles.lesson_editor.change_image') %>"></span>
    <%= text_field_tag "caption_#{position}", ((image.nil? || image.caption.blank?) ? t('lesson_editor.placeholders.image_caption') : image.caption), :class => 'caption _lesson_editor_placeholder', :maxlength => t("language_parameters.slide.length_caption.#{slide.kind}"), :data => {:placeholder => (image.nil? || image.caption.blank?)} %>
  </div>
  
  <div class="empty-mask <%= image.nil? ? 'visible' : 'hidden' %>">
    <a class="add" data-position="<%= position %>"></a>
    <br/>
    <p class="lower"><%= t('lesson_editor.choose_image') %></p>
  </div>
  
</div>
