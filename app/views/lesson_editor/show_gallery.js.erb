var slideN = $(".slide-content.slide-<%=@slide.position %>").first();
slideN.children().hide(); 
slideN.prepend("<%= escape_javascript(render :partial => 'shared/image_gallery', :locals => {:kind_of => @kind_of }) %>");
slideN.siblings(".buttons").hide();
$("#slide-numbers").hide();

$("._close_image_gallery").click(function(e){
  e.preventDefault();
  $("#image-gallery").remove();
  $(".slide-content.slide-<%=@slide.position %>").children().show();
  $("#slide-numbers").show();
  $(".buttons").show();
});

$("._add_image_to_slide").click(function(e){
  e.preventDefault();
  $("#image-gallery").remove();
  var sld = $(".slide-content.slide-<%=@slide.position %>").first();
  sld.children().show();
  sld.find("input.media-tag-cover-<%= @img_position %>").val($(this).attr("data-param"));
  closePopUp('_gallery_img_expanded_'+$(this).attr("data-param"));
  sld.find("._cover_choose_image_<%=@img_position%>").replaceWith("<div class='mask _mask_x <%=@slide.kind%>-p<%=@img_position%>'><a href='/lesson_editor/show_gallery/<%= @slide.id %>?position=<%=@img_position%>' class='show-gallery' data-param='<%=@img_position%>' data-remote='true'><img src='http://lorempixel.com/1000/560/abstract/5<%=@img_position%>' alt='added-imgage' class='_slide_image <%=@slide.kind%>-p<%=@img_position%>' width='1100' /></a></div>");
  sld.find(".<%=@slide.kind%>-p<%=@img_position%>").parent("a").replaceWith("<a href='/lesson_editor/show_gallery/<%= @slide.id %>?position=<%=@img_position%>' class='show-gallery' data-param='<%=@img_position%>' data-remote='true'><img src='http://lorempixel.com/1000/560/abstract/<%=@img_position%>' alt='added-imgage' class='_slide_image <%=@slide.kind%>-p<%=@img_position%>' width='1100' /></a>")
  $("#slide-numbers").show();
  $(".buttons").show();
  masked = $("._mask_x a");
  masked.each(function(index) {
    makeDraggable($(masked[index]), "x");
  });
});

$("._add_video_to_slide").click(function(e){
  e.preventDefault();
  $("#image-gallery").remove();
  var sld = $(".slide-content.slide-<%=@slide.position %>").first();
  sld.children().show();
  sld.find("input.media-tag-cover-<%= @img_position %>").val($(this).attr("data-param"));
  closePopUp('_gallery_img_expanded_'+$(this).attr("data-param"));
  sld.find("._cover_choose_image_<%=@img_position%>").replaceWith("<a href='/lesson_editor/show_gallery/<%= @slide.id %>?kind_of=<%=@kind_of%>&position=<%=@img_position%>' class='show-gallery' data-param='<%=@img_position%>' data-remote='true'><span class='rollover rollover-video'></span><video id='video' class='_slide_image <%=@slide.kind%>-p<%=@img_position%>' src='http://slides.html5rocks.com/src/chrome_japan.mp4' controls></video></a>");
  sld.find(".<%=@slide.kind%>-p<%=@img_position%>").parent("a").replaceWith("<a href='/lesson_editor/show_gallery/<%= @slide.id %>?kind_of=<%=@kind_of%>&position=<%=@img_position%>' class='show-gallery' data-param='<%=@img_position%>' data-remote='true'><span class='rollover rollover-video'></span><video id='video' class='_slide_image <%=@slide.kind%>-p<%=@img_position%>' src='http://slides.html5rocks.com/src/chrome_japan.mp4' controls></video></a>")
  $("#slide-numbers").show();
  $(".buttons").show();
});

$("._add_audio_to_slide").click(function(e){
  e.preventDefault();
  $("#image-gallery").remove();
  var sld = $(".slide-content.slide-<%=@slide.position %>").first();
  sld.children().show();
  sld.find("input.media-tag-cover-<%= @img_position %>").val($(this).attr("data-param"));
  closePopUp('_gallery_img_expanded_'+$(this).attr("data-param"));
  sld.find("._cover_choose_image_<%=@img_position%>").replaceWith("<a href='/lesson_editor/show_gallery/<%= @slide.id %>?kind_of=<%=@kind_of%>&position=<%=@img_position%>' class='show-gallery' data-param='<%=@img_position%>' data-remote='true'><span class='rollover rollover-audio'></span><audio id='audio' class='_slide_image <%=@slide.kind%>-p<%=@img_position%>' src='http://slides.html5rocks.com/src/rushus-modal_blues.mp3' controls></audio></a>");
  sld.find(".<%=@slide.kind%>-p<%=@img_position%>").parent("a").replaceWith("<a href='/lesson_editor/show_gallery/<%= @slide.id %>?kind_of=<%=@kind_of%>&position=<%=@img_position%>' class='show-gallery' data-param='<%=@img_position%>' data-remote='true'><span class='rollover rollover-audio'></span><audio id='audio' class='_slide_image <%=@slide.kind%>-p<%=@img_position%>' src='http://slides.html5rocks.com/src/rushus-modal_blues.mp3' controls></audio></a>")
  $("#slide-numbers").show();
  $(".buttons").show();
});