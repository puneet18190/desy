var black_list = new Array();
<% already_reloaded = false %>
<% @mes.each do |me| %>
  <% if !already_reloaded %>
    var id = <%= me[:media_element_id] %>;
    var item = $('#gallery_<%= me[:type] %>_' + id);
    <% if !me[:ok] %>
      <% already_reloaded = true %>
      black_list.push(<%= me[:media_element_id] %>);
      if(item.length > 0) {
        // TODO loadder ricaricare la galleria! usando @videos e @audios, e svuotare tutte le funzionalit√† copiando da uploader.js
      }
    <% elsif me[:media_element].converted? %>
      black_list.push(<%= me[:media_element_id] %>);
      if(item.length > 0) {
        var to_be_replaced = '<%= j(render :partial => "galleries/thumbs/#{me[:media_element].sti_type.downcase}", :locals => {video => me[:media_element], :index => 1, :count => 6, :force_margin_top => false}) %>'
        var my_thumb_id = 'gallery_<%= me[:media_element].sti_type.downcase %>_<%= me[:media_element_id] %>';
        var my_thumb = $('#' + my_thumb_id);
        var with_margin_bottom = my_thumb.hasClass('_with_margin_bottom');
        var margin_top = my_thumb.css('margin-top');
        var margin_bottom = my_thumb.css('margin-bottom');
        my_thumb.replaceWith(to_be_replaced);
        $('#' + my_thumb_id).css('margin-top', margin_top).css('margin-bottom', margin_bottom);
        if(with_margin_bottom) {
          $('#' + my_thumb_id).addClass('_with_margin_bottom');
        } else {
          $('#' + my_thumb_id).removeClass('_with_margin_bottom');
        }
      }
    <% end %>
  <% end %>
<% end %>
$('#info_container').data('media-elements-not-anymore-in-conversion', black_list);
