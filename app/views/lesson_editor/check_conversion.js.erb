var black_list = new Array();
<% already_reloaded = false %>
<% @mes.each do |me| %>
  <% if !already_reloaded %>
    var id = <%= me[:media_element_id] %>;
    var my_thumb_id = 'gallery_<%= me[:media_element].sti_type.downcase %>_<%= me[:media_element_id] %>';
    var my_thumb = $('#' + my_thumb_id);
    <% if !me[:ok] %>
      <% already_reloaded = true %>
      black_list.push(<%= me[:media_element_id] %>);
      if(my_thumb.length > 0) {
        // TODO loadder ricaricare la galleria! usando @videos e @audios, e svuotare tutte le funzionalit√† copiando da uploader.js
      }
    <% elsif me[:media_element].converted? %>
      black_list.push(<%= me[:media_element_id] %>);
      <% if me[:media_element_id].sti_type == 'Video' %>
        <%
          locals = {
            :video            => me[:media_element],
            :index            => 1,
            :count            => 6,
            :force_margin_top => false
          }
        %>
        uploaderConversionChecker('video-true', '<%= j me[:media_element].title %>');
        if(my_thumb.length > 0) {
          var to_be_replaced = '<%= j(render :partial => "galleries/thumbs/#{me[:media_element].sti_type.downcase}", :locals => locals) %>';
          var with_margin_bottom = my_thumb.hasClass('_with_margin_bottom');
          var margin_top = my_thumb.css('margin-top');
          var margin_bottom = my_thumb.css('margin-bottom');
          my_thumb.replaceWith(to_be_replaced);
          $('#' + my_thumb_id).css('margin-top', margin_top).css('margin-bottom', margin_bottom);
          if(with_margin_bottom) {
            $('#' + my_thumb_id).addClass('_with_margin_bottom');
          }
          $('#' + my_thumb_id + ' ._select_video_from_gallery').addClass('_add_video_to_slide');
        }
      <% else %>
        <%
          locals = {
            :audio => me[:media_element],
            :index => 1
          }
        %>
        if(my_thumb.length > 0) {
          uploaderConversionChecker('audio-true', '<%= j me[:media_element].title %>');
          var margin_top = my_thumb.find('._compact').css('margin-top');
          my_thumb.replaceWith(to_be_replaced);
          $('#' + my_thumb_id + ' ._compact').css('margin-top', margin_top);
          $('#' + my_thumb_id + ' ._select_audio_from_gallery').addClass('_add_audio_to_slide');
        }
      <% end %>
    <% end %>
  <% end %>
<% end %>
$('#info_container').data('media-elements-not-anymore-in-conversion', black_list);
