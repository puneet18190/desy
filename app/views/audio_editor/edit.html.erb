<%= render :partial => 'audio_editor/header', :locals => {:parameters => @parameters} %>

<div id="audio_editor" class="mediaEditorAudioContainer">
  
  <%= render :partial => 'audio_editor/lateral_controls', :locals => {:parameters => @parameters} %>
  
  <%= form_tag audio_editor_save_cache_path, :id => 'audio_editor_form', :remote => true do %>
    <%= render :partial => 'media_elements/info_form_in_editor/new', :locals => {:sti_type => MediaElement::AUDIO_TYPE} %>
    <% if @parameters[:initial_audio] %>
      <%= render :partial => 'media_elements/info_form_in_editor/edit', :locals => {:media_element => @parameters[:initial_audio]} %>
    <% end %>
    <% if @parameters[:initial_audio] %>
      <%= hidden_field_tag 'initial_audio_id', @parameters[:initial_audio].id, :id => 'initial_audio_in_audio_editor_input' %>
    <% end %>
    <%= render :partial => 'audio_editor/timeline', :locals => {:components => @parameters[:components]} %>
  <% end %>
  
  <div class="addAudioandSave _audio_editor_bottom_bar">
    <div class="fltrt">
      <a id="commit_audio_editor" class="nextButton <%= @parameters[:initial_audio].nil? ? '' : '_with_choice'.html_safe %>" title="<%= t('general_titles.save_element_title') %>" style="visibility:<%= @parameters[:components].any? ? 'visible'.html_safe : 'hidden'.html_safe %>">
      </a>
    </div>
  </div>
  
</div>


<div id="empty_component_for_audio_editor" style="display:none">
  <%= render :partial => "audio_editor/component", :locals => {:component => {}, :identifier => 1, :empty => true} %>
</div>

<div id="audio_editor_gallery_container" style="display:none" data-loaded="false"></div>

<div id="info_container" data-last-component-id="<%= @parameters[:components].count %>" data-total-length="<%= @total_length %>" data-save-cache="false" data-cache-enabled-first-time="true" data-used-in-private-lessons="<%= @used_in_private_lessons %>" style="display:none"></div>


<script type="text/javascript">
  <% if @cache.nil? %>
    $(document).ready(function() {
      setTimeout(function() {
        if($('#info_container').data('cache-enabled-first-time')) {
          startCacheLoop();
        }
      }, $('#popup_parameters_container').data('cache-time'));
    });
  <% else %>
    showRestoreCacheMediaElementEditorPopUp(function() {
      window.location.href = '/audios/cache/restore'
    }, function() {
      closePopUp('dialog-restore-cache-media-element-editor');
      $.ajax({
        type: 'post',
        url: '/audios/cache/empty',
        success: function() {
          setTimeout(function() {
            if($('#info_container').data('cache-enabled-first-time')) {
              startCacheLoop();
            }
          }, $('#popup_parameters_container').data('cache-time'));
        }
      });
    });
  <% end %>
</script>
