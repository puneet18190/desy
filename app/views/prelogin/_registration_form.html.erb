<!-- TODO forrm rimuovi in seguito
  :forced_location => @forced_location,
  :locations       => @locations,
  :location_types  => @location_types,
  :errors          => @errors,
  :saas            => @saas,
  :school_levels   => @school_levels,
  :subjects        => @subjects,
  :trial           => @trial,
  :user            => @user
-->

<%= form_tag users_path, :method => :post, :id => 'official_registration_form', :autocomplete => 'off' do %>
  <% if saas %>
    <div id="registration-purchase-id" class="registration-element-container">
      <% if trial %>
        <%= t('registration.purchase_id') %><br/>
        <input id="registration_purchase_id" type="text" value="" name="purchase_id" disabled="disabled"/>
        <div class="validationOk fltlft" style="display:none" id="registration_ok">&#10004;</div>
        <br class="clearfloat"/>
        <%= t('registration.trial', :days => SETTINGS['saas_trial_duration']) %><br/>
        <input id="registration_trial" class="checked" type="checkbox" value="1" name="trial" checked="checked"/>
        <label for="registration_trial"></label>
      <% else %>
        <%= t('registration.purchase_id') %><br/>
        <input id="registration_purchase_id" type="text" value="" name="purchase_id"/>
        <div class="validationOk fltlft" style="display:none" id="registration_ok">&#10004;</div>
        <br class="clearfloat"/>
        <%= t('registration.trial', :days => SETTINGS['saas_trial_duration']) %><br/>
        <input id="registration_trial" class="checked" type="checkbox" value="1" name="trial"/>
        <label for="registration_trial"></label>
      <% end %>
      <br class="clearfloat"/>
      <ul class="profile-errors">
        <% errors[:purchase].each do |err| %>
          <li><%= err %></li>
        <% end %>
      </ul>
  <% end %>
  <div id="registration-general" class="registration-element-container">
    <div class="profile-element">
      <%= t('users.info.attributes.name') %><br/>
      <input type="text" value="<%= user.name %>" name="name" class="<%= user.errors.messages.has_key?(:name).to_s %>"/>
    </div>
    <div class="profile-element">
      <%= t('users.info.attributes.surname') %><br/>
      <input type="text" value="<%= user.surname %>" name="surname" class="<%= user.errors.messages.has_key?(:surname).to_s %>"/>
    </div>
    <div class="profile-element email">
      <%= t('users.info.attributes.email') %><br/>
      <input type="text" value="<%= user.email %>" disabled="disabled"/>
    </div>
    <br class="clearfloat"/>
    <div class="profile-element">
      <%= t('users.info.attributes.password') %><br/>
      <input type="password" name="password" class="<%= user.errors.messages.has_key?(:password).to_s %>"/>
    </div>
    <div class="profile-element">
      <%= t('users.info.attributes.password_confirmation') %><br/>
      <input type="password" name="password_confirmation" class="<%= user.errors.added?(:password, :confirmation).to_s %>"/>
    </div>
    <br class="clearfloat"/>
    <ul class="profile-errors">
      <% errors[:general].each do |err| %>
        <li><%= err %></li>
      <% end %>
    </ul>
  </div>
  <div id="registration-locations" class="registration-element-container">
    <% location_types.each_with_index do |location, index| %>
      <div id="<%= location.downcase %>_id" class="profile-element">
        <%
          locals_for_location = {
            :empty      => (index > 0 && locations[index - 1][:selected] != 0 && locations[index][:content].empty?),
            :forced     => (disabling ? forced_ancestors[index] : nil),
            :is_last    => (index == location_types.length - 1),
            :label      => Location.label_at(index),
            :label_plur => Location.label_at(index, true),
            :locations  => locations[index][:content],
            :selected   => locations[index][:selected],
            :type       => location.downcase
          }
        %>
        <%= render :partial => 'users/locations_list', :locals => locals_for_location %>
      </div>
      <% disabling = false if disabling && forced_location.sti_type == location %>
    <% end %>
    <% if forced_location && forced_location.sti_type == location_types.last %>
      <input type="hidden" value="<%= forced_location.id %>" name="location[<%= forced_location.sti_type.downcase %>]"/>
    <% end %>
    <% if saas %>
      <div id="outer_locations_disclaimer">
        <input id="locations_disclaimer" type="checkbox" value="0"/>
        <%= label_tag 'locations_disclaimer', '' %>
        <%= t('registration.locations_disclaimer', :location => Location.base_label.downcase) %>
      </div>
    <% end %>
  </div>
  <div id="registration-school-level" class="registration-element-container">
    <div class="profile-element">
      <%= t('users.info.attributes.school_level_id') %><br/>
      <select id="user_school_level_id" name="school_level_id">
        <% school_levels.each do |sl| %>
          <% if user.school_level_id == sl.id %>
            <option value="<%= sl.id %>" selected="selected"><%= sl.description %></option>
          <% else %>
            <option value="<%= sl.id %>"><%= sl.description %></option>
          <% end %>
        <% end %>
      </select>
    </div>
    <br class="clearfloat"/>
  </div>
  
  
  <!-- TODO forrm giunto qui -->
  
  
  <h2><%= t('registration.subjects.title') %></h2>
  
  <%
          my_style = ''
          other_label = t('users.subjects.no_cathegory')
          my_style = 'border-bottom:0' if @subjects.length == 1
          other_label = '' if @subjects.first[:label].blank?
        %>
        <fieldset class="inssert-content">
          <%= hidden_field_tag :in_subjects, true %>
          <% @subjects.each do |cathegory| %>
            <div class="cathegorySubjectContainer" style="<%= my_style %>">
              <div class="cathegorySubjectName">
                <%= cathegory[:label].present? ? cathegory[:label] : other_label %>
              </div>
              <% cathegory[:items].each do |subject| %>
                <% html_id = "users_subject_ids_#{subject.id}" %>
                <div class="checkboxElement">
                  <%= check_box_tag 'user[subject_ids][]', subject.id, @user.users_subjects.map(&:subject_id).include?(subject.id), id: html_id, class: 'regcular-checkbox bicg-checkbox' %>
                  <%= label_tag html_id, '', :class => 'unchecked' %>
                  <span><%= subject.to_s %></span>
                </div>
              <% end %>
              <br class="clearfloat">
              <% if !edit && cathegory[:label].present? %>
                <a class="checkAllSubjects"><%= t('registration.select_all_subjects') %></a>
              <% end %>
            </div>
  
  
  
  <hr>
  <div class="contentForm">
    <% user.registration_policies.each_with_index do |policy, index| %>
      <% my_policy = t('registration.policies')[index] %>
      <strong><%= my_policy['title'] %></strong><br><br>
      <div class="policy-verticalScroll">
        <%= my_policy['description'].html_safe %>
      </div>
      <div class="checkbox-csssontent"> <!-- TODO forrm pensaci tu -->
        <div class="checkboxElement">
          <table>
            <tr>
              <td>
                <%= f.hidden_field policy, value: '0', id: nil %>
                <%= check_box_tag "user[#{policy}]", '1', user.send(policy) == '1', class: 'regcular-checkbox' %>
                <%= label_tag "user[#{policy}]", '' %>
              </td>
              <td><%= my_policy['accept'] %></td>
            </tr>
          </table>
        </div>
      </div>
      <br class="clearfloat"><br><br>
    <% end %>
    <ul class="profile-errors">
      <% (errors.nil? ? [] : errors[:policies]).each do |err| %>
        <li><%= err %></li>
      <% end %>
    </ul>
    <%= f.submit t('registration.done') %>
  </div>
<% end %>
