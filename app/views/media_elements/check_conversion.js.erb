<% if @overall_ok %>
  
  $('#notifications_main').replaceWith('<%= j(render :partial => "notifications/main", :locals => {:notifications => @notifications, :news => @new_notifications, :offset => @offset_notifications, :tot => @tot_notifications}) %>');
  $('#notifications_list').jScrollPane({
    autoReinitialise: true
  });
  $('#tooltip_arancione').show();
  $('#notifications_button').addClass('current');
  
<% end %>


<% @mes.each do |me| %>

  var id = <%= me[:media_element_id] %>;
  var item = $('#expanded_media_element_' + id + ', #compact_media_element_' + id + ', #found_media_element_' + id);

  <% if !me[:ok] %>
    
    if(item.length > 0) {
      item.addClass('_locked');
      item.find('._expanded_media_element_internal_container').attr('title', 'TODO TODO TODO'); // TODO
      var destination = item.attr('id').split('_')[0];
      if(destination == 'expanded') {
        item.find('.thumbnail-container').html('<%= image_tag "unsuccess_conversion.gif" %>');
      } else if(destination == 'compact') {
        // TODO manca
      } else {
        // TODO manca
      }
    }
    
  <% elsif me[:media_element].converted? %>
    
    if(item.length > 0) {
      var destination = item.attr('id').split('_')[0];
      if(destination == 'expanded') {
        item.replaceWith('<%= j(render :partial => "media_elements/view_single_expanded", :locals => {:media_element => me[:media_element], :destination => ButtonDestinations::EXPANDED_MEDIA_ELEMENT}) %>');
      } else if(destination == 'compact') {
        item.replaceWith('<%= j(render :partial => "media_elements/view_single_compact", :locals => {:media_element => me[:media_element], :destination => ButtonDestinations::COMPACT_MEDIA_ELEMENT}) %>');
      } else {
        item.replaceWith('<%= j(render :partial => "media_elements/view_single_compact", :locals => {:media_element => me[:media_element], :destination => ButtonDestinations::FOUND_MEDIA_ELEMENT}) %>');
      }
    }
    
  <% end %>
  
<% end %>
