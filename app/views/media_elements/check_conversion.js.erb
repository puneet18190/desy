<% if @overall_ok %>
  
  $('#notifications_main').replaceWith('<%= j(render :partial => "notifications/main", :locals => {:notifications => @notifications, :news => @new_notifications, :offset => @offset_notifications, :tot => @tot_notifications}) %>');
  $('#notifications_list').jScrollPane({
    autoReinitialise: true
  });
  $('#tooltip_arancione').show();
  $('#notifications_button').addClass('current');
  
<% end %>


<% @mes.each do |me| %>

  var id = <%= me[:media_element_id] %>;
  var item = $('#expanded_media_element_' + id + ', #compact_media_element_' + id + ', #found_media_element_' + id);

  <% if !me[:ok] %>
    
    if(item.length > 0) {
      var destination = item.attr('id').split('_')[0] + '_media_element';
      var current_url = $('#info_container').data('currenturl');
      var redirect_url = addDeleteItemToCurrentUrl(current_url, (destination + '_' + id));
      $.ajax({
        type: 'post',
        dataType: 'json',
        url: '/media_elements/' + id + '/destroy/fake?destination=' + destination,
        success: function() {
          $('#info_container').data(('failed-conversion-' + id), true);
          $.ajax({
            type: 'get',
            url: redirect_url
          });
        }
      });
    }
    
  <% elsif me[:media_element].converted? %>
    
    if(item.length > 0) {
      var destination = item.attr('id').split('_')[0];
      if(destination == 'expanded') {
        item.replaceWith('<%= j(render :partial => "media_elements/view_single_expanded", :locals => {:media_element => me[:media_element], :destination => ButtonDestinations::EXPANDED_MEDIA_ELEMENT}) %>');
      } else if(destination == 'compact') {
        item.replaceWith('<%= j(render :partial => "media_elements/view_single_compact", :locals => {:media_element => me[:media_element], :destination => ButtonDestinations::COMPACT_MEDIA_ELEMENT}) %>');
      } else {
        item.replaceWith('<%= j(render :partial => "media_elements/view_single_compact", :locals => {:media_element => me[:media_element], :destination => ButtonDestinations::FOUND_MEDIA_ELEMENT}) %>');
      }
    }
    
  <% end %>
  
<% end %>
