<%
  class_current = '_lesson_viewer_current_slide'.html_safe
  style_current = "style=\"display:block\"".html_safe
  overall_counter = 1
%>

<div id="carousel_container">
  <div id='carousel_inner'>
    <ul id='carousel_ul'>
      <% slides.each do |slide| %>
        <%
          slide.text = '' if slide.text.blank?
          class_cover = slide.cover? ? "_cover_bookmark_for_lesson_viewer_#{slide.lesson_id}".html_safe : ''
          loaded = (overall_counter == 1)
        %>
        <li id="slide_in_lesson_viewer_<%= overall_counter %>" class="_slide_in_lesson_viewer cover slide <%= class_current %> <%= class_cover %>" data-overall-counter="<%= overall_counter %>" data-lesson-id="<%= slide.lesson_id %>" data-loaded="<%= loaded %>" <%= style_current %>>
          <% if loaded %>
            <%= render :partial => "lesson_viewer/slides/#{slide.kind}", :locals => {:slide => slide} %>
          <% else %>
            <%= render :partial => 'lesson_viewer/slides/loading' %>
          <% end %>
        </li>
        <%
          class_current = ''
          style_current = "style=\"display:none\"".html_safe
          overall_counter += 1
        %>
      <% end %>
    </ul>
  </div>
</div>

<a class="esciButton fltrt" title="<%= t('titles.exit') %>" href="#" style="margin-top:20px; display:none"></a>

<% if @with_exit %>
  <script type="text/javascript" charset="utf-8">
    var bb = $('.esciButton');
    <% if @is_back %>
      bb.attr('href', '<%= @back %>');
    <% else %>
      bb.attr('href', 'javascript:history.back()');
    <% end %>
    bb.show();
  </script>
<% end %>
