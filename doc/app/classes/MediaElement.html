<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>MediaElement</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            MediaElement 
            
                <span class="parent">&lt; 
                    
                    ActiveRecord::Base
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/app/models/media_element_rb.html">app/models/media_element.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h2 id="label-Description">Description</h2>

<p>ActiveRecord class that corresponds to the table
<code>media_elements</code>; this model has single table inheritance on the
field <code>sti_type</code> (see the models <a href="Image.html">Image</a>,
<a href="Audio.html">Audio</a> and <a href="Video.html">Video</a>). Audios
and videos have shared behaviours, defined in <a
href="Media/Shared.html">Media::Shared</a>.</p>

<h2 id="label-Fields">Fields</h2>
<ul><li>
<p><strong>user_id</strong>: reference to the <a href="User.html">User</a> who
created the element</p>
</li><li>
<p><strong>sti_type</strong>: single table iheritance representing the media
type</p>
</li><li>
<p><strong>media</strong>: attached audio, video or image</p>
</li><li>
<p><strong>title</strong>: title</p>
</li><li>
<p><strong>description</strong>: description</p>
</li><li>
<p><strong>metadata</strong>: can contain different keys, depending on
<code>sti_type</code></p>
<ul><li>
<p><strong>audio</strong></p>
<ul><li>
<p><code>creation_mode</code>: it can be <strong>uploaded</strong> (if the
element was originally uploaded), or <strong>composed</strong> (if it was
created inside the application using other elements)</p>
</li><li>
<p><code>m4a_duration</code>: the float duration of the m4a attached file</p>
</li><li>
<p><code>ogg_duration</code>: the float duration of the ogg attached file</p>
</li></ul>
</li><li>
<p><strong>image</strong></p>
<ul><li>
<p><code>width</code>: width of the original image</p>
</li><li>
<p><code>height</code>: height of the original image</p>
</li></ul>
</li><li>
<p><strong>video</strong></p>
<ul><li>
<p><code>creation_mode</code>: it can be <strong>uploaded</strong> (if the
element was originally uploaded), or <strong>composed</strong> (if it was
created inside the application using other elements)</p>
</li><li>
<p><code>mp4_duration</code>: the float duration of the mp4 attached file</p>
</li><li>
<p><code>webm_duration</code>: the float duration of the webm attached file</p>
</li></ul>
</li></ul>
</li><li>
<p><strong>converted</strong>: always <code>true</code> for <a
href="Image.html">Image</a>; for <a href="Video.html">Video</a> and <a
href="Audio.html">Audio</a> it is <code>false</code> if the media element
is not available</p>
</li><li>
<p><strong>is_public</strong>: if <code>true</code>, the element is contained
in the public database of the application</p>
</li><li>
<p><strong>publication_date</strong>: if <code>is_public</code> is
<code>true</code>, this is the date in which the element has been published
(once it&#39;s published it can&#39;t be turned back into private)</p>
</li></ul>

<h2 id="label-Associations">Associations</h2>
<ul><li>
<p><strong>bookmarks</strong>: links created by other users to this element
(see <a href="Bookmark.html">Bookmark</a>) (<strong>has_many</strong>)</p>
</li><li>
<p><strong>media_elements_slides</strong>: all the instances of this element
(see <a href="MediaElementsSlide.html">MediaElementsSlide</a>)
(<strong>has_many</strong>)</p>
</li><li>
<p><strong>reports</strong>: reports on the element (see <a
href="Report.html">Report</a>) (<strong>has_many</strong>)</p>
</li><li>
<p><strong>taggings</strong>: tags associated to the element (see <a
href="Tagging.html">Tagging</a>, <a href="Tag.html">Tag</a>)
(<strong>has_many</strong>)</p>
</li><li>
<p><strong>taggings_tags</strong>: link to the objects of type <a
href="Tag.html">Tag</a>, through the association <code>taggings</code>
(<strong>has_many</strong>)</p>
</li><li>
<p><strong>user</strong>: the <a href="User.html">User</a> who created the
element (<strong>belongs_to</strong>)</p>
</li></ul>

<h2 id="label-Validations">Validations</h2>
<ul><li>
<p><strong>presence</strong> with numericality &gt; 0 and presence of
associated object for <code>user_id</code></p>
</li><li>
<p><strong>presence</strong> of <code>title</code> and
<code>description</code></p>
</li><li>
<p><strong>inclusion</strong> of <code>is_public</code> in [<code>true</code>,
<code>false</code>]</p>
</li><li>
<p><strong>inclusion</strong> of <code>sti_type</code> in
[&#39;<code>Audio</code>&#39;, &#39;<code>Image</code>&#39;,
&#39;<code>Video</code>&#39;] (these three values correspond to an
<strong>enum</strong> defined in postgresql)</p>
</li><li>
<p><strong>length</strong> of <code>title</code> (maximum configured in the
translation file; if the value is greater than 255 it&#39;s set to 255)</p>
</li><li>
<p><strong>length</strong> of <code>description</code> (maximum configured in
the translation file)</p>
</li><li>
<p><strong>presence</strong> of <code>media</code>; <strong>this validation is
skipped if the element is of type <a href="Video.html">Video</a> or <a
href="Audio.html">Audio</a>, and if the element is being composed</strong>:
in fact, in this case there is not yet a media to be attached (unlike when
the element is uploaded, because when it&#39;s uploaded there exists a
media file but it&#39;s not yet converted)</p>
</li><li>
<p><strong>if</strong> <strong>the</strong> <strong>element</strong>
<strong>is</strong> <strong>public</strong>, <code>publication_date</code>
can&#39;t be null, whereas if it&#39;s private it must be null</p>
</li><li>
<p><strong>the</strong> <strong>element</strong> <strong>cannot</strong>
<strong>be</strong> <strong>public</strong> if new record. <strong>This
validation is not fired if <a
href="MediaElement.html#attribute-i-skip_public_validations">#skip_public_validations</a>
is <code>true</code></strong></p>
</li><li>
<p><strong>if</strong> <strong>the</strong> <strong>element</strong>
<strong>is</strong> <strong>public</strong>, the fields <code>media</code>,
<code>title</code>, <code>description</code>, <code>is_public</code>,
<code>publication_date</code> can&#39;t be changed anymore. <strong>This
validation is not fired if <a
href="MediaElement.html#attribute-i-skip_public_validations">#skip_public_validations</a>
is <code>true</code></strong></p>
</li><li>
<p><strong>if</strong> <strong>the</strong> <strong>element</strong>
<strong>is</strong> <strong>private</strong>, the field
<code>user_id</code> can&#39;t be changed (this field may be changed only
if the element is public, because if the user decides to close his profile,
the public elements that he created can&#39;t be deleted: using <a
href="User.html#method-i-destroy_with_dependencies">User#destroy_with_dependencies</a>
they are switched to another owner (the super administrator of the
application, see <a href="User.html#method-c-admin">User.admin</a>)</p>
</li><li>
<p><strong>minimum</strong> <strong>number</strong> of tags (configurated in
config/settings.yml), <strong>only if the attribute <a
href="MediaElement.html#attribute-i-validating_in_form">#validating_in_form</a>
is set as <code>true</code></strong></p>
</li><li>
<p><strong>size</strong> of the file attached to <code>media</code>
(configured in settings.yml, in megabytes)</p>
</li><li>
<p><strong>specific</strong> <strong>media</strong>
<strong>validation</strong> depending on the type of attached media (see <a
href="Media/Video/Uploader/Validation.html">Media::Video::Uploader::Validation</a>,
<a
href="Media/Audio/Uploader/Validation.html">Media::Audio::Uploader::Validation</a>,
<a href="ImageUploader.html">ImageUploader</a>, this last being carried out
automatically by CarrierWave)</p>
</li><li>
<p><strong>the maximum size of the media elements folder size</strong>
(configured in config/settings.yml, in gigabytes)</p>
</li></ul>

<h2 id="label-Callbacks">Callbacks</h2>
<ul><li>
<p><strong>general</strong> <strong>callbacks</strong>:</p>
<ul><li>
<p><strong>on</strong> <strong>the</strong> <strong>method</strong>
<strong>new</strong>, it&#39;s called <a
href="MediaElement.html#method-c-new_with_sti_type_inferring">::new_with_sti_type_inferring</a>,
which infers the type of <code>media</code> and defines the correct class
among <a href="Image.html">Image</a>, <a href="Audio.html">Audio</a>, <a
href="Video.html">Video</a></p>
</li><li>
<p><strong>before_destroy</strong>, if <code>is_public</code> ==
<code>true</code> the destruction is stopped (<strong>this callback is not
executed if the attribute <a
href="MediaElement.html#attribute-i-destroyable_even_if_public">#destroyable_even_if_public</a>
is set as <code>true</code></strong>: this is necessary to destroy public
elements from the administrator, see <a
href="Admin/MediaElementsController.html#method-i-destroy">Admin::MediaElementsController#destroy</a>)</p>
</li><li>
<p><strong>before_destroy</strong> destroys associated bookmarks (see <a
href="Bookmark.html">Bookmark</a>)</p>
</li><li>
<p><strong>before_destroy</strong> destroys associated reports (see <a
href="Report.html">Report</a>)</p>
</li><li>
<p><strong>before_destroy</strong> destroys associated taggings (see <a
href="Tagging.html">Tagging</a>)</p>
</li><li>
<p><strong>after_save</strong> updates taggings associated to the media
element (see <a href="Tagging.html">Tagging</a>). If a <a
href="Tag.html">Tag</a> doesn&#39;t exist yet, it is created too. The tags
are stored before the validation in the private attribute
<code>inner_tags</code>. Notice that <strong>this callback must be declared
before calling <code>require</code> for the submodels</strong>, because the
<code>after_save</code> of tags must be called before the
<code>after_save</code> of the uploader (see private validation methods in
<a href="Media/Shared.html">Media::Shared</a>, and callbacks in <a
href="Image.html">Image</a>)</p>
</li></ul>
</li><li>
<p><strong>callbacks</strong> <strong>only</strong> <strong>for</strong> <a
href="Image.html">Image</a> type:</p>
<ul><li>
<p><strong>before_save</strong> sets <code>width</code> and
<code>height</code> according to the attached image</p>
</li><li>
<p><strong>before_create</strong> sets <code>converted</code> to true, since
during the uploading of an <a href="Image.html">Image</a> we don&#39;t have
to wait for conversion, as happens in <a href="Video.html">Video</a> and <a
href="Audio.html">Audio</a></p>
</li></ul>
</li><li>
<p><strong>callbacks</strong> <strong>only</strong> <strong>for</strong> <a
href="Audio.html">Audio</a> and <a href="Video.html">Video</a> types:</p>
<ul><li>
<p><strong>before_create</strong> sets the +creation_mode*
(<code>uploaded</code> if the element was originally uploaded, or
<code>composed</code> if it was created inside the application)</p>
</li><li>
<p><strong>after_save</strong> calls <code>upload_or_copy</code> in <a
href="Media/Shared.html">Media::Shared</a></p>
</li><li>
<p><strong>before_destroy</strong> stops the destruction if
<code>converted</code> == <code>false</code> (<strong>this callback
doesn&#39;t execute if the attribute destroyable_even_if_not_converted in
<a href="Media/Shared.html">Media::Shared</a> is set to
<code>true</code></strong>: this is necessary if something goes wrong with
the creation of a new media element, in this case the not converted element
must be deleted)</p>
</li><li>
<p><strong>after_destroy</strong> cleans the folder containing the attached
files (mp4, m4a, webm, ogg)</p>
</li></ul>
</li></ul>

<h2 id="label-Database+callbacks">Database callbacks</h2>
<ul><li>
<p><strong>cascade</strong> <strong>destruction</strong> for the associated
table <a href="MediaElementsSlide.html">MediaElementsSlide</a></p>
</li></ul>

<h2 id="label-Other+details">Other details</h2>

<p>It&#39;s defined a scope <strong>of</strong> that filters automaticly all
the elements of a user (see <a
href="User.html#method-i-own_media_elements">User#own_media_elements</a>):</p>

<pre>SELECT &quot;media_elements&quot;.* FROM &quot;media_elements&quot; LEFT JOIN bookmarks ON bookmarks.bookmarkable_id = media_elements.id
AND bookmarks.bookmarkable_type = &#39;MediaElement&#39; AND bookmarks.user_id = 1 WHERE (bookmarks.user_id IS NOT NULL
OR (media_elements.is_public = false AND media_elements.user_id = 1)) ORDER BY COALESCE(bookmarks.created_at, media_elements.updated_at) DESC</pre>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-audio-3F">audio?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>B</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-bookmarked-3F">bookmarked?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-buttons">buttons</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-check_and_destroy">check_and_destroy</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-dashboard_emptied-3F">dashboard_emptied?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-disable_lessons_containing_me">disable_lessons_containing_me</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-enable_lessons_containing_me">enable_lessons_containing_me</a>,
              </li>
            
              
              <li>
                <a href="#method-c-extract">extract</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-filetype">filetype</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-image-3F">image?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-init_validation">init_validation</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>M</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-manage_lessons_containing_me">manage_lessons_containing_me</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new_with_sti_type_inferring">new_with_sti_type_inferring</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-set_status">set_status</a>,
              </li>
            
              
              <li>
                <a href="#method-i-status">status</a>,
              </li>
            
              
              <li>
                <a href="#method-i-sti_type_to_s">sti_type_to_s</a>,
              </li>
            
              
              <li>
                <a href="#method-i-stop_if_public">stop_if_public</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-tags">tags</a>,
              </li>
            
              
              <li>
                <a href="#method-i-tags-3D">tags=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>U</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-update_or_create_tags">update_or_create_tags</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>V</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-validate_associations">validate_associations</a>,
              </li>
            
              
              <li>
                <a href="#method-i-validate_impossible_changes">validate_impossible_changes</a>,
              </li>
            
              
              <li>
                <a href="#method-i-validate_maximum_media_elements_folder_size">validate_maximum_media_elements_folder_size</a>,
              </li>
            
              
              <li>
                <a href="#method-i-validate_publication_date">validate_publication_date</a>,
              </li>
            
              
              <li>
                <a href="#method-i-validate_size">validate_size</a>,
              </li>
            
              
              <li>
                <a href="#method-i-validate_tags_length">validate_tags_length</a>,
              </li>
            
              
              <li>
                <a href="#method-i-video-3F">video?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-visive_tags">visive_tags</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  
    <!-- Includes -->
    <div class="sectiontitle">Included Modules</div>
    <ul>
      
        <li>
          
            <a href="FilenameToken.html">
              FilenameToken
            </a>
          
        </li>
      
    </ul>
  



  

    

    

    
      <!-- Section constants -->
      <div class="sectiontitle">Constants</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">VIDEO_TYPE</td>
            <td>=</td>
            <td class="attr-value">%W(Image Audio Video)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">STI_TYPES</td>
            <td>=</td>
            <td class="attr-value">[IMAGE_TYPE, AUDIO_TYPE, VIDEO_TYPE]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>List of possible values for the field <code>sti_type</code> (they
correspond to an enum defined in postgresql)</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">DISPLAY_MODES</td>
            <td>=</td>
            <td class="attr-value">{ compact: &#x27;compact&#x27;, expanded: &#x27;expanded&#x27; }</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>List of available display modes in the section &#39;elements&#39;</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">MAX_MEDIA_SIZE</td>
            <td>=</td>
            <td class="attr-value">SETTINGS[&#x27;max_media_size&#x27;].megabytes</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Maximum media size expressed in megabytes</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">MAX_TITLE_LENGTH</td>
            <td>=</td>
            <td class="attr-value">(I18n.t(&#x27;language_parameters.media_element.length_title&#x27;) &gt; 255 ? 255 : I18n.t(&#x27;language_parameters.media_element.length_title&#x27;))</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Maximum length of the title, configured in the translation file and limited
by 255 if it&#39;s higher</p></td>
            </tr>
          
        
      </table>
    


    
      <!-- Section attributes -->
      <div class="sectiontitle">Attributes</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>destroyable_even_if_public</td>
            <td class='attr-desc'><p>Set to true when it&#39;s necessary to destroy public elements (used in the
administrator section, see <a
href="Admin/MediaElementsController.html#method-i-destroy">Admin::MediaElementsController#destroy</a>)</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>info_changeable</td>
            <td class='attr-desc'><p>True if in the front end the element contains the icon to change general
information</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>is_reportable</td>
            <td class='attr-desc'><p>True if in the front end the element contains the icon to send a report</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>skip_public_validations</td>
            <td class='attr-desc'><p>Set to true when it&#39;s necessary to skip the public error (used in
seeding)</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [W]
            </td>
            <td class='attr-name'>validating_in_form</td>
            <td class='attr-desc'><p>Set to true if it&#39;s necessary to validate the number of tags (typically
this happens in the public front end)</p></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-dashboard_emptied-3F">
            
              <b>dashboard_emptied?</b>(an_user_id)
            
            <a href="../classes/MediaElement.html#method-c-dashboard_emptied-3F" name="method-c-dashboard_emptied-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-c-dashboard_emptied-3F-label-Description">Description</h3>

<p>Checks whether the dashboard of a particular user is empty because he
picked all the suggested elements and not because the database is empty
(see <a
href="DashboardController.html#method-i-index">DashboardController#index</a>).</p>

<h3 id="method-c-dashboard_emptied-3F-label-Args">Args</h3>
<ul><li>
<p><strong>user_id</strong>: the id of a <a href="User.html">User</a></p>
</li></ul>

<h3 id="method-c-dashboard_emptied-3F-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-dashboard_emptied-3F_source')" id="l_method-c-dashboard_emptied-3F_source">show</a>
                
              </p>
              <div id="method-c-dashboard_emptied-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 239</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">dashboard_emptied?</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-string">&quot;INNER JOIN media_elements ON media_elements.id = bookmarks.bookmarkable_id AND bookmarks.bookmarkable_type = &#39;MediaElement&#39;&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;media_elements.is_public = ? AND media_elements.user_id != ? AND bookmarks.user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-identifier">an_user_id</span>, <span class="ruby-identifier">an_user_id</span>).<span class="ruby-identifier">any?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-extract">
            
              <b>extract</b>(media_element_id, an_user_id, my_sti_type)
            
            <a href="../classes/MediaElement.html#method-c-extract" name="method-c-extract" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-c-extract-label-Description">Description</h3>

<p>Method used for validation for the usage of an element inside the video or
audio editor: it&#39;s checked, essentially, that an element exists, and
that the user who is using the editor is allowed to use it (see <a
href="Media/Video/Editing/Parameters.html">Media::Video::Editing::Parameters</a>
and <a
href="Media/Audio/Editing/Parameters.html">Media::Audio::Editing::Parameters</a>)</p>

<h3 id="method-c-extract-label-Args">Args</h3>
<ul><li>
<p><strong>media_element_id</strong>: the id of the element</p>
</li><li>
<p><strong>an_user_id</strong>: the id of the <a href="User.html">User</a> who
is using the editor</p>
</li><li>
<p><strong>my_sti_type</strong>: the sti_type of the requested element</p>
</li></ul>

<h3 id="method-c-extract-label-Returns">Returns</h3>

<p>If the element can be used, it returns an object of type <a
href="Video.html">Video</a>, <a href="Audio.html">Audio</a> or <a
href="Image.html">Image</a>, depending on the element, otherwise it returns
<code>nil</code></p>

<h3 id="method-c-extract-label-Usage">Usage</h3>

<p>See for instance <a
href="Media/Video/Editing/Parameters.html#method-i-convert_parameters">Media::Video::Editing::Parameters#convert_parameters</a>
and <a
href="Media/Video/Editing/Parameters.html#method-i-get_media_element_from_hash">Media::Video::Editing::Parameters#get_media_element_from_hash</a></p>

<pre>hash[key].kind_of?(Integer) ? MediaElement.extract(hash[key], user_id, my_sti_type) : nil</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-extract_source')" id="l_method-c-extract_source">show</a>
                
              </p>
              <div id="method-c-extract_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 219</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">extract</span>(<span class="ruby-identifier">media_element_id</span>, <span class="ruby-identifier">an_user_id</span>, <span class="ruby-identifier">my_sti_type</span>)
  <span class="ruby-identifier">media_element</span> = <span class="ruby-identifier">find_by_id</span> <span class="ruby-identifier">media_element_id</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">media_element</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">media_element</span>.<span class="ruby-identifier">sti_type</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">my_sti_type</span>
  <span class="ruby-identifier">media_element</span>.<span class="ruby-identifier">set_status</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">media_element</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">media_element</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-filetype">
            
              <b>filetype</b>(path)
            
            <a href="../classes/MediaElement.html#method-c-filetype" name="method-c-filetype" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-c-filetype-label-Description">Description</h3>

<p>It extracts the type of an element according to the same white list used in
MediaElement#new_with_sti_type_inferring. It&#39;s used in <a
href="User.html#method-i-save_in_admin_quick_uploading_cache">User#save_in_admin_quick_uploading_cache</a>
(accessor method to save a list of files massively uploaded and ready to be
saved as media elements)</p>

<h3 id="method-c-filetype-label-Args">Args</h3>
<ul><li>
<p><strong>path</strong>: the path to be checked</p>
</li></ul>

<h3 id="method-c-filetype-label-Returns">Returns</h3>

<p>The inferred sti_type</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-filetype_source')" id="l_method-c-filetype_source">show</a>
                
              </p>
              <div id="method-c-filetype_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 255</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">filetype</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Audio</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENSION_WHITE_LIST</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">path</span>[<span class="ruby-number">1</span>, <span class="ruby-identifier">path</span>.<span class="ruby-identifier">length</span>])
    <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;audio&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-constant">Video</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENSION_WHITE_LIST</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">path</span>[<span class="ruby-number">1</span>, <span class="ruby-identifier">path</span>.<span class="ruby-identifier">length</span>])
    <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;video&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-constant">Image</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENSION_WHITE_LIST</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">path</span>[<span class="ruby-number">1</span>, <span class="ruby-identifier">path</span>.<span class="ruby-identifier">length</span>])
    <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;image&#39;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-new_with_sti_type_inferring">
            
              <b>new_with_sti_type_inferring</b>(attributes = nil, options = {}, &amp;block)
            
            <a href="../classes/MediaElement.html#method-c-new_with_sti_type_inferring" name="method-c-new_with_sti_type_inferring" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-c-new_with_sti_type_inferring-label-Description">Description</h3>

<p>Alias for the method <code>new</code>, that additionally infers the media
type and selects the submodel among <a href="Audio.html">Audio</a>, <a
href="Image.html">Image</a> and <a href="Video.html">Video</a></p>

<h3 id="method-c-new_with_sti_type_inferring-label-Args">Args</h3>
<ul><li>
<p><strong>attributes</strong>: attributes that eventually can be initialized
in the new media element</p>
</li><li>
<p><strong>options</strong>: additional options</p>
</li><li>
<p><strong>block</strong>: block to be executed</p>
</li></ul>

<h3 id="method-c-new_with_sti_type_inferring-label-Usage">Usage</h3>

<p>See for instance <a
href="MediaElementsController.html#method-i-create">MediaElementsController#create</a></p>

<pre class="ruby"><span class="ruby-identifier">media</span> = <span class="ruby-identifier">params</span>[:<span class="ruby-identifier">media</span>]
<span class="ruby-identifier">record</span> = <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">new</span> :<span class="ruby-identifier">media</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">media</span>
</pre>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-new_with_sti_type_inferring_source')" id="l_method-c-new_with_sti_type_inferring_source">show</a>
                
              </p>
              <div id="method-c-new_with_sti_type_inferring_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 178</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">new_with_sti_type_inferring</span>(<span class="ruby-identifier">attributes</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {}, &amp;<span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">media</span> = <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">try</span> <span class="ruby-value">:[]</span>, <span class="ruby-value">:media</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">media</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ActionDispatch</span><span class="ruby-operator">::</span><span class="ruby-constant">Http</span><span class="ruby-operator">::</span><span class="ruby-constant">UploadedFile</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">media</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">File</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">new_without_sti_type_inferring</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">options</span>, &amp;<span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">extension</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">media</span>
      <span class="ruby-keyword">when</span> <span class="ruby-constant">ActionDispatch</span><span class="ruby-operator">::</span><span class="ruby-constant">Http</span><span class="ruby-operator">::</span><span class="ruby-constant">UploadedFile</span> <span class="ruby-keyword">then</span> <span class="ruby-identifier">media</span>.<span class="ruby-identifier">original_filename</span>
      <span class="ruby-keyword">when</span> <span class="ruby-constant">File</span>                               <span class="ruby-keyword">then</span> <span class="ruby-identifier">media</span>.<span class="ruby-identifier">path</span>
      <span class="ruby-keyword">end</span>
    ).<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/^\./</span>, <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">downcase</span>
  <span class="ruby-identifier">inferred_sti_type</span> = <span class="ruby-constant">Hash</span>[ [<span class="ruby-constant">Image</span>, <span class="ruby-constant">Video</span>, <span class="ruby-constant">Audio</span>].
    <span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">v</span>, <span class="ruby-identifier">v</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-value">:EXTENSION_WHITE_LIST</span>)] } ].
    <span class="ruby-identifier">detect</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">extension</span> }.
    <span class="ruby-identifier">try</span>(<span class="ruby-value">:first</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">inferred_sti_type</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">new_without_sti_type_inferring</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">options</span>, &amp;<span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">inferred_sti_type</span>.<span class="ruby-identifier">new_without_sti_type_inferring</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">options</span>, &amp;<span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-audio-3F">
            
              <b>audio?</b>()
            
            <a href="../classes/MediaElement.html#method-i-audio-3F" name="method-i-audio-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-audio-3F-label-Description">Description</h3>

<p>Returns <code>true</code> if the element is of type <a
href="Audio.html">Audio</a></p>

<h3 id="method-i-audio-3F-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-audio-3F_source')" id="l_method-i-audio-3F_source">show</a>
                
              </p>
              <div id="method-i-audio-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 318</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">audio?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sti_type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">AUDIO_TYPE</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-bookmarked-3F">
            
              <b>bookmarked?</b>(an_user_id)
            
            <a href="../classes/MediaElement.html#method-i-bookmarked-3F" name="method-i-bookmarked-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-bookmarked-3F-label-Description">Description</h3>

<p>Checks if the element has a <a href="Bookmark.html">Bookmark</a> for a
particular user</p>

<h3 id="method-i-bookmarked-3F-label-Args">Args</h3>
<ul><li>
<p><strong>an_user_id</strong>: the id of the <a href="User.html">User</a></p>
</li></ul>

<h3 id="method-i-bookmarked-3F-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-bookmarked-3F_source')" id="l_method-i-bookmarked-3F_source">show</a>
                
              </p>
              <div id="method-i-bookmarked-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 451</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">bookmarked?</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">an_user_id</span>, <span class="ruby-value">:bookmarkable_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;MediaElement&#39;</span>, <span class="ruby-value">:bookmarkable_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">any?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-buttons">
            
              <b>buttons</b>()
            
            <a href="../classes/MediaElement.html#method-i-buttons" name="method-i-buttons" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-buttons-label-Description">Description</h3>

<p>Returns the list of buttons available for the user who wants to see this
element. If the element status hasn&#39;t been set yet for that user, or
the element is not visible for him, it returns an empty array.</p>

<h3 id="method-i-buttons-label-Returns">Returns</h3>

<p>An array of keywords representing buttons (see <a
href="Buttons.html">Buttons</a>)</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-buttons_source')" id="l_method-i-buttons_source">show</a>
                
              </p>
              <div id="method-i-buttons_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 426</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">buttons</span>
  <span class="ruby-keyword">return</span> [] <span class="ruby-keyword">if</span> [<span class="ruby-ivar">@status</span>, <span class="ruby-ivar">@is_reportable</span>, <span class="ruby-ivar">@info_changeable</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">PRIVATE</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">PREVIEW</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">EDIT</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">DESTROY</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLIC</span>
     <span class="ruby-keyword">return</span> [<span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">PREVIEW</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">ADD</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">LINKED</span>
     <span class="ruby-keyword">return</span> [<span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">PREVIEW</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">EDIT</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">REMOVE</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> []
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-check_and_destroy">
            
              <b>check_and_destroy</b>()
            
            <a href="../classes/MediaElement.html#method-i-check_and_destroy" name="method-i-check_and_destroy" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-check_and_destroy-label-Description">Description</h3>

<p>Substitute for the normal method <code>destroy</code>, which additionally
adds error messages (necessary for the user experience, used in <a
href="MediaElementsController.html#method-i-destroy">MediaElementsController#destroy</a>)</p>

<h3 id="method-i-check_and_destroy-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-check_and_destroy_source')" id="l_method-i-check_and_destroy_source">show</a>
                
              </p>
              <div id="method-i-check_and_destroy_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 464</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">check_and_destroy</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:cant_destroy_public</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">old_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">destroy</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">old_id</span>)
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-disable_lessons_containing_me">
            
              <b>disable_lessons_containing_me</b>()
            
            <a href="../classes/MediaElement.html#method-i-disable_lessons_containing_me" name="method-i-disable_lessons_containing_me" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-disable_lessons_containing_me-label-Description">Description</h3>

<p>Sets <code>metadata</code>.<code>available_video</code> or
<code>metadata</code>.<code>available_audio</code> to <code>false</code>
(depending on sti_type). Used after the editing started for this element,
see <a href="Media/Shared.html">Media::Shared</a>.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-disable_lessons_containing_me_source')" id="l_method-i-disable_lessons_containing_me_source">show</a>
                
              </p>
              <div id="method-i-disable_lessons_containing_me_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 286</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">disable_lessons_containing_me</span>
  <span class="ruby-identifier">manage_lessons_containing_me</span>(<span class="ruby-keyword">false</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-enable_lessons_containing_me">
            
              <b>enable_lessons_containing_me</b>()
            
            <a href="../classes/MediaElement.html#method-i-enable_lessons_containing_me" name="method-i-enable_lessons_containing_me" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-enable_lessons_containing_me-label-Description">Description</h3>

<p>Sets <code>metadata</code>.<code>available_video</code> or
<code>metadata</code>.<code>available_audio</code> to <code>true</code>
(depending on sti_type). Used when the editing for this element is over
(either correclty or with errors): see <a
href="Media/Video/Editing/Composer.html">Media::Video::Editing::Composer</a>
and <a
href="Media/Audio/Editing/Composer.html">Media::Audio::Editing::Composer</a>.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-enable_lessons_containing_me_source')" id="l_method-i-enable_lessons_containing_me_source">show</a>
                
              </p>
              <div id="method-i-enable_lessons_containing_me_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 294</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">enable_lessons_containing_me</span>
  <span class="ruby-identifier">manage_lessons_containing_me</span>(<span class="ruby-keyword">true</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-image-3F">
            
              <b>image?</b>()
            
            <a href="../classes/MediaElement.html#method-i-image-3F" name="method-i-image-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-image-3F-label-Description">Description</h3>

<p>Returns <code>true</code> if the element is of type <a
href="Image.html">Image</a></p>

<h3 id="method-i-image-3F-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-image-3F_source')" id="l_method-i-image-3F_source">show</a>
                
              </p>
              <div id="method-i-image-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 306</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">image?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sti_type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">IMAGE_TYPE</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-set_status">
            
              <b>set_status</b>(an_user_id)
            
            <a href="../classes/MediaElement.html#method-i-set_status" name="method-i-set_status" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-set_status-label-Description">Description</h3>

<p>This function fills the attributes <a
href="MediaElement.html#attribute-i-is_reportable">#is_reportable</a>,
status and <a
href="MediaElement.html#attribute-i-info_changeable">#info_changeable</a>
(the last two being private). If the model has the four of these attributes
different by <code>nil</code>, it means that the element has a status and
the application knows which functionalities are available for the user who
requested it. If the status is <code>nil</code>, it means that the user
can&#39;t see this element.</p>

<h3 id="method-i-set_status-label-Args">Args</h3>
<ul><li>
<p><strong>an_user_id</strong>: the id of the user who is asking permission to
see the element.</p>
</li></ul>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-set_status_source')" id="l_method-i-set_status_source">show</a>
                
              </p>
              <div id="method-i-set_status_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 397</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">set_status</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">an_user_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span>
    <span class="ruby-ivar">@status</span> = <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">PRIVATE</span>
    <span class="ruby-ivar">@is_reportable</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-ivar">@info_changeable</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">bookmarked?</span>(<span class="ruby-identifier">an_user_id</span>)
    <span class="ruby-ivar">@status</span> = <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLIC</span>
    <span class="ruby-ivar">@is_reportable</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-ivar">@info_changeable</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">bookmarked?</span>(<span class="ruby-identifier">an_user_id</span>)
    <span class="ruby-ivar">@status</span> = <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">LINKED</span>
    <span class="ruby-ivar">@is_reportable</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-ivar">@info_changeable</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@status</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@is_reportable</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@info_changeable</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-status">
            
              <b>status</b>(with_captions=false)
            
            <a href="../classes/MediaElement.html#method-i-status" name="method-i-status" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-status-label-Description">Description</h3>

<p>Substitute for the attr_reader relative to the attribute
<code>status</code>.</p>

<h3 id="method-i-status-label-Args">Args</h3>
<ul><li>
<p><strong>with_captions</strong>: if <code>true</code> returns the translated
caption of the status (this means that it&#39;s used in the front-end),
otherwise it returns the status keyword (for default).</p>
</li></ul>

<h3 id="method-i-status-label-Returns">Returns</h3>

<p>A string, or a keyword representing the status (see <a
href="Statuses.html">Statuses</a>)</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-status_source')" id="l_method-i-status_source">show</a>
                
              </p>
              <div id="method-i-status_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 385</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">status</span>(<span class="ruby-identifier">with_captions</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-ivar">@status</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">with_captions</span> <span class="ruby-operator">?</span> <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">status</span>(<span class="ruby-ivar">@status</span>) <span class="ruby-operator">:</span> <span class="ruby-ivar">@status</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-sti_type_to_s">
            
              <b>sti_type_to_s</b>()
            
            <a href="../classes/MediaElement.html#method-i-sti_type_to_s" name="method-i-sti_type_to_s" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-sti_type_to_s-label-Description">Description</h3>

<p>Extracts the translation of the <code>sti_type</code> from the translation
file</p>

<h3 id="method-i-sti_type_to_s-label-Returns">Returns</h3>

<p>A string</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-sti_type_to_s_source')" id="l_method-i-sti_type_to_s_source">show</a>
                
              </p>
              <div id="method-i-sti_type_to_s_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 278</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">sti_type_to_s</span>
  <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-node">&quot;sti_types.#{self.sti_type.downcase}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-tags">
            
              <b>tags</b>()
            
            <a href="../classes/MediaElement.html#method-i-tags" name="method-i-tags" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-tags-label-Description">Description</h3>

<p>Used as (unproper) substitute for the attr_reader relative to the attribute
<code>tags</code>: it extracts the tags directly from the database</p>

<h3 id="method-i-tags-label-Returns">Returns</h3>

<p>An array of <a href="Tag.html">Tag</a> objects.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-tags_source')" id="l_method-i-tags_source">show</a>
                
              </p>
              <div id="method-i-tags_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 350</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">tags</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">get_friendly_tags</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-string">&#39;MediaElement&#39;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-tags-3D">
            
              <b>tags=</b>(tags)
            
            <a href="../classes/MediaElement.html#method-i-tags-3D" name="method-i-tags-3D" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-tags-3D-label-Description">Description</h3>

<p>Used as (unproper) substitute for the attribute writer relative to the
attribute <code>tags</code>: the attribute <code>tags</code> is filled with
a string of words separated by comma. During the validation,
<code>tags</code> is converted in another attribute called
<code>inner_tags</code>: this attribute is an array of objects of type <a
href="Tag.html">Tag</a> (if the tag doesn&#39;t exist yet, the object is
new_record) ready to be saved together with their taggings in the
<code>after_save</code> validation.</p>

<h3 id="method-i-tags-3D-label-Args">Args</h3>

<p>Either an array of strings, or a string of words separated by comma</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-tags-3D_source')" id="l_method-i-tags-3D_source">show</a>
                
              </p>
              <div id="method-i-tags-3D_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 362</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">tags=</span>(<span class="ruby-identifier">tags</span>)
  <span class="ruby-ivar">@tags</span> = 
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">tags</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
      <span class="ruby-identifier">tags</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
      <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:to_s</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;,&#39;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@tags</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-video-3F">
            
              <b>video?</b>()
            
            <a href="../classes/MediaElement.html#method-i-video-3F" name="method-i-video-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-video-3F-label-Description">Description</h3>

<p>Returns <code>true</code> if the element is of type <a
href="Video.html">Video</a></p>

<h3 id="method-i-video-3F-label-Returns">Returns</h3>

<p>A boolean</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-video-3F_source')" id="l_method-i-video-3F_source">show</a>
                
              </p>
              <div id="method-i-video-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 330</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">video?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sti_type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">VIDEO_TYPE</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-visive_tags">
            
              <b>visive_tags</b>()
            
            <a href="../classes/MediaElement.html#method-i-visive_tags" name="method-i-visive_tags" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <h3 id="method-i-visive_tags-label-Description">Description</h3>

<p>It uses <a href="Tagging.html#method-c-visive_tags">Tagging.visive_tags</a>
(see also <a
href="Lesson.html#method-i-visive_tags">Lesson#visive_tags</a>)</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-visive_tags_source')" id="l_method-i-visive_tags_source">show</a>
                
              </p>
              <div id="method-i-visive_tags_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 338</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">visive_tags</span>
  <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">visive_tags</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">tags</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
              
      <div class="sectiontitle">Instance Private methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-init_validation">
            
              <b>init_validation</b>()
            
            <a href="../classes/MediaElement.html#method-i-init_validation" name="method-i-init_validation" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Initializes validation objects (see <a
href="Valid.html#method-c-get_association">Valid.get_association</a>).
It&#39;s initialized also the private attribute <code>inner_tags</code></p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-init_validation_source')" id="l_method-i-init_validation_source">show</a>
                
              </p>
              <div id="method-i-init_validation_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 517</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">init_validation</span> <span class="ruby-comment"># :doc:</span>
  <span class="ruby-ivar">@media_element</span> = <span class="ruby-constant">Valid</span>.<span class="ruby-identifier">get_association</span> <span class="ruby-keyword">self</span>, <span class="ruby-value">:id</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">Valid</span>.<span class="ruby-identifier">get_association</span> <span class="ruby-keyword">self</span>, <span class="ruby-value">:user_id</span>
  <span class="ruby-ivar">@inner_tags</span> =
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tags</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">get_tags_for_item</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-string">&#39;MediaElement&#39;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">resp_tags</span> = []
      <span class="ruby-identifier">prev_tags</span> = []
      <span class="ruby-ivar">@tags</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;,&#39;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-identifier">t</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">mb_chars</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">to_s</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">prev_tags</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">t</span>
            <span class="ruby-identifier">tag</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find_or_initialize_by_word</span> <span class="ruby-identifier">t</span>
            <span class="ruby-identifier">resp_tags</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tag</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">valid?</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">prev_tags</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">t</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">resp_tags</span>
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-manage_lessons_containing_me">
            
              <b>manage_lessons_containing_me</b>(value)
            
            <a href="../classes/MediaElement.html#method-i-manage_lessons_containing_me" name="method-i-manage_lessons_containing_me" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Used as a submethod of <a
href="MediaElement.html#method-i-disable_lessons_containing_me">#disable_lessons_containing_me</a>
and <a
href="MediaElement.html#method-i-enable_lessons_containing_me">#enable_lessons_containing_me</a></p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-manage_lessons_containing_me_source')" id="l_method-i-manage_lessons_containing_me_source">show</a>
                
              </p>
              <div id="method-i-manage_lessons_containing_me_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 595</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">manage_lessons_containing_me</span>(<span class="ruby-identifier">value</span>) <span class="ruby-comment"># :doc:</span>
  <span class="ruby-constant">MediaElementsSlide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:media_element_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mes</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">l</span> = <span class="ruby-identifier">mes</span>.<span class="ruby-identifier">slide</span>.<span class="ruby-identifier">lesson</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">video?</span>
      <span class="ruby-identifier">l</span>.<span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">available_video</span> = <span class="ruby-identifier">value</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">audio?</span>
      <span class="ruby-identifier">l</span>.<span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">available_audio</span> = <span class="ruby-identifier">value</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">l</span>.<span class="ruby-identifier">save!</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-stop_if_public">
            
              <b>stop_if_public</b>()
            
            <a href="../classes/MediaElement.html#method-i-stop_if_public" name="method-i-stop_if_public" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Callback that stops the destruction of a public element; the callback is
not fired if <a
href="MediaElement.html#attribute-i-destroyable_even_if_public">#destroyable_even_if_public</a>
is true</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-stop_if_public_source')" id="l_method-i-stop_if_public_source">show</a>
                
              </p>
              <div id="method-i-stop_if_public_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 583</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">stop_if_public</span> <span class="ruby-comment"># :doc:</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">destroyable_even_if_public</span>
  <span class="ruby-ivar">@media_element</span> = <span class="ruby-constant">Valid</span>.<span class="ruby-identifier">get_association</span> <span class="ruby-keyword">self</span>, <span class="ruby-value">:id</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@media_element</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:is_public</span>)
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span> <span class="ruby-value">:is_public</span>, <span class="ruby-value">:undestroyable</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-update_or_create_tags">
            
              <b>update_or_create_tags</b>()
            
            <a href="../classes/MediaElement.html#method-i-update_or_create_tags" name="method-i-update_or_create_tags" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Callback that updates the taggings associated to the element. If the
corresponding <a href="Tag.html">Tag</a> doesn&#39;t exist yet, it&#39;s
created</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-update_or_create_tags_source')" id="l_method-i-update_or_create_tags_source">show</a>
                
              </p>
              <div id="method-i-update_or_create_tags_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 496</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">update_or_create_tags</span> <span class="ruby-comment"># :doc:</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@inner_tags</span>
  <span class="ruby-identifier">words</span> = []
  <span class="ruby-ivar">@inner_tags</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">t</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-identifier">words</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">tagging</span> = <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:taggable_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:taggable_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;MediaElement&#39;</span>, <span class="ruby-value">:tag_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">tagging</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">tagging</span> = <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-identifier">tagging</span>.<span class="ruby-identifier">taggable_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
      <span class="ruby-identifier">tagging</span>.<span class="ruby-identifier">taggable_type</span> = <span class="ruby-string">&#39;MediaElement&#39;</span>
      <span class="ruby-identifier">tagging</span>.<span class="ruby-identifier">tag_id</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">id</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tagging</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:taggable_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;MediaElement&#39;</span>, <span class="ruby-value">:taggable_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">destroy</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">words</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">t</span>.<span class="ruby-identifier">tag_id</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-validate_associations">
            
              <b>validate_associations</b>()
            
            <a href="../classes/MediaElement.html#method-i-validate_associations" name="method-i-validate_associations" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Validates the presence of all the associated objects</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-validate_associations_source')" id="l_method-i-validate_associations_source">show</a>
                
              </p>
              <div id="method-i-validate_associations_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 549</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">validate_associations</span> <span class="ruby-comment"># :doc:</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:user_id</span>, <span class="ruby-value">:doesnt_exist</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-validate_impossible_changes">
            
              <b>validate_impossible_changes</b>()
            
            <a href="../classes/MediaElement.html#method-i-validate_impossible_changes" name="method-i-validate_impossible_changes" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>If it&#39;s new record, it validates that <code>is_public</code> must be
false; otherwise, if public it validates that <code>media</code>,
<code>title</code>, <code>description</code>, <code>is_public</code>,
<code>publication_date</code> can&#39;t be changed; if private, it
validates that <code>user_id</code> can&#39;t be changed</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-validate_impossible_changes_source')" id="l_method-i-validate_impossible_changes_source">show</a>
                
              </p>
              <div id="method-i-validate_impossible_changes_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 563</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">validate_impossible_changes</span> <span class="ruby-comment"># :doc:</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@media_element</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:is_public</span>, <span class="ruby-value">:must_be_false_if_new_record</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">skip_public_validations</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:sti_type</span>, <span class="ruby-value">:cant_be_changed</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@media_element</span>.<span class="ruby-identifier">sti_type</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sti_type</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@media_element</span>.<span class="ruby-identifier">is_public</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">skip_public_validations</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:media</span>, <span class="ruby-value">:cant_be_changed_if_public</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">changed</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&#39;media&#39;</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:title</span>, <span class="ruby-value">:cant_be_changed_if_public</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@media_element</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">title</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:description</span>, <span class="ruby-value">:cant_be_changed_if_public</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@media_element</span>.<span class="ruby-identifier">description</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">description</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:is_public</span>, <span class="ruby-value">:cant_be_changed_if_public</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:publication_date</span>, <span class="ruby-value">:cant_be_changed_if_public</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@media_element</span>.<span class="ruby-identifier">publication_date</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication_date</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:user_id</span>, <span class="ruby-value">:cant_be_changed</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@media_element</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-validate_maximum_media_elements_folder_size">
            
              <b>validate_maximum_media_elements_folder_size</b>()
            
            <a href="../classes/MediaElement.html#method-i-validate_maximum_media_elements_folder_size" name="method-i-validate_maximum_media_elements_folder_size" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Validates the sum of the media elements folder size to don&#39;t exceed the
maximum size available</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-validate_maximum_media_elements_folder_size_source')" id="l_method-i-validate_maximum_media_elements_folder_size_source">show</a>
                
              </p>
              <div id="method-i-validate_maximum_media_elements_folder_size_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 608</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">validate_maximum_media_elements_folder_size</span> <span class="ruby-comment"># :doc:</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span> <span class="ruby-value">:media</span>, <span class="ruby-value">:folder_size_exceeded</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Media</span><span class="ruby-operator">::</span><span class="ruby-constant">Uploader</span>.<span class="ruby-identifier">maximum_media_elements_folder_size_exceeded?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-validate_publication_date">
            
              <b>validate_publication_date</b>()
            
            <a href="../classes/MediaElement.html#method-i-validate_publication_date" name="method-i-validate_publication_date" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Validates that <code>publication_date</code> is blank if the element is not
public, and that it&#39;s present and in the correct format if the element
is public</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-validate_publication_date_source')" id="l_method-i-validate_publication_date_source">show</a>
                
              </p>
              <div id="method-i-validate_publication_date_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 554</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">validate_publication_date</span> <span class="ruby-comment"># :doc:</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:publication_date</span>, <span class="ruby-value">:is_not_a_date</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication_date</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication_date</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Time</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:publication_date</span>, <span class="ruby-value">:must_be_blank_if_private</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">publication_date</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-validate_size">
            
              <b>validate_size</b>()
            
            <a href="../classes/MediaElement.html#method-i-validate_size" name="method-i-validate_size" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Validates the size of the attached file, comparing it to the maximum size
configured in megabytes in settings.yml</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-validate_size_source')" id="l_method-i-validate_size_source">show</a>
                
              </p>
              <div id="method-i-validate_size_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 541</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">validate_size</span> <span class="ruby-comment"># :doc:</span>
  <span class="ruby-keyword">if</span> ( (<span class="ruby-identifier">audio?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">video?</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">media</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:value</span>).<span class="ruby-identifier">try</span>(<span class="ruby-value">:is_a?</span>, <span class="ruby-constant">ActionDispatch</span><span class="ruby-operator">::</span><span class="ruby-constant">Http</span><span class="ruby-operator">::</span><span class="ruby-constant">UploadedFile</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">media</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">MAX_MEDIA_SIZE</span> ) <span class="ruby-operator">||</span>
     ( <span class="ruby-identifier">image?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">media</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">media</span>.<span class="ruby-identifier">file</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">MAX_MEDIA_SIZE</span> )
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:media</span>, <span class="ruby-value">:too_large</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-validate_tags_length">
            
              <b>validate_tags_length</b>()
            
            <a href="../classes/MediaElement.html#method-i-validate_tags_length" name="method-i-validate_tags_length" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Validates that the tags are at least the number configured in settings.yml,
unless the attribute <code>validating_in_form</code> is false</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-validate_tags_length_source')" id="l_method-i-validate_tags_length_source">show</a>
                
              </p>
              <div id="method-i-validate_tags_length_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/models/media_element.rb, line 491</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">validate_tags_length</span> <span class="ruby-comment"># :doc:</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:tags</span>, <span class="ruby-value">:are_not_enough</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@validating_in_form</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@inner_tags</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;min_tags_for_item&#39;</span>]
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    