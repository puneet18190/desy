<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class User - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/models/user.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">ActiveRecord::Base
  
</nav>

    <!-- Included Modules -->
<nav id="includes-section" class="section">
  <h3 class="section-header">Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="User/Authentication.html">User::Authentication</a>
  
  
  
    <li><a class="include" href="User/Confirmation.html">User::Confirmation</a>
  
  
  </ul>
</nav>

    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-admin">::admin</a>
    
    <li><a href="#method-c-get_full_names">::get_full_names</a>
    
    <li><a href="#method-c-location_association_class">::location_association_class</a>
    
    <li><a href="#method-i-admin-3F">#admin?</a>
    
    <li><a href="#method-i-admin_quick_uploading_cache">#admin_quick_uploading_cache</a>
    
    <li><a href="#method-i-audio_editor_available">#audio_editor_available</a>
    
    <li><a href="#method-i-audio_editor_cache">#audio_editor_cache</a>
    
    <li><a href="#method-i-audio_editor_cache-21">#audio_editor_cache!</a>
    
    <li><a href="#method-i-base_location">#base_location</a>
    
    <li><a href="#method-i-bookmark">#bookmark</a>
    
    <li><a href="#method-i-create_lesson">#create_lesson</a>
    
    <li><a href="#method-i-destroy_notification_and_reload">#destroy_notification_and_reload</a>
    
    <li><a href="#method-i-destroy_with_dependencies">#destroy_with_dependencies</a>
    
    <li><a href="#method-i-dislike">#dislike</a>
    
    <li><a href="#method-i-empty_playlist">#empty_playlist</a>
    
    <li><a href="#method-i-empty_virtual_classroom">#empty_virtual_classroom</a>
    
    <li><a href="#method-i-full_name">#full_name</a>
    
    <li><a href="#method-i-full_virtual_classroom">#full_virtual_classroom</a>
    
    <li><a href="#method-i-get_tags_associated_to_lesson_search">#get_tags_associated_to_lesson_search</a>
    
    <li><a href="#method-i-get_tags_associated_to_media_element_search">#get_tags_associated_to_media_element_search</a>
    
    <li><a href="#method-i-like">#like</a>
    
    <li><a href="#method-i-new_mailing_list_name">#new_mailing_list_name</a>
    
    <li><a href="#method-i-notifications_visible_block">#notifications_visible_block</a>
    
    <li><a href="#method-i-number_notifications_not_seen">#number_notifications_not_seen</a>
    
    <li><a href="#method-i-own_lessons">#own_lessons</a>
    
    <li><a href="#method-i-own_mailing_list_groups">#own_mailing_list_groups</a>
    
    <li><a href="#method-i-own_media_elements">#own_media_elements</a>
    
    <li><a href="#method-i-parent_locations">#parent_locations</a>
    
    <li><a href="#method-i-playlist">#playlist</a>
    
    <li><a href="#method-i-playlist_for_viewer">#playlist_for_viewer</a>
    
    <li><a href="#method-i-playlist_full-3F">#playlist_full?</a>
    
    <li><a href="#method-i-registration_policies">#registration_policies</a>
    
    <li><a href="#method-i-remove_from_admin_quick_uploading_cache">#remove_from_admin_quick_uploading_cache</a>
    
    <li><a href="#method-i-report_lesson">#report_lesson</a>
    
    <li><a href="#method-i-report_media_element">#report_media_element</a>
    
    <li><a href="#method-i-reset_password-21">#reset_password!</a>
    
    <li><a href="#method-i-save_in_admin_quick_uploading_cache">#save_in_admin_quick_uploading_cache</a>
    
    <li><a href="#method-i-search_lessons">#search_lessons</a>
    
    <li><a href="#method-i-search_lessons_with_tag">#search_lessons_with_tag</a>
    
    <li><a href="#method-i-search_lessons_without_tag">#search_lessons_without_tag</a>
    
    <li><a href="#method-i-search_media_elements">#search_media_elements</a>
    
    <li><a href="#method-i-search_media_elements_with_tag">#search_media_elements_with_tag</a>
    
    <li><a href="#method-i-search_media_elements_without_tag">#search_media_elements_without_tag</a>
    
    <li><a href="#method-i-subject_ids-3D">#subject_ids=</a>
    
    <li><a href="#method-i-suggested_lessons">#suggested_lessons</a>
    
    <li><a href="#method-i-suggested_media_elements">#suggested_media_elements</a>
    
    <li><a href="#method-i-super_admin-3F">#super_admin?</a>
    
    <li><a href="#method-i-tot_notifications_number">#tot_notifications_number</a>
    
    <li><a href="#method-i-video_editor_available">#video_editor_available</a>
    
    <li><a href="#method-i-video_editor_cache">#video_editor_cache</a>
    
    <li><a href="#method-i-video_editor_cache-21">#video_editor_cache!</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Media.html">Media</a>
  
    <li><a href="./Media/Audio.html">Media::Audio</a>
  
    <li><a href="./Media/Audio/Editing.html">Media::Audio::Editing</a>
  
    <li><a href="./Media/Audio/Editing/Cmd.html">Media::Audio::Editing::Cmd</a>
  
    <li><a href="./Media/Audio/Editing/Cmd/Avconv.html">Media::Audio::Editing::Cmd::Avconv</a>
  
    <li><a href="./Media/Audio/Editing/Cmd/Concat.html">Media::Audio::Editing::Cmd::Concat</a>
  
    <li><a href="./Media/Audio/Editing/Cmd/Conversion.html">Media::Audio::Editing::Cmd::Conversion</a>
  
    <li><a href="./Media/Audio/Editing/Cmd/Crop.html">Media::Audio::Editing::Cmd::Crop</a>
  
    <li><a href="./Media/Audio/Editing/Cmd/Sox.html">Media::Audio::Editing::Cmd::Sox</a>
  
    <li><a href="./Media/Audio/Editing/Composer.html">Media::Audio::Editing::Composer</a>
  
    <li><a href="./Media/Audio/Editing/Composer/Job.html">Media::Audio::Editing::Composer::Job</a>
  
    <li><a href="./Media/Audio/Editing/Concat.html">Media::Audio::Editing::Concat</a>
  
    <li><a href="./Media/Audio/Editing/Conversion.html">Media::Audio::Editing::Conversion</a>
  
    <li><a href="./Media/Audio/Editing/Conversion/Job.html">Media::Audio::Editing::Conversion::Job</a>
  
    <li><a href="./Media/Audio/Editing/Crop.html">Media::Audio::Editing::Crop</a>
  
    <li><a href="./Media/Audio/Editing/Parameters.html">Media::Audio::Editing::Parameters</a>
  
    <li><a href="./Media/Audio/Uploader.html">Media::Audio::Uploader</a>
  
    <li><a href="./Media/Audio/Uploader/Validation.html">Media::Audio::Uploader::Validation</a>
  
    <li><a href="./Media/Cmd.html">Media::Cmd</a>
  
    <li><a href="./Media/Cmd/Avconv.html">Media::Cmd::Avconv</a>
  
    <li><a href="./Media/Cmd/Avprobe.html">Media::Cmd::Avprobe</a>
  
    <li><a href="./Media/Error.html">Media::Error</a>
  
    <li><a href="./Media/Image.html">Media::Image</a>
  
    <li><a href="./Media/Image/Editing.html">Media::Image::Editing</a>
  
    <li><a href="./Media/Image/Editing/AddTextToImage.html">Media::Image::Editing::AddTextToImage</a>
  
    <li><a href="./Media/Image/Editing/Cmd.html">Media::Image::Editing::Cmd</a>
  
    <li><a href="./Media/Image/Editing/Cmd/TextToImage.html">Media::Image::Editing::Cmd::TextToImage</a>
  
    <li><a href="./Media/Image/Editing/Crop.html">Media::Image::Editing::Crop</a>
  
    <li><a href="./Media/Image/Editing/ResizeToFill.html">Media::Image::Editing::ResizeToFill</a>
  
    <li><a href="./Media/InTmpDir.html">Media::InTmpDir</a>
  
    <li><a href="./Media/Info.html">Media::Info</a>
  
    <li><a href="./Media/Logging.html">Media::Logging</a>
  
    <li><a href="./Media/Logging/ClassMethods.html">Media::Logging::ClassMethods</a>
  
    <li><a href="./Media/Logging/InstanceMethods.html">Media::Logging::InstanceMethods</a>
  
    <li><a href="./Media/Shared.html">Media::Shared</a>
  
    <li><a href="./Media/Shared/InstanceMethods.html">Media::Shared::InstanceMethods</a>
  
    <li><a href="./Media/SimilarDurations.html">Media::SimilarDurations</a>
  
    <li><a href="./Media/Thread.html">Media::Thread</a>
  
    <li><a href="./Media/Uploader.html">Media::Uploader</a>
  
    <li><a href="./Media/Video.html">Media::Video</a>
  
    <li><a href="./Media/Video/Editing.html">Media::Video::Editing</a>
  
    <li><a href="./Media/Video/Editing/Cmd.html">Media::Video::Editing::Cmd</a>
  
    <li><a href="./Media/Video/Editing/Cmd/AudioStreamToFile.html">Media::Video::Editing::Cmd::AudioStreamToFile</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Avconv.html">Media::Video::Editing::Cmd::Avconv</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Concat.html">Media::Video::Editing::Cmd::Concat</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Concat/Mp4.html">Media::Video::Editing::Cmd::Concat::Mp4</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Concat/Webm.html">Media::Video::Editing::Cmd::Concat::Webm</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Conversion.html">Media::Video::Editing::Cmd::Conversion</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Crop.html">Media::Video::Editing::Cmd::Crop</a>
  
    <li><a href="./Media/Video/Editing/Cmd/ExtractFrame.html">Media::Video::Editing::Cmd::ExtractFrame</a>
  
    <li><a href="./Media/Video/Editing/Cmd/GenerateTransitionFrames.html">Media::Video::Editing::Cmd::GenerateTransitionFrames</a>
  
    <li><a href="./Media/Video/Editing/Cmd/ImageToVideo.html">Media::Video::Editing::Cmd::ImageToVideo</a>
  
    <li><a href="./Media/Video/Editing/Cmd/MergeWebmVideoStreams.html">Media::Video::Editing::Cmd::MergeWebmVideoStreams</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Mp3ToWav.html">Media::Video::Editing::Cmd::Mp3ToWav</a>
  
    <li><a href="./Media/Video/Editing/Cmd/ReplaceAudio.html">Media::Video::Editing::Cmd::ReplaceAudio</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Transition.html">Media::Video::Editing::Cmd::Transition</a>
  
    <li><a href="./Media/Video/Editing/Cmd/TrimAudioFile.html">Media::Video::Editing::Cmd::TrimAudioFile</a>
  
    <li><a href="./Media/Video/Editing/Cmd/VideoStreamToFile.html">Media::Video::Editing::Cmd::VideoStreamToFile</a>
  
    <li><a href="./Media/Video/Editing/Composer.html">Media::Video::Editing::Composer</a>
  
    <li><a href="./Media/Video/Editing/Composer/Job.html">Media::Video::Editing::Composer::Job</a>
  
    <li><a href="./Media/Video/Editing/Concat.html">Media::Video::Editing::Concat</a>
  
    <li><a href="./Media/Video/Editing/Conversion.html">Media::Video::Editing::Conversion</a>
  
    <li><a href="./Media/Video/Editing/Conversion/Job.html">Media::Video::Editing::Conversion::Job</a>
  
    <li><a href="./Media/Video/Editing/Crop.html">Media::Video::Editing::Crop</a>
  
    <li><a href="./Media/Video/Editing/ImageToVideo.html">Media::Video::Editing::ImageToVideo</a>
  
    <li><a href="./Media/Video/Editing/Parameters.html">Media::Video::Editing::Parameters</a>
  
    <li><a href="./Media/Video/Editing/ReplaceAudio.html">Media::Video::Editing::ReplaceAudio</a>
  
    <li><a href="./Media/Video/Editing/TextToVideo.html">Media::Video::Editing::TextToVideo</a>
  
    <li><a href="./Media/Video/Editing/Transition.html">Media::Video::Editing::Transition</a>
  
    <li><a href="./Media/Video/Uploader.html">Media::Video::Uploader</a>
  
    <li><a href="./Media/Video/Uploader/Validation.html">Media::Video::Uploader::Validation</a>
  
    <li><a href="./Admin.html">Admin</a>
  
    <li><a href="./Admin/DashboardController.html">Admin::DashboardController</a>
  
    <li><a href="./Admin/LessonsController.html">Admin::LessonsController</a>
  
    <li><a href="./Admin/MediaElementsController.html">Admin::MediaElementsController</a>
  
    <li><a href="./Admin/MessagesController.html">Admin::MessagesController</a>
  
    <li><a href="./Admin/ReportsController.html">Admin::ReportsController</a>
  
    <li><a href="./Admin/SettingsController.html">Admin::SettingsController</a>
  
    <li><a href="./Admin/UsersController.html">Admin::UsersController</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./User/Authentication.html">User::Authentication</a>
  
    <li><a href="./User/Authentication/ClassMethods.html">User::Authentication::ClassMethods</a>
  
    <li><a href="./User/Authentication/InstanceMethods.html">User::Authentication::InstanceMethods</a>
  
    <li><a href="./User/Confirmation.html">User::Confirmation</a>
  
    <li><a href="./User/Confirmation/ClassMethods.html">User::Confirmation::ClassMethods</a>
  
    <li><a href="./User/Confirmation/InstanceMethods.html">User::Confirmation::InstanceMethods</a>
  
    <li><a href="./Dumpable.html">Dumpable</a>
  
    <li><a href="./Dumpable/NoMethodError.html">Dumpable::NoMethodError</a>
  
    <li><a href="./EnvRelativePath.html">EnvRelativePath</a>
  
    <li><a href="./EnvRelativePath/ClassMethods.html">EnvRelativePath::ClassMethods</a>
  
    <li><a href="./FilenameToken.html">FilenameToken</a>
  
    <li><a href="./FilenameToken/InstanceMethods.html">FilenameToken::InstanceMethods</a>
  
    <li><a href="./TimeConvert.html">TimeConvert</a>
  
    <li><a href="./TimeConvert/TimeConverter.html">TimeConvert::TimeConverter</a>
  
    <li><a href="./Users.html">Users</a>
  
    <li><a href="./Users/SessionsController.html">Users::SessionsController</a>
  
    <li><a href="./Valid.html">Valid</a>
  
    <li><a href="./Valid/Validness.html">Valid::Validness</a>
  
    <li><a href="./AdminController.html">AdminController</a>
  
    <li><a href="./AdminHelper.html">AdminHelper</a>
  
    <li><a href="./AdminSearchForm.html">AdminSearchForm</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Audio.html">Audio</a>
  
    <li><a href="./AudioEditorController.html">AudioEditorController</a>
  
    <li><a href="./Bookmark.html">Bookmark</a>
  
    <li><a href="./ButtonDestinations.html">ButtonDestinations</a>
  
    <li><a href="./Buttons.html">Buttons</a>
  
    <li><a href="./ControllerInfo.html">ControllerInfo</a>
  
    <li><a href="./DashboardController.html">DashboardController</a>
  
    <li><a href="./EnhancedThread.html">EnhancedThread</a>
  
    <li><a href="./ErrorsLogger.html">ErrorsLogger</a>
  
    <li><a href="./ExceptionNotifierJob.html">ExceptionNotifierJob</a>
  
    <li><a href="./Filters.html">Filters</a>
  
    <li><a href="./Form.html">Form</a>
  
    <li><a href="./GalleriesController.html">GalleriesController</a>
  
    <li><a href="./Image.html">Image</a>
  
    <li><a href="./ImageEditorController.html">ImageEditorController</a>
  
    <li><a href="./ImageUploader.html">ImageUploader</a>
  
    <li><a href="./Lesson.html">Lesson</a>
  
    <li><a href="./LessonEditorController.html">LessonEditorController</a>
  
    <li><a href="./LessonViewerController.html">LessonViewerController</a>
  
    <li><a href="./LessonsController.html">LessonsController</a>
  
    <li><a href="./LessonsMediaElementsShared.html">LessonsMediaElementsShared</a>
  
    <li><a href="./Like.html">Like</a>
  
    <li><a href="./Location.html">Location</a>
  
    <li><a href="./MailerHelper.html">MailerHelper</a>
  
    <li><a href="./MailingListAddress.html">MailingListAddress</a>
  
    <li><a href="./MailingListGroup.html">MailingListGroup</a>
  
    <li><a href="./MailingListsController.html">MailingListsController</a>
  
    <li><a href="./MediaElement.html">MediaElement</a>
  
    <li><a href="./MediaElementsController.html">MediaElementsController</a>
  
    <li><a href="./MediaElementsSlide.html">MediaElementsSlide</a>
  
    <li><a href="./Notification.html">Notification</a>
  
    <li><a href="./NotificationsController.html">NotificationsController</a>
  
    <li><a href="./NotificationsJob.html">NotificationsJob</a>
  
    <li><a href="./PreloginController.html">PreloginController</a>
  
    <li><a href="./Report.html">Report</a>
  
    <li><a href="./ReportsController.html">ReportsController</a>
  
    <li><a href="./SchoolLevel.html">SchoolLevel</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchOrders.html">SearchOrders</a>
  
    <li><a href="./Slide.html">Slide</a>
  
    <li><a href="./Statistics.html">Statistics</a>
  
    <li><a href="./Statuses.html">Statuses</a>
  
    <li><a href="./Subject.html">Subject</a>
  
    <li><a href="./Tag.html">Tag</a>
  
    <li><a href="./Tagging.html">Tagging</a>
  
    <li><a href="./TagsController.html">TagsController</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersSubject.html">UsersSubject</a>
  
    <li><a href="./Video.html">Video</a>
  
    <li><a href="./VideoEditorController.html">VideoEditorController</a>
  
    <li><a href="./VirtualClassroomController.html">VirtualClassroomController</a>
  
    <li><a href="./VirtualClassroomLesson.html">VirtualClassroomLesson</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class User</h1>

  <div id="description" class="description">
    
<h2 id="label-Description">Description</h2>

<p>ActiveRecord class that corresponds to the table <code>users</code>.</p>

<h2 id="label-Fields">Fields</h2>
<ul><li>
<p><strong>email</strong>: unique identifier for the user, and e-mail address</p>
</li><li>
<p><strong>name</strong>: name of the user</p>
</li><li>
<p><strong>surname</strong>: surname of the user</p>
</li><li>
<p><strong>school_level_id</strong>: reference to the user&#39;s <a
href="SchoolLevel.html">SchoolLevel</a></p>
</li><li>
<p><strong>encrypted_password</strong>: password, encrypted with SecureRandom</p>
</li><li>
<p><strong>confirmed</strong>: boolean, <code>true</code> if the user has
completed the registration procedure clicking on a link he received by
email</p>
</li><li>
<p><strong>active</strong>: boolean, false if the user is banned</p>
</li><li>
<p><strong>location_id</strong>: location of the user</p>
</li><li>
<p><strong>confirmation_token</strong>: token used for confirmation, generated
automaticly</p>
</li><li>
<p><strong>metadata</strong>:</p>
<ul><li>
<p><code>video_editor_cache</code>: cache of the <a
href="Video.html">Video</a> Editor (screenshot of the last video edited)</p>
</li><li>
<p><code>audio_editor_cache</code>: cache of the <a
href="Audio.html">Audio</a> Editor (screenshot of the last audio edited)</p>
</li></ul>
</li></ul>

<h2 id="label-Associations">Associations</h2>
<ul><li>
<p><strong>bookmarks</strong>: links created by this user elements or lessons
(see <a href="Bookmark.html">Bookmark</a>) (<strong>has_many</strong>)</p>
</li><li>
<p><strong>notifications</strong>: notifications of this user (see <a
href="Notification.html">Notification</a>) (<strong>has_many</strong>)</p>
</li><li>
<p><strong>likes</strong>: list of “I like you” registered by this user on
other users&#39; lessons (see <a href="Like.html">Like</a>)
(<strong>has_many</strong>)</p>
</li><li>
<p><strong>lessons</strong>: list of lessons created by this user (see <a
href="Lesson.html">Lesson</a>) (<strong>has_many</strong>)</p>
</li><li>
<p><strong>media_elements</strong>: list of elements loaded or created by this
user (includes also public elements, which are moved into the public
database of the application, but they still record who was the user who
first created them (see <a href="MediaElement.html">MediaElement</a>, <a
href="Audio.html">Audio</a>, <a href="Image.html">Image</a>, <a
href="Video.html">Video</a>) (<strong>has_many</strong>)</p>
</li><li>
<p><strong>reports</strong>: reports sent by this user about elements or
lessons (see <a href="Report.html">Report</a>) (<strong>has_many</strong>)</p>
</li><li>
<p><strong>users_subjects</strong>: list of instances of this subject
associated to this user through records of <a
href="UsersSubject.html">UsersSubject</a> (<strong>has_many</strong>)</p>
</li><li>
<p><strong>subjects</strong>: list of subjects associated to this user
(through the association <code>users_subjects</code>) (see <a
href="Subject.html">Subject</a>) (<strong>has_many</strong>)</p>
</li><li>
<p><strong>virtual_classroom_lessons</strong>: list of lessons present in the
user&#39;s Virtual Classroom (see <a
href="VirtualClassroomLesson.html">VirtualClassroomLesson</a>)
(<strong>has_many</strong>)</p>
</li><li>
<p><strong>mailing_list_groups</strong>: all the mailing list groups that this
user created (see <a href="MailingListGroup.html">MailingListGroup</a>)
(<strong>has_many</strong>)</p>
</li><li>
<p><strong>school_level</strong>: the <a
href="SchoolLevel.html">SchoolLevel</a> associated to this user
(<strong>belongs_to</strong>)</p>
</li><li>
<p><strong>location</strong>: the <a href="Location.html">Location</a>
associated to this user (<strong>belongs_to</strong>)</p>
</li></ul>

<h2 id="label-Validations">Validations</h2>
<ul><li>
<p><strong>presence</strong> of <code>email</code>, <code>name</code>,
<code>surname</code></p>
</li><li>
<p><strong>presence</strong> with numericality greater than 0 and presence of
associated element for <code>location_id</code> and
<code>school_level_id</code> (for the location, it&#39;s also checked that
the subclass is the last in the locations chain, see <a
href="Location.html">Location</a>)</p>
</li><li>
<p><strong>confirmation</strong> of <code>encrypted_password</code> (the
attribute password must coincide with its confirmation provided by the
user): this validation uses the private attribute
<code>password_confirmation</code>, associated to password</p>
</li><li>
<p><strong>presence</strong> of at least one associated record of <a
href="UsersSubject.html">UsersSubject</a></p>
</li><li>
<p><strong>uniqueness</strong> of <code>email</code></p>
</li><li>
<p><strong>length</strong> of <code>name</code> and <code>surname</code>
(maximum 255)</p>
</li><li>
<p><strong>length</strong> of the attribute password associated to
<code>encrypted_password</code> (the maximum is configured in settings.yml,
same as the minimum, but the minimum can be null, in which case the minimum
size is one character). Since this attribute doesn&#39;t correspond to a
field, the validation is forced only when the user is created: when the
user is updated, instead, the validation allows <code>nil</code> and
<code>blank</code> values, in case the user doesn&#39;t want to change his
password</p>
</li><li>
<p><strong>inclusion</strong> of <code>active</code> and
<code>confirmed</code> in [<code>true</code>, <code>false</code>]</p>
</li><li>
<p><strong>correctness</strong> of <code>email</code> as an e-mail address</p>
</li><li>
<p><strong>modifications</strong> <strong>not</strong>
<strong>available</strong> for <code>email</code> if the user is not a new
record</p>
</li><li>
<p><strong>acceptance</strong> of each policy configured in settings.yml</p>
</li></ul>

<h2 id="label-Callbacks">Callbacks</h2>
<ol><li>
<p><strong>before_destroy</strong> destroys associated instances of subjects
(see <a href="UsersSubject.html">UsersSubject</a>)</p>
</li></ol>

<h2 id="label-Database+callbacks">Database callbacks</h2>
<ol><li>
<p><strong>cascade</strong> <strong>destruction</strong> for the associated
table <a href="MailingListGroup.html">MailingListGroup</a></p>
</li></ol>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="ATTR_ACCESSIBLE">ATTR_ACCESSIBLE
        
        <dd class="description"><p>List of attributes to be made accessible (the list includes private
attributes that don&#39;t correspond to fields, for instance
<code>password_confirmation</code>)</p>
        
      
        <dt id="PASSWORD_LENGTH_CONSTRAINTS">PASSWORD_LENGTH_CONSTRAINTS
        
        <dd class="description"><p>Hash of constraints for the length of the password</p>
        
      
        <dt id="REGISTRATION_POLICIES">REGISTRATION_POLICIES
        
        <dd class="description"><p>List of registration policies, configured in settings.yml</p>
        
      
      </dl>
    </section>
    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-password" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">password</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>The attribute used as a handler for the field
<code>encrypted_password</code></p>
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-admin" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">admin</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-c-admin-label-Description">Description</h3>

<p>It returns an instance of the only super administrator</p>

<h3 id="method-c-admin-label-Returns">Returns</h3>

<p>An object of type <a href="User.html">User</a></p>
          

          
          <div class="method-source-code" id="admin-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 139</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">admin</span>
  <span class="ruby-identifier">find_by_email</span> <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;admin&#39;</span>][<span class="ruby-string">&#39;email&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- admin-source -->
          
        </div>

        

        
      </div><!-- admin-method -->

    
      <div id="method-c-get_full_names" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_full_names</span><span
            class="method-args">(term)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_full_names-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 817</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_full_names</span>(<span class="ruby-identifier">term</span>)
  <span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;email ILIKE ? OR name ILIKE ? OR surname ILIKE ?&#39;</span>,<span class="ruby-node">&quot;%#{term}%&quot;</span>,<span class="ruby-node">&quot;%#{term}%&quot;</span>,<span class="ruby-node">&quot;%#{term}%&quot;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;id, name || &#39; &#39; || surname AS value&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_full_names-source -->
          
        </div>

        

        
      </div><!-- get_full_names-method -->

    
      <div id="method-c-location_association_class" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">location_association_class</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-c-location_association_class-label-Description">Description</h3>

<p>Returns the class of the last <a href="Location.html">Location</a> class
(the one that must be attached to a user). The method is defined in this
model and not in <a href="Location.html">Location</a> because it&#39;s
necessary for the association <code>location</code></p>

<h3 id="method-c-location_association_class-label-Returns">Returns</h3>

<p>An object of type Class</p>
          

          
          <div class="method-source-code" id="location_association_class-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">location_association_class</span>
  <span class="ruby-constant">Location</span><span class="ruby-operator">::</span><span class="ruby-constant">SUBMODELS</span>.<span class="ruby-identifier">last</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- location_association_class-source -->
          
        </div>

        

        
      </div><!-- location_association_class-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-admin-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">admin?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-admin-3F-label-Description">Description</h3>

<p>It checks if the user is administrator or not (i.e., if the user is allowed
to enter in the administration module, see for instance <a
href="Admin/DashboardController.html">Admin::DashboardController</a>). TODO
important: at the moment only the super administrator is considered an
administrator: in future it&#39;ll be necessary to add to config.yml a list
of emails of administrators (or alternatively, to add a boolean field
<code>admin</code> to the table <code>users</code>). <strong>The method
must be changed without changing its name</strong>: it should return
something like</p>

<pre>self.super_admin? || SETTINGS[&#39;grant_admin_privileges&#39;].include?(self.email)</pre>

<h3 id="method-i-admin-3F-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="admin-3F-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 152</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">admin?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">super_admin?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- admin-3F-source -->
          
        </div>

        

        
      </div><!-- admin-3F-method -->

    
      <div id="method-i-admin_quick_uploading_cache" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">admin_quick_uploading_cache</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="admin_quick_uploading_cache-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 877</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">admin_quick_uploading_cache</span>
  <span class="ruby-keyword">return</span> [] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>))
  <span class="ruby-identifier">map</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>))
  <span class="ruby-identifier">index</span> = <span class="ruby-identifier">map</span>[<span class="ruby-value">:index</span>]
  <span class="ruby-keyword">return</span> [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">resp</span> = []
  <span class="ruby-identifier">index</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">map</span>[<span class="ruby-identifier">i</span>][<span class="ruby-value">:name</span>] = <span class="ruby-identifier">i</span>
    <span class="ruby-identifier">resp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">map</span>[<span class="ruby-identifier">i</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- admin_quick_uploading_cache-source -->
          
        </div>

        

        
      </div><!-- admin_quick_uploading_cache-method -->

    
      <div id="method-i-audio_editor_available" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">audio_editor_available</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-audio_editor_available-label-Description">Description</h3>

<p>Checks if the <a href="Audio.html">Audio</a> Editor is available (this is
true if there is no <a href="Audio.html">Audio</a> in conversion at the
moment); used in the filters of <a
href="AudioEditorController.html">AudioEditorController</a></p>

<h3 id="method-i-audio_editor_available-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="audio_editor_available-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 332</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">audio_editor_available</span>
  <span class="ruby-constant">Audio</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:converted</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">id</span>).<span class="ruby-identifier">all?</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">record</span><span class="ruby-operator">|</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">uploaded?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">record</span>.<span class="ruby-identifier">modified?</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- audio_editor_available-source -->
          
        </div>

        

        
      </div><!-- audio_editor_available-method -->

    
      <div id="method-i-audio_editor_cache" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">audio_editor_cache</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-audio_editor_cache-label-Description">Description</h3>

<p>Returns the current <a href="Audio.html">Audio</a> Editor cache for this
user</p>

<h3 id="method-i-audio_editor_cache-label-Returns">Returns</h3>

<p>A hash with parameters (for a sample structure, see <a
href="Media/Audio/Editing/Parameters.html#method-i-convert_parameters">Media::Audio::Editing::Parameters#convert_parameters</a>)</p>
          

          
          <div class="method-source-code" id="audio_editor_cache-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 202</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">audio_editor_cache</span>
  <span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:audio_editor_cache</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- audio_editor_cache-source -->
          
        </div>

        

        
      </div><!-- audio_editor_cache-method -->

    
      <div id="method-i-audio_editor_cache-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">audio_editor_cache!</span><span
            class="method-args">(cache = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-audio_editor_cache-21-label-Description">Description</h3>

<p>Saves the <a href="Audio.html">Audio</a> Editor cache; if the param is
<code>nil</code>, the cache is emptied</p>

<h3 id="method-i-audio_editor_cache-21-label-Args">Args</h3>
<ul><li>
<p><strong>cache</strong>: the cache to be saved (it must be a hash with the
structure defined in <a
href="Media/Audio/Editing/Parameters.html#method-i-convert_parameters">Media::Audio::Editing::Parameters#convert_parameters</a>;
if <code>nil</code> it empties the cache)</p>
</li></ul>
          

          
          <div class="method-source-code" id="audio_editor_cache-21-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">audio_editor_cache!</span>(<span class="ruby-identifier">cache</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">update_attribute</span> <span class="ruby-value">:metadata</span>, <span class="ruby-constant">OpenStruct</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">marshal_dump</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">audio_editor_cache</span><span class="ruby-operator">:</span> <span class="ruby-identifier">cache</span>))
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- audio_editor_cache-21-source -->
          
        </div>

        

        
      </div><!-- audio_editor_cache-21-method -->

    
      <div id="method-i-base_location" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">base_location</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-base_location-label-Description">Description</h3>

<p>Method used in the front end that returns the name of the first <a
href="Location.html">Location</a> attached to the user</p>

<h3 id="method-i-base_location-label-Returns">Returns</h3>

<p>A string</p>
          

          
          <div class="method-source-code" id="base_location-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 282</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">base_location</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">name</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- base_location-source -->
          
        </div>

        

        
      </div><!-- base_location-method -->

    
      <div id="method-i-bookmark" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bookmark</span><span
            class="method-args">(type, target_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="bookmark-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 660</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bookmark</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">target_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-identifier">b</span> = <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bookmarkable_type</span> = <span class="ruby-identifier">type</span>
  <span class="ruby-identifier">b</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bookmarkable_id</span> = <span class="ruby-identifier">target_id</span>
  <span class="ruby-identifier">b</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- bookmark-source -->
          
        </div>

        

        
      </div><!-- bookmark-method -->

    
      <div id="method-i-create_lesson" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_lesson</span><span
            class="method-args">(title, description, subject_id, tags)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="create_lesson-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 742</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_lesson</span>(<span class="ruby-identifier">title</span>, <span class="ruby-identifier">description</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">tags</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">UsersSubject</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:subject_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">subject_id</span>).<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">lesson</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">new</span> <span class="ruby-value">:subject_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">subject_id</span>, <span class="ruby-value">:school_level_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">school_level_id</span>, <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">description</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">copied_not_modified</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">tags</span> = <span class="ruby-identifier">tags</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">validating_in_form</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">valid?</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:subject_id</span>, <span class="ruby-value">:is_not_your_subject</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">errors</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">lesson</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">new</span> <span class="ruby-value">:subject_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">subject_id</span>, <span class="ruby-value">:school_level_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">school_level_id</span>, <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">description</span>
  <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">copied_not_modified</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">tags</span> = <span class="ruby-identifier">tags</span>
  <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">validating_in_form</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">save</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">lesson</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">errors</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_lesson-source -->
          
        </div>

        

        
      </div><!-- create_lesson-method -->

    
      <div id="method-i-destroy_notification_and_reload" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy_notification_and_reload</span><span
            class="method-args">(notification_id, offset)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="destroy_notification_and_reload-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 702</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy_notification_and_reload</span>(<span class="ruby-identifier">notification_id</span>, <span class="ruby-identifier">offset</span>)
  <span class="ruby-identifier">notification_id</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">notification_id</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">notification_id</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">offset</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">offset</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">offset</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">n</span> = <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">notification_id</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">n</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-identifier">resp_last</span> = <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;created_at DESC&#39;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">resp_offset</span> = <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">count</span>
    <span class="ruby-identifier">resp_last</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> ([<span class="ruby-identifier">resp_offset</span>, <span class="ruby-identifier">resp_offset</span>] <span class="ruby-operator">!=</span> [<span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;notifications_loaded_together&#39;</span>], <span class="ruby-identifier">offset</span>])
    <span class="ruby-identifier">resp</span> = {<span class="ruby-value">:last</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resp_last</span>, <span class="ruby-value">:offset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resp_offset</span>}
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- destroy_notification_and_reload-source -->
          
        </div>

        

        
      </div><!-- destroy_notification_and_reload-method -->

    
      <div id="method-i-destroy_with_dependencies" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy_with_dependencies</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="destroy_with_dependencies-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 767</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy_with_dependencies</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">super_admin?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">l</span>.<span class="ruby-identifier">destroy_with_notifications</span>
          <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
          <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">UsersSubject</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">us</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">us</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">me</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">me</span>.<span class="ruby-identifier">is_public</span>
          <span class="ruby-identifier">me</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">admin</span>.<span class="ruby-identifier">id</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">me</span>.<span class="ruby-identifier">save</span>
            <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
            <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">me</span>.<span class="ruby-identifier">destroy</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">b</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">n</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">Like</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">l</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">Report</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidForeignKey</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- destroy_with_dependencies-source -->
          
        </div>

        

        
      </div><!-- destroy_with_dependencies-method -->

    
      <div id="method-i-dislike" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dislike</span><span
            class="method-args">(lesson_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-dislike-label-Description">Description</h3>

<p>Removes a &#39;I like you&#39; that the user had formerly assigned to a <a
href="Lesson.html">Lesson</a></p>

<h3 id="method-i-dislike-label-Args">Args</h3>
<ul><li>
<p><strong>lesson_id</strong>: the id of the lesson tha the user doesn&#39;t
appreciate anymore</p>
</li></ul>

<h3 id="method-i-dislike-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="dislike-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 551</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dislike</span>(<span class="ruby-identifier">lesson_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">lesson_id</span>)
  <span class="ruby-identifier">like</span> = <span class="ruby-constant">Like</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lesson_id</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">like</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">like</span>.<span class="ruby-identifier">destroy</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Like</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lesson_id</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- dislike-source -->
          
        </div>

        

        
      </div><!-- dislike-method -->

    
      <div id="method-i-empty_playlist" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">empty_playlist</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="empty_playlist-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 675</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">empty_playlist</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;user_id = ? AND position IS NOT NULL&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;position DESC&#39;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">vcl</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">vcl</span>.<span class="ruby-identifier">position</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">vcl</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- empty_playlist-source -->
          
        </div>

        

        
      </div><!-- empty_playlist-method -->

    
      <div id="method-i-empty_virtual_classroom" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">empty_virtual_classroom</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="empty_virtual_classroom-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 669</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">empty_virtual_classroom</span>
  <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">vcl</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">vcl</span>.<span class="ruby-identifier">destroy</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- empty_virtual_classroom-source -->
          
        </div>

        

        
      </div><!-- empty_virtual_classroom-method -->

    
      <div id="method-i-full_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">full_name</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-full_name-label-Description">Description</h3>

<p>Method used in the front end as a shortcut to show the full name of the
user</p>

<h3 id="method-i-full_name-label-Returns">Returns</h3>

<p>A string</p>
          

          
          <div class="method-source-code" id="full_name-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 270</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">full_name</span>
  <span class="ruby-node">&quot;#{self.name} #{self.surname}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- full_name-source -->
          
        </div>

        

        
      </div><!-- full_name-method -->

    
      <div id="method-i-full_virtual_classroom" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">full_virtual_classroom</span><span
            class="method-args">(page, per_page)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="full_virtual_classroom-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 688</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">full_virtual_classroom</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">per_page</span>)
  <span class="ruby-identifier">page</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">for_page</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">for_page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">for_page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">offset</span> = (<span class="ruby-identifier">page</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) * <span class="ruby-identifier">per_page</span>
  <span class="ruby-identifier">resp</span> = {}
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:pages_amount</span>] = <span class="ruby-constant">Rational</span>(<span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>, <span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] = <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:lesson</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;created_at DESC&#39;</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">per_page</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- full_virtual_classroom-source -->
          
        </div>

        

        
      </div><!-- full_virtual_classroom-method -->

    
      <div id="method-i-like" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">like</span><span
            class="method-args">(lesson_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-like-label-Description">Description</h3>

<p>Saves a &#39;I like you&#39; for a <a href="Lesson.html">Lesson</a></p>

<h3 id="method-i-like-label-Args">Args</h3>
<ul><li>
<p><strong>lesson_id</strong>: the id of the lesson that the user appreciates</p>
</li></ul>

<h3 id="method-i-like-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="like-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 530</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">like</span>(<span class="ruby-identifier">lesson_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">lesson_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Like</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lesson_id</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">any?</span>
  <span class="ruby-identifier">l</span> = <span class="ruby-constant">Like</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">l</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-identifier">l</span>.<span class="ruby-identifier">lesson_id</span> = <span class="ruby-identifier">lesson_id</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- like-source -->
          
        </div>

        

        
      </div><!-- like-method -->

    
      <div id="method-i-new_mailing_list_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new_mailing_list_name</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-new_mailing_list_name-label-Description">Description</h3>

<p>Creates a temporary unique new name for a <a
href="MailingListGroup.html">MailingListGroup</a> (used in
MailingListController#create_group)</p>

<h3 id="method-i-new_mailing_list_name-label-Returns">Returns</h3>

<p>A string</p>
          

          
          <div class="method-source-code" id="new_mailing_list_name-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 226</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new_mailing_list_name</span>
  <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;users.mailing_list.label&#39;</span>, <span class="ruby-value">:number</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-constant">MailingListGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- new_mailing_list_name-source -->
          
        </div>

        

        
      </div><!-- new_mailing_list_name-method -->

    
      <div id="method-i-notifications_visible_block" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">notifications_visible_block</span><span
            class="method-args">(offset, limit)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="notifications_visible_block-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 718</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">notifications_visible_block</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">limit</span>)
  <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;created_at DESC&#39;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- notifications_visible_block-source -->
          
        </div>

        

        
      </div><!-- notifications_visible_block-method -->

    
      <div id="method-i-number_notifications_not_seen" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">number_notifications_not_seen</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="number_notifications_not_seen-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 722</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">number_notifications_not_seen</span>
  <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:seen</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- number_notifications_not_seen-source -->
          
        </div>

        

        
      </div><!-- number_notifications_not_seen-method -->

    
      <div id="method-i-own_lessons" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">own_lessons</span><span
            class="method-args">(page, per_page, filter=Filters::ALL_LESSONS)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-own_lessons-label-Description">Description</h3>

<p>Extracts the lessons present in the user&#39;s personal section (see <a
href="LessonsController.html#method-i-index">LessonsController#index</a>):
the method uses the scope <code>of</code> defined in <a
href="Lesson.html">Lesson</a>, and applies filters on it. Each lesson has
its status set with <a
href="Lesson.html#method-i-set_status">Lesson#set_status</a>.</p>

<h3 id="method-i-own_lessons-label-Args">Args</h3>
<ul><li>
<p><strong>page</strong>: pagination parameter</p>
</li><li>
<p><strong>per_page</strong>: pagination parameter</p>
</li><li>
<p><strong>filter</strong>: an additional filter defined in <a
href="Filters.html">Filters</a></p>
</li></ul>

<h3 id="method-i-own_lessons-label-Returns">Returns</h3>

<p>A hash with the following keys:</p>
<ul><li>
<p><strong>records</strong>: the effective content of the research, an array
of object of type <a href="Lesson.html">Lesson</a></p>
</li><li>
<p><strong>pages_amount</strong>: an integer, the total number of pages in the
method&#39;s result</p>
</li></ul>
          

          
          <div class="method-source-code" id="own_lessons-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 608</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">own_lessons</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">filter</span>=<span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span>)
  <span class="ruby-identifier">page</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">for_page</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">for_page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">for_page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">offset</span> = (<span class="ruby-identifier">page</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) * <span class="ruby-identifier">per_page</span>
  <span class="ruby-identifier">relation</span> = 
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">PRIVATE</span>
      <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">is_public</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;updated_at DESC&#39;</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLIC</span>
      <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">of</span>(<span class="ruby-keyword">self</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_public</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">LINKED</span>
      <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:bookmarks</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">bookmarks</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span> }).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;bookmarks.created_at DESC&#39;</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ONLY_MINE</span>
      <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;updated_at DESC&#39;</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">COPIED</span>
      <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:copied_not_modified</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;updated_at DESC&#39;</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span>
      <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">of</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&#39;filter not supported&#39;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">pages_amount</span> = <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">relation</span>.<span class="ruby-identifier">count</span>, <span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-identifier">resp</span> = []
  <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">lesson</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">resp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">lesson</span>
  <span class="ruby-keyword">end</span>
  {<span class="ruby-value">:records</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resp</span>, <span class="ruby-value">:pages_amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pages_amount</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- own_lessons-source -->
          
        </div>

        

        
      </div><!-- own_lessons-method -->

    
      <div id="method-i-own_mailing_list_groups" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">own_mailing_list_groups</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-own_mailing_list_groups-label-Description">Description</h3>

<p>Alternative to the association <code>mailing_list_groups</code>, that sorts
the groups by name</p>

<h3 id="method-i-own_mailing_list_groups-label-Returns">Returns</h3>

<p>An array of objects of kind <a
href="MailingListGroup.html">MailingListGroup</a></p>
          

          
          <div class="method-source-code" id="own_mailing_list_groups-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 214</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">own_mailing_list_groups</span>
  <span class="ruby-constant">MailingListGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:name</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- own_mailing_list_groups-source -->
          
        </div>

        

        
      </div><!-- own_mailing_list_groups-method -->

    
      <div id="method-i-own_media_elements" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">own_media_elements</span><span
            class="method-args">(page, per_page, filter=Filters::ALL_MEDIA_ELEMENTS)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-own_media_elements-label-Description">Description</h3>

<p>Extracts the elements present in the user&#39;s personal section (see <a
href="MediaElementsController.html#method-i-index">MediaElementsController#index</a>):
the method uses the scope <code>of</code> defined in <a
href="MediaElement.html">MediaElement</a>, and applies filters on it. Each
element has its status set with <a
href="MediaElement.html#method-i-set_status">MediaElement#set_status</a>.</p>

<h3 id="method-i-own_media_elements-label-Args">Args</h3>
<ul><li>
<p><strong>page</strong>: pagination parameter</p>
</li><li>
<p><strong>per_page</strong>: pagination parameter</p>
</li><li>
<p><strong>filter</strong>: an additional filter defined in <a
href="Filters.html">Filters</a></p>
</li></ul>

<h3 id="method-i-own_media_elements-label-Returns">Returns</h3>

<p>A hash with the following keys:</p>
<ul><li>
<p><strong>records</strong>: the effective content of the research, an array
of object of type <a href="MediaElement.html">MediaElement</a></p>
</li><li>
<p><strong>pages_amount</strong>: an integer, the total number of pages in the
method&#39;s result</p>
</li></ul>
          

          
          <div class="method-source-code" id="own_media_elements-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 575</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">own_media_elements</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">filter</span>=<span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_MEDIA_ELEMENTS</span>)
  <span class="ruby-identifier">page</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">for_page</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">for_page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">for_page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">offset</span> = (<span class="ruby-identifier">page</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) * <span class="ruby-identifier">per_page</span>
  <span class="ruby-identifier">relation</span> = <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">of</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-keyword">if</span> [<span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">VIDEO</span>, <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">AUDIO</span>, <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAGE</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;sti_type = ?&#39;</span>, <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">capitalize</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">pages_amount</span> = <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">relation</span>.<span class="ruby-identifier">count</span>, <span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-identifier">resp</span> = []
  <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">per_page</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">me</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">me</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">resp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">me</span>
  <span class="ruby-keyword">end</span>
  {<span class="ruby-value">:records</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resp</span>, <span class="ruby-value">:pages_amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pages_amount</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- own_media_elements-source -->
          
        </div>

        

        
      </div><!-- own_media_elements-method -->

    
      <div id="method-i-parent_locations" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parent_locations</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-parent_locations-label-Description">Description</h3>

<p>Used in the front end, it returns a resume of all the parents locations of
the user</p>

<h3 id="method-i-parent_locations-label-Returns">Returns</h3>

<p>A string</p>
          

          
          <div class="method-source-code" id="parent_locations-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 294</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parent_locations</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">first</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">current_location</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">location</span>
  (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;location_types&#39;</span>].<span class="ruby-identifier">length</span>).<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_location</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;location_types&#39;</span>].<span class="ruby-identifier">last</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">first</span>
        <span class="ruby-identifier">resp</span> = <span class="ruby-node">&quot;#{current_location.name}&quot;</span>
        <span class="ruby-identifier">first</span> = <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">resp</span> = <span class="ruby-node">&quot;#{resp} - #{current_location.name}&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">current_location</span> = <span class="ruby-identifier">current_location</span>.<span class="ruby-identifier">parent</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- parent_locations-source -->
          
        </div>

        

        
      </div><!-- parent_locations-method -->

    
      <div id="method-i-playlist" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">playlist</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="playlist-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 730</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">playlist</span>
  <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:lesson</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;user_id = ? AND position IS NOT NULL&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:position</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- playlist-source -->
          
        </div>

        

        
      </div><!-- playlist-method -->

    
      <div id="method-i-playlist_for_viewer" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">playlist_for_viewer</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="playlist_for_viewer-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 734</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">playlist_for_viewer</span>
  <span class="ruby-identifier">resp</span> = []
  <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:lesson</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;user_id = ? AND position IS NOT NULL&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:position</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">vc</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">resp</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">vc</span>.<span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">slides</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:position</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- playlist_for_viewer-source -->
          
        </div>

        

        
      </div><!-- playlist_for_viewer-method -->

    
      <div id="method-i-playlist_full-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">playlist_full?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="playlist_full-3F-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 726</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">playlist_full?</span>
  <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;user_id = ? AND position IS NOT NULL&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;lessons_in_playlist&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- playlist_full-3F-source -->
          
        </div>

        

        
      </div><!-- playlist_full-3F-method -->

    
      <div id="method-i-registration_policies" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">registration_policies</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-registration_policies-label-Description">Description</h3>

<p>Manual attr_reader for the constant <a
href="User.html#REGISTRATION_POLICIES">REGISTRATION_POLICIES</a>, that
contains all the policies as configured in settings.yml</p>
          

          
          <div class="method-source-code" id="registration_policies-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 234</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">registration_policies</span>
  <span class="ruby-constant">REGISTRATION_POLICIES</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- registration_policies-source -->
          
        </div>

        

        
      </div><!-- registration_policies-method -->

    
      <div id="method-i-remove_from_admin_quick_uploading_cache" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_from_admin_quick_uploading_cache</span><span
            class="method-args">(name)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="remove_from_admin_quick_uploading_cache-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 821</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_from_admin_quick_uploading_cache</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>))
  <span class="ruby-identifier">map</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>)))
  <span class="ruby-identifier">item</span> = <span class="ruby-identifier">map</span>[<span class="ruby-identifier">name</span>]
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/#{name}#{item[:ext]}&quot;</span>)
  <span class="ruby-identifier">map</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">name</span>
  <span class="ruby-identifier">map</span>[<span class="ruby-value">:index</span>].<span class="ruby-identifier">delete</span> <span class="ruby-identifier">name</span>
  <span class="ruby-identifier">yaml</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>), <span class="ruby-string">&#39;w&#39;</span>)
  <span class="ruby-identifier">yaml</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">map</span>.<span class="ruby-identifier">to_yaml</span>
  <span class="ruby-identifier">yaml</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- remove_from_admin_quick_uploading_cache-source -->
          
        </div>

        

        
      </div><!-- remove_from_admin_quick_uploading_cache-method -->

    
      <div id="method-i-report_lesson" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">report_lesson</span><span
            class="method-args">(lesson_id, msg)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-report_lesson-label-Description">Description</h3>

<p>Sends a <a href="Report.html">Report</a> for a <a
href="Lesson.html">Lesson</a></p>

<h3 id="method-i-report_lesson-label-Args">Args</h3>
<ul><li>
<p><strong>lesson_id</strong>: id of the lesson to be reported</p>
</li><li>
<p><strong>msg</strong>: the attached message</p>
</li></ul>

<h3 id="method-i-report_lesson-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="report_lesson-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 461</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">report_lesson</span>(<span class="ruby-identifier">lesson_id</span>, <span class="ruby-identifier">msg</span>)
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_reporting</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Report</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">reportable_type</span> = <span class="ruby-string">&#39;Lesson&#39;</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">reportable_id</span> = <span class="ruby-identifier">lesson_id</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-identifier">msg</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">r</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">added?</span> <span class="ruby-value">:reportable_id</span>, <span class="ruby-value">:taken</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:lesson_already_reported</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_reporting</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- report_lesson-source -->
          
        </div>

        

        
      </div><!-- report_lesson-method -->

    
      <div id="method-i-report_media_element" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">report_media_element</span><span
            class="method-args">(media_element_id, msg)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-report_media_element-label-Description">Description</h3>

<p>Sends a <a href="Report.html">Report</a> for a <a
href="MediaElement.html">MediaElement</a></p>

<h3 id="method-i-report_media_element-label-Args">Args</h3>
<ul><li>
<p><strong>media_element_id</strong>: id of the element to be reported</p>
</li><li>
<p><strong>msg</strong>: the attached message</p>
</li></ul>

<h3 id="method-i-report_media_element-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="report_media_element-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 496</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">report_media_element</span>(<span class="ruby-identifier">media_element_id</span>, <span class="ruby-identifier">msg</span>)
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_reporting</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Report</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">reportable_type</span> = <span class="ruby-string">&#39;MediaElement&#39;</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">reportable_id</span> = <span class="ruby-identifier">media_element_id</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-identifier">msg</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">r</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">added?</span> <span class="ruby-value">:reportable_id</span>, <span class="ruby-value">:taken</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:media_element_already_reported</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_reporting</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- report_media_element-source -->
          
        </div>

        

        
      </div><!-- report_media_element-method -->

    
      <div id="method-i-reset_password-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset_password!</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-reset_password-21-label-Description">Description</h3>

<p>Resets the attributes <code>password</code> e
<code>password_confirmation</code> with a new random string (used in <a
href="UsersController.html#method-i-reset_password">UsersController#reset_password</a>)</p>

<h3 id="method-i-reset_password-21-label-Returns">Returns</h3>

<p>A string (the new password)</p>
          

          
          <div class="method-source-code" id="reset_password-21-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 246</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_password!</span>
  <span class="ruby-identifier">new_password</span> = <span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">urlsafe_base64</span>(<span class="ruby-value">10</span>)
  <span class="ruby-identifier">update_attributes!</span>(<span class="ruby-value">:password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">new_password</span>, <span class="ruby-value">:password_confirmation</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">new_password</span>)
  <span class="ruby-identifier">new_password</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- reset_password-21-source -->
          
        </div>

        

        
      </div><!-- reset_password-21-method -->

    
      <div id="method-i-save_in_admin_quick_uploading_cache" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_in_admin_quick_uploading_cache</span><span
            class="method-args">(file, title=nil, description=nil, tags=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="save_in_admin_quick_uploading_cache-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 835</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_in_admin_quick_uploading_cache</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">title</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">description</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">tags</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">filetype</span> = <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">filetype</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filetype</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;public/admin&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;public/admin&#39;</span>))
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}&quot;</span>))
  <span class="ruby-identifier">extension</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>
  <span class="ruby-identifier">map</span> = {}
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>))
    <span class="ruby-identifier">map</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>)))
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_r</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}&quot;</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">name</span> = <span class="ruby-node">&quot;a#{SecureRandom.urlsafe_base64(15)}&quot;</span>
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">map</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-value">:&quot;#{name}&quot;</span>
    <span class="ruby-identifier">name</span> = <span class="ruby-node">&quot;a#{SecureRandom.urlsafe_base64(15)}&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">map</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-value">:index</span>
    <span class="ruby-identifier">map</span>[<span class="ruby-value">:index</span>].<span class="ruby-identifier">unshift</span> <span class="ruby-value">:&quot;#{name}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">map</span>[<span class="ruby-value">:index</span>] = [<span class="ruby-value">:&quot;#{name}&quot;</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">map</span>[<span class="ruby-value">:&quot;#{name}&quot;</span>] = {<span class="ruby-value">:ext</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">extension</span>, <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filetype</span>}
  <span class="ruby-identifier">map</span>[<span class="ruby-value">:&quot;#{name}&quot;</span>][<span class="ruby-value">:original_name</span>] = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>
  <span class="ruby-identifier">map</span>[<span class="ruby-value">:&quot;#{name}&quot;</span>][<span class="ruby-value">:title</span>] = <span class="ruby-identifier">title</span>
  <span class="ruby-identifier">map</span>[<span class="ruby-value">:&quot;#{name}&quot;</span>][<span class="ruby-value">:description</span>] = <span class="ruby-identifier">description</span>
  <span class="ruby-identifier">map</span>[<span class="ruby-value">:&quot;#{name}&quot;</span>][<span class="ruby-value">:tags</span>] = <span class="ruby-identifier">tags</span>
  <span class="ruby-identifier">yaml</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/map.yml&quot;</span>), <span class="ruby-string">&#39;w&#39;</span>)
  <span class="ruby-identifier">yaml</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">map</span>.<span class="ruby-identifier">to_yaml</span>
  <span class="ruby-identifier">yaml</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">path</span>, <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-node">&quot;public/admin/#{self.id}/#{name}#{extension}&quot;</span>)
  {
    <span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:&quot;#{name}&quot;</span>,
    <span class="ruby-value">:ext</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">extension</span>,
    <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filetype</span>,
    <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title</span>,
    <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">description</span>,
    <span class="ruby-value">:tags</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">tags</span>,
    <span class="ruby-value">:original_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- save_in_admin_quick_uploading_cache-source -->
          
        </div>

        

        
      </div><!-- save_in_admin_quick_uploading_cache-method -->

    
      <div id="method-i-search_lessons" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_lessons</span><span
            class="method-args">(word, page, for_page, order=nil, filter=nil, subject_id=nil, only_tags=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-search_lessons-label-Description">Description</h3>

<p>Global method used to search for lessons (see <a
href="SearchController.html#method-i-index">SearchController#index</a>).</p>
<ul><li>
<p><strong>first</strong>, it checks the correctness of all the parameters
received;</p>
</li><li>
<p><strong>then</strong>, if <code>word</code> is blank, it calls just <a
href="User.html#method-i-search_lessons_without_tag">#search_lessons_without_tag</a>,
that search using the other parameters inserted by the user</p>
</li><li>
<p><strong>otherwise</strong>, it checks if the word is a Fixnum (it
represents the id of a specific <a href="Tag.html">Tag</a>) or a String (it
represents a word to be matched against the list of registered tags)</p>
<ul><li>
<p>if <code>word</code> is a Fixnum, the method just calls <a
href="User.html#method-i-search_lessons_with_tag">#search_lessons_with_tag</a>,
which returns only the lessons associated to that particular <a
href="Tag.html">Tag</a> (of course, filtered by the other parameters)</p>
</li><li>
<p>if <code>word</code> is a String, the method calls <a
href="User.html#method-i-search_lessons_with_tag">#search_lessons_with_tag</a>
(that returns the lessons found) and <a
href="User.html#method-i-get_tags_associated_to_lesson_search">#get_tags_associated_to_lesson_search</a>
(that returns the list of tags associated to the search)</p>
</li></ul>
</li><li>
<p>there is also the available option <code>only_tags</code>: if this option
is used with a <code>word</code> of type String, the method calls only <a
href="User.html#method-i-get_tags_associated_to_lesson_search">#get_tags_associated_to_lesson_search</a>
(this option is typically used when the user is filtering a previous search
by a specific Tag: in this case, calling only the method with
<code>word</code> = Fixnum, there would be no way to know the previous list
of tags, hence in the controller the method is called again with
<code>word</code> = String and with <code>only_tags</code> = true)</p>
</li></ul>

<h3 id="method-i-search_lessons-label-Args">Args</h3>
<ul><li>
<p><strong>word</strong>: the search parameter. It can be:</p>
<ul><li>
<p><code>blank</code> if you need only to search by filters</p>
</li><li>
<p><code>integer</code> if you want to filter by a specific tag</p>
</li><li>
<p><code>string</code> if you want to match a keyword against the list of tags
in the database</p>
</li></ul>
</li><li>
<p><strong>page</strong>: pagination parameter</p>
</li><li>
<p><strong>for_page</strong>: pagination parameter</p>
</li><li>
<p><strong>order</strong>: one of the keywords defined in <a
href="SearchOrders.html">SearchOrders</a></p>
</li><li>
<p><strong>filter</strong>: one of the keywords defined in <a
href="Filters.html">Filters</a></p>
</li><li>
<p><strong>subject_id</strong>: the id of a <a
href="Subject.html">Subject</a>, this extends the filter to lessons
associated to that subject</p>
</li><li>
<p><strong>only_tags</strong>: optional boolean, if used with a
<code>word</code> of kind String returns only the list of tags associated
to the search</p>
</li></ul>

<h3 id="method-i-search_lessons-label-Returns">Returns</h3>

<p>A hash with the following keys:</p>
<ul><li>
<p><strong>records</strong>: the effective content of the research, an array
of object of type <a href="Lesson.html">Lesson</a></p>
</li><li>
<p><strong>records_amount</strong>: an integer, the total number of lessons
found</p>
</li><li>
<p><strong>pages_amount</strong>: an integer, the total number of pages in the
search result</p>
</li><li>
<p><strong>tags</strong>: if required, an array of objects of type <a
href="Tag.html">Tag</a>. This is the list of the first 20 tags associated
to at least a lesson in the search result, ordered by numbers of
occurrences among the search results (i.e. order of relevance)</p>
</li></ul>
          

          
          <div class="method-source-code" id="search_lessons-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 422</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_lessons</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">page</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">order</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">filter</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">subject_id</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">only_tags</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">only_tags</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">only_tags</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">page</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">for_page</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">for_page</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">for_page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">subject_id</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>[<span class="ruby-constant">NilClass</span>, <span class="ruby-constant">Fixnum</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">subject_id</span>.<span class="ruby-identifier">class</span>)
  <span class="ruby-identifier">filter</span> = <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">LESSONS_SEARCH_SET</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">filter</span>)
  <span class="ruby-identifier">order</span> = <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">UPDATED_AT</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">LESSONS_SET</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">order</span>)
  <span class="ruby-identifier">offset</span> = (<span class="ruby-identifier">page</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) * <span class="ruby-identifier">for_page</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">search_lessons_without_tag</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">order</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span>
      <span class="ruby-identifier">word</span> = <span class="ruby-identifier">word</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">only_tags</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">get_tags_associated_to_lesson_search</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">search_lessons_with_tag</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">order</span>)
        <span class="ruby-identifier">resp</span>[<span class="ruby-value">:tags</span>] = <span class="ruby-identifier">get_tags_associated_to_lesson_search</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">search_lessons_with_tag</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">order</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_lessons-source -->
          
        </div>

        

        
      </div><!-- search_lessons-method -->

    
      <div id="method-i-search_media_elements" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_media_elements</span><span
            class="method-args">(word, page, for_page, order=nil, filter=nil, only_tags=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-search_media_elements-label-Description">Description</h3>

<p>Global method used to search for elements (see <a
href="SearchController.html#method-i-index">SearchController#index</a>).</p>
<ul><li>
<p><strong>first</strong>, it checks the correctness of all the parameters
received;</p>
</li><li>
<p><strong>then</strong>, if <code>word</code> is blank, it calls just <a
href="User.html#method-i-search_media_elements_without_tag">#search_media_elements_without_tag</a>,
that search using the other parameters inserted by the user</p>
</li><li>
<p><strong>otherwise</strong>, it checks if the word is a Fixnum (it
represents the id of a specific <a href="Tag.html">Tag</a>) or a String (it
represents a word to be matched against the list of registered tags)</p>
<ul><li>
<p>if <code>word</code> is a Fixnum, the method just calls <a
href="User.html#method-i-search_media_elements_with_tag">#search_media_elements_with_tag</a>,
which returns only the elements associated to that particular <a
href="Tag.html">Tag</a> (of course, filtered by the other parameters)</p>
</li><li>
<p>if <code>word</code> is a String, the method calls <a
href="User.html#method-i-search_media_elements_with_tag">#search_media_elements_with_tag</a>
(that returns the media elements found) and <a
href="User.html#method-i-get_tags_associated_to_media_element_search">#get_tags_associated_to_media_element_search</a>
(that returns the list of tags associated to the search)</p>
</li></ul>
</li><li>
<p>there is also the available option <code>only_tags</code>: if this option
is used with a <code>word</code> of type String, the method calls only <a
href="User.html#method-i-get_tags_associated_to_media_element_search">#get_tags_associated_to_media_element_search</a>
(this option is typically used when the user is filtering a previous search
by a specific Tag: in this case, calling only the method with
<code>word</code> = Fixnum, there would be no way to know the previous list
of tags, hence in the controller the method is called again with
<code>word</code> = String and with <code>only_tags</code> = true)</p>
</li></ul>

<h3 id="method-i-search_media_elements-label-Args">Args</h3>
<ul><li>
<p><strong>word</strong>: the search parameter. It can be:</p>
<ul><li>
<p><code>blank</code> if you need only to search by filters</p>
</li><li>
<p><code>integer</code> if you want to filter by a specific tag</p>
</li><li>
<p><code>string</code> if you want to match a keyword against the list of tags
in the database</p>
</li></ul>
</li><li>
<p><strong>page</strong>: pagination parameter</p>
</li><li>
<p><strong>for_page</strong>: pagination parameter</p>
</li><li>
<p><strong>order</strong>: one of the keywords defined in <a
href="SearchOrders.html">SearchOrders</a></p>
</li><li>
<p><strong>filter</strong>: one of the keywords defined in <a
href="Filters.html">Filters</a></p>
</li><li>
<p><strong>only_tags</strong>: optional boolean, if used with a
<code>word</code> of kind String returns only the list of tags associated
to the search</p>
</li></ul>

<h3 id="method-i-search_media_elements-label-Returns">Returns</h3>

<p>A hash with the following keys:</p>
<ul><li>
<p><strong>records</strong>: the effective content of the research, an array
of object of type <a href="MediaElement.html">MediaElement</a></p>
</li><li>
<p><strong>records_amount</strong>: an integer, the total number of elements
found</p>
</li><li>
<p><strong>pages_amount</strong>: an integer, the total number of pages in the
search result</p>
</li><li>
<p><strong>tags</strong>: if required, an array of objects of type <a
href="Tag.html">Tag</a>. This is the list of the first 20 tags associated
to at least an element in the search result, ordered by numbers of
occurrences among the search results (i.e. order of relevance)</p>
</li></ul>
          

          
          <div class="method-source-code" id="search_media_elements-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 366</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_media_elements</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">page</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">order</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">filter</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">only_tags</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">only_tags</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">only_tags</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">page</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">for_page</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">for_page</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">for_page</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">filter</span> = <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_MEDIA_ELEMENTS</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">MEDIA_ELEMENTS_SEARCH_SET</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">filter</span>)
  <span class="ruby-identifier">order</span> = <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">UPDATED_AT</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">MEDIA_ELEMENTS_SET</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">order</span>)
  <span class="ruby-identifier">offset</span> = (<span class="ruby-identifier">page</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) * <span class="ruby-identifier">for_page</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">search_media_elements_without_tag</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">order</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span>
      <span class="ruby-identifier">word</span> = <span class="ruby-identifier">word</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">only_tags</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">get_tags_associated_to_media_element_search</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">filter</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">search_media_elements_with_tag</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">order</span>)
        <span class="ruby-identifier">resp</span>[<span class="ruby-value">:tags</span>] = <span class="ruby-identifier">get_tags_associated_to_media_element_search</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">filter</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">search_media_elements_with_tag</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">for_page</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">order</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_media_elements-source -->
          
        </div>

        

        
      </div><!-- search_media_elements-method -->

    
      <div id="method-i-subject_ids-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">subject_ids=</span><span
            class="method-args">(subject_ids)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-subject_ids-3D-label-Description">Description</h3>

<p>Sets the subjects associated to this user (see <a
href="UsersSubject.html">UsersSubject</a>)</p>
          

          
          <div class="method-source-code" id="subject_ids-3D-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 256</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">subject_ids=</span>(<span class="ruby-identifier">subject_ids</span>)
  <span class="ruby-identifier">users_subjects</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-identifier">subject_ids</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span> <span class="ruby-identifier">users_subjects</span>.<span class="ruby-identifier">build</span> <span class="ruby-value">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>, <span class="ruby-value">:subject_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">id</span> } <span class="ruby-keyword">if</span> <span class="ruby-identifier">subject_ids</span>
  <span class="ruby-identifier">subject_ids</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- subject_ids-3D-source -->
          
        </div>

        

        
      </div><!-- subject_ids-3D-method -->

    
      <div id="method-i-suggested_lessons" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">suggested_lessons</span><span
            class="method-args">(n)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="suggested_lessons-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 638</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">suggested_lessons</span>(<span class="ruby-identifier">n</span>)
  <span class="ruby-identifier">n</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">subject_ids</span> = []
  <span class="ruby-constant">UsersSubject</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">us</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">subject_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">us</span>.<span class="ruby-identifier">subject_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? AND user_id != ? AND subject_id IN (?) AND NOT EXISTS (SELECT * FROM bookmarks WHERE bookmarks.bookmarkable_type = ? AND bookmarks.bookmarkable_id = lessons.id AND bookmarks.user_id = ?)&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">subject_ids</span>, <span class="ruby-string">&#39;Lesson&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;updated_at DESC&#39;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">n</span>)
  <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">l</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- suggested_lessons-source -->
          
        </div>

        

        
      </div><!-- suggested_lessons-method -->

    
      <div id="method-i-suggested_media_elements" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">suggested_media_elements</span><span
            class="method-args">(n)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="suggested_media_elements-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 651</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">suggested_media_elements</span>(<span class="ruby-identifier">n</span>)
  <span class="ruby-identifier">n</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? AND user_id != ? AND NOT EXISTS (SELECT * FROM bookmarks WHERE bookmarks.bookmarkable_type = ? AND bookmarks.bookmarkable_id = media_elements.id AND bookmarks.user_id = ?)&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-string">&#39;MediaElement&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;publication_date DESC&#39;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">n</span>)
  <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">me</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">me</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- suggested_media_elements-source -->
          
        </div>

        

        
      </div><!-- suggested_media_elements-method -->

    
      <div id="method-i-super_admin-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">super_admin?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="super_admin-3F-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 762</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">super_admin?</span>
  <span class="ruby-identifier">super_admin</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">admin</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">super_admin</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">super_admin</span>.<span class="ruby-identifier">id</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- super_admin-3F-source -->
          
        </div>

        

        
      </div><!-- super_admin-3F-method -->

    
      <div id="method-i-tot_notifications_number" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tot_notifications_number</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="tot_notifications_number-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 698</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tot_notifications_number</span>
  <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- tot_notifications_number-source -->
          
        </div>

        

        
      </div><!-- tot_notifications_number-method -->

    
      <div id="method-i-video_editor_available" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">video_editor_available</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-video_editor_available-label-Description">Description</h3>

<p>Checks if the <a href="Video.html">Video</a> Editor is available (this is
true if there is no <a href="Video.html">Video</a> in conversion at the
moment); used in the filters of <a
href="VideoEditorController.html">VideoEditorController</a></p>

<h3 id="method-i-video_editor_available-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="video_editor_available-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 320</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">video_editor_available</span>
  <span class="ruby-constant">Video</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:converted</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">id</span>).<span class="ruby-identifier">all?</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">record</span><span class="ruby-operator">|</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">uploaded?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">record</span>.<span class="ruby-identifier">modified?</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- video_editor_available-source -->
          
        </div>

        

        
      </div><!-- video_editor_available-method -->

    
      <div id="method-i-video_editor_cache" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">video_editor_cache</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-video_editor_cache-label-Description">Description</h3>

<p>Returns the current <a href="Video.html">Video</a> Editor cache for this
user</p>

<h3 id="method-i-video_editor_cache-label-Returns">Returns</h3>

<p>A hash with parameters (for a sample structure, see <a
href="Media/Video/Editing/Parameters.html#method-i-convert_parameters">Media::Video::Editing::Parameters#convert_parameters</a>)</p>
          

          
          <div class="method-source-code" id="video_editor_cache-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 177</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">video_editor_cache</span>
  <span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:video_editor_cache</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- video_editor_cache-source -->
          
        </div>

        

        
      </div><!-- video_editor_cache-method -->

    
      <div id="method-i-video_editor_cache-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">video_editor_cache!</span><span
            class="method-args">(cache = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-video_editor_cache-21-label-Description">Description</h3>

<p>Saves the <a href="Video.html">Video</a> Editor cache; if the param is
<code>nil</code>, the cache is emptied</p>

<h3 id="method-i-video_editor_cache-21-label-Args">Args</h3>
<ul><li>
<p><strong>cache</strong>: the cache to be saved (it must be a hash with the
structure defined in <a
href="Media/Video/Editing/Parameters.html#method-i-convert_parameters">Media::Video::Editing::Parameters#convert_parameters</a>;
if <code>nil</code> it empties the cache)</p>
</li></ul>
          

          
          <div class="method-source-code" id="video_editor_cache-21-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 164</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">video_editor_cache!</span>(<span class="ruby-identifier">cache</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">update_attribute</span> <span class="ruby-value">:metadata</span>, <span class="ruby-constant">OpenStruct</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">marshal_dump</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">video_editor_cache</span><span class="ruby-operator">:</span> <span class="ruby-identifier">cache</span>))
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- video_editor_cache-21-source -->
          
        </div>

        

        
      </div><!-- video_editor_cache-21-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Private Instance Methods</h3>

    
      <div id="method-i-get_tags_associated_to_lesson_search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_tags_associated_to_lesson_search</span><span
            class="method-args">(word, filter, subject_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_tags_associated_to_lesson_search-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 892</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_tags_associated_to_lesson_search</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>) <span class="ruby-comment"># :doc:</span>
  <span class="ruby-identifier">filter</span> = <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">LESSONS_SEARCH_SET</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">filter</span>)
  <span class="ruby-identifier">subject_id</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>[<span class="ruby-constant">NilClass</span>, <span class="ruby-constant">Fixnum</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">subject_id</span>.<span class="ruby-identifier">class</span>)
  <span class="ruby-identifier">limit</span> = <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;tags_limit_in_search_engine&#39;</span>]
  <span class="ruby-identifier">params</span> = [<span class="ruby-node">&quot;#{word}%&quot;</span>]
  <span class="ruby-identifier">joins</span> = <span class="ruby-string">&quot;INNER JOIN tags ON (tags.id = taggings.tag_id) INNER JOIN lessons ON (taggings.taggable_type = &#39;Lesson&#39; AND taggings.taggable_id = lessons.id)&quot;</span>
  <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;tags.word LIKE ?&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">subject_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.subject_id = ?&quot;</span>
    <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">subject_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND (lessons.is_public = ? OR lessons.user_id = ?)&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLIC</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.is_public = ?&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ONLY_MINE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.user_id = ?&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">NOT_MINE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.is_public = ? AND lessons.user_id != ?&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">select</span> = <span class="ruby-string">&#39;tags.id AS tag_id, COUNT(*) AS tags_count&#39;</span>
  <span class="ruby-identifier">where_for_current_tag</span> = <span class="ruby-identifier">where</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;tags.word LIKE ?&#39;</span>, <span class="ruby-string">&#39;tags.word = ?&#39;</span>)
  <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;tags.word != ? AND #{where}&quot;</span>
  <span class="ruby-identifier">resp</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where_for_current_tag</span>, <span class="ruby-identifier">word</span>, *<span class="ruby-identifier">params</span>[<span class="ruby-value">1</span>, <span class="ruby-identifier">params</span>.<span class="ruby-identifier">length</span>]).<span class="ruby-identifier">limit</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">limit</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">resp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find_by_word</span>(<span class="ruby-identifier">word</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;tags.id&#39;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">word</span>, *<span class="ruby-identifier">params</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;tags_count DESC, tags.word ASC&#39;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">resp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">q</span>.<span class="ruby-identifier">tag_id</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_tags_associated_to_lesson_search-source -->
          
        </div>

        

        
      </div><!-- get_tags_associated_to_lesson_search-method -->

    
      <div id="method-i-get_tags_associated_to_media_element_search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_tags_associated_to_media_element_search</span><span
            class="method-args">(word, filter)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_tags_associated_to_media_element_search-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 933</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_tags_associated_to_media_element_search</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">filter</span>) <span class="ruby-comment"># :doc:</span>
  <span class="ruby-identifier">limit</span> = <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;tags_limit_in_search_engine&#39;</span>]
  <span class="ruby-identifier">filter</span> = <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_MEDIA_ELEMENTS</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">MEDIA_ELEMENTS_SEARCH_SET</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">filter</span>)
  <span class="ruby-identifier">resp</span> = []
  <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;tags.word != ? AND tags.word LIKE ? AND (media_elements.is_public = ? OR media_elements.user_id = ?)&#39;</span>
  <span class="ruby-identifier">where_for_current_tag</span> = <span class="ruby-string">&#39;tags.word = ? AND (media_elements.is_public = ? OR media_elements.user_id = ?)&#39;</span>
  <span class="ruby-identifier">joins</span> = <span class="ruby-string">&quot;INNER JOIN tags ON (tags.id = taggings.tag_id) INNER JOIN media_elements ON (taggings.taggable_type = &#39;MediaElement&#39; AND taggings.taggable_id = media_elements.id)&quot;</span>
  <span class="ruby-identifier">select</span> = <span class="ruby-string">&#39;tags.id AS tag_id, COUNT(*) AS tags_count&#39;</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">VIDEO</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND media_elements.sti_type = &#39;Video&#39;&quot;</span>
      <span class="ruby-identifier">where_for_current_tag</span> = <span class="ruby-node">&quot;#{where_for_current_tag} AND media_elements.sti_type = &#39;Video&#39;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">AUDIO</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND media_elements.sti_type = &#39;Audio&#39;&quot;</span>
      <span class="ruby-identifier">where_for_current_tag</span> = <span class="ruby-node">&quot;#{where_for_current_tag} AND media_elements.sti_type = &#39;Audio&#39;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAGE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND media_elements.sti_type = &#39;Image&#39;&quot;</span>
      <span class="ruby-identifier">where_for_current_tag</span> = <span class="ruby-node">&quot;#{where_for_current_tag} AND media_elements.sti_type = &#39;Image&#39;&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where_for_current_tag</span>, <span class="ruby-identifier">word</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">resp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find_by_word</span>(<span class="ruby-identifier">word</span>)
    <span class="ruby-identifier">limit</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;tags.id&#39;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">word</span>, <span class="ruby-node">&quot;#{word}%&quot;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;tags_count DESC, tags.word ASC&#39;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tagging</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">resp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">tagging</span>.<span class="ruby-identifier">tag_id</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_tags_associated_to_media_element_search-source -->
          
        </div>

        

        
      </div><!-- get_tags_associated_to_media_element_search-method -->

    
      <div id="method-i-search_lessons_with_tag" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_lessons_with_tag</span><span
            class="method-args">(word, offset, limit, filter, subject_id, order_by)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="search_lessons_with_tag-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1033</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_lessons_with_tag</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">limit</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">order_by</span>) <span class="ruby-comment"># :doc:</span>
  <span class="ruby-identifier">resp</span> = {}
  <span class="ruby-identifier">params</span> = [<span class="ruby-node">&quot;#{word}%&quot;</span>]
  <span class="ruby-identifier">select</span> = <span class="ruby-string">&#39;lessons.id AS lesson_id&#39;</span>
  <span class="ruby-identifier">joins</span> = <span class="ruby-string">&quot;INNER JOIN tags ON (tags.id = taggings.tag_id) INNER JOIN lessons ON (taggings.taggable_type = &#39;Lesson&#39; AND taggings.taggable_id = lessons.id)&quot;</span>
  <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;tags.word LIKE ?&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Fixnum</span>
    <span class="ruby-identifier">params</span> = [<span class="ruby-identifier">word</span>]
    <span class="ruby-identifier">joins</span> = <span class="ruby-string">&quot;INNER JOIN lessons ON (taggings.taggable_type = &#39;Lesson&#39; AND taggings.taggable_id = lessons.id)&quot;</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;taggings.tag_id = ?&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">order_by</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">UPDATED_AT</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;lessons.updated_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">LIKES</span>
      <span class="ruby-identifier">select</span> = <span class="ruby-node">&quot;#{select}, (SELECT COUNT(*) FROM likes WHERE (likes.lesson_id = lessons.id)) AS likes_count&quot;</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;likes_count DESC, lessons.updated_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">TITLE</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;lessons.title ASC, lessons.updated_at DESC&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">subject_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.subject_id = ?&quot;</span>
    <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">subject_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND (lessons.is_public = ? OR lessons.user_id = ?)&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLIC</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.is_public = ?&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ONLY_MINE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.user_id = ?&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">NOT_MINE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND lessons.is_public = ? AND lessons.user_id != ?&quot;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] = []
  <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;lessons.id&#39;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, *<span class="ruby-identifier">params</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">lesson</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">find_by_id</span> <span class="ruby-identifier">q</span>.<span class="ruby-identifier">lesson_id</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">lesson</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>] = <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;lessons.id&#39;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, *<span class="ruby-identifier">params</span>).<span class="ruby-identifier">count</span>.<span class="ruby-identifier">length</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:pages_amount</span>] = <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>], <span class="ruby-identifier">limit</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_lessons_with_tag-source -->
          
        </div>

        

        
      </div><!-- search_lessons_with_tag-method -->

    
      <div id="method-i-search_lessons_without_tag" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_lessons_without_tag</span><span
            class="method-args">(offset, limit, filter, subject_id, order_by)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="search_lessons_without_tag-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1085</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_lessons_without_tag</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">limit</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">subject_id</span>, <span class="ruby-identifier">order_by</span>) <span class="ruby-comment"># :doc:</span>
  <span class="ruby-identifier">resp</span> = {}
  <span class="ruby-identifier">params</span> = []
  <span class="ruby-identifier">select</span> = <span class="ruby-string">&#39;lessons.id AS lesson_id&#39;</span>
  <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">order_by</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">UPDATED_AT</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;updated_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">LIKES</span>
      <span class="ruby-identifier">select</span> = <span class="ruby-node">&quot;#{select}, (SELECT COUNT(*) FROM likes WHERE (likes.lesson_id = lessons.id)) AS likes_count&quot;</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;likes_count DESC, updated_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">TITLE</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;title ASC, updated_at DESC&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_LESSONS</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;(is_public = ? OR user_id = ?)&#39;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLIC</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;is_public = ?&#39;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ONLY_MINE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;user_id = ?&#39;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">NOT_MINE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;is_public = ? AND user_id != ?&#39;</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">subject_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND subject_id = ?&quot;</span>
    <span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">subject_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">query</span> = []
  <span class="ruby-identifier">count</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">query</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>]).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
      <span class="ruby-identifier">count</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>]).<span class="ruby-identifier">count</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">2</span>
      <span class="ruby-identifier">query</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">1</span>]).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
      <span class="ruby-identifier">count</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">1</span>]).<span class="ruby-identifier">count</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">3</span>
      <span class="ruby-identifier">query</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">select</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">2</span>]).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
      <span class="ruby-identifier">count</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">2</span>]).<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] = []
  <span class="ruby-identifier">query</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">lesson</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">find_by_id</span> <span class="ruby-identifier">q</span>.<span class="ruby-identifier">lesson_id</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">lesson</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>] = <span class="ruby-identifier">count</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:pages_amount</span>] = <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>], <span class="ruby-identifier">limit</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_lessons_without_tag-source -->
          
        </div>

        

        
      </div><!-- search_lessons_without_tag-method -->

    
      <div id="method-i-search_media_elements_with_tag" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_media_elements_with_tag</span><span
            class="method-args">(word, offset, limit, filter, order_by)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="search_media_elements_with_tag-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 962</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_media_elements_with_tag</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">limit</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">order_by</span>) <span class="ruby-comment"># :doc:</span>
  <span class="ruby-identifier">resp</span> = {}
  <span class="ruby-identifier">params</span> = [<span class="ruby-node">&quot;#{word}%&quot;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>]
  <span class="ruby-identifier">joins</span> = <span class="ruby-string">&quot;INNER JOIN tags ON (tags.id = taggings.tag_id) INNER JOIN media_elements ON (taggings.taggable_type = &#39;MediaElement&#39; AND taggings.taggable_id = media_elements.id)&quot;</span>
  <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;tags.word LIKE ? AND (media_elements.is_public = ? OR media_elements.user_id = ?)&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Fixnum</span>
    <span class="ruby-identifier">params</span> = [<span class="ruby-identifier">word</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>]
    <span class="ruby-identifier">joins</span> = <span class="ruby-string">&quot;INNER JOIN media_elements ON (taggings.taggable_type = &#39;MediaElement&#39; AND taggings.taggable_id = media_elements.id)&quot;</span>
    <span class="ruby-identifier">where</span> = <span class="ruby-string">&#39;taggings.tag_id = ? AND (media_elements.is_public = ? OR media_elements.user_id = ?)&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">order_by</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">UPDATED_AT</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;media_elements.updated_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">TITLE</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;media_elements.title ASC, media_elements.updated_at DESC&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">VIDEO</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND media_elements.sti_type = &#39;Video&#39;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">AUDIO</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND media_elements.sti_type = &#39;Audio&#39;&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAGE</span>
      <span class="ruby-identifier">where</span> = <span class="ruby-node">&quot;#{where} AND media_elements.sti_type = &#39;Image&#39;&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] = []
  <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;media_elements.id&#39;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-string">&#39;media_elements.id AS media_element_id&#39;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">2</span>]).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">media_element</span> = <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">find_by_id</span> <span class="ruby-identifier">q</span>.<span class="ruby-identifier">media_element_id</span>
    <span class="ruby-identifier">media_element</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">media_element</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>] = <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">group</span>(<span class="ruby-string">&#39;media_elements.id&#39;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">where</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">2</span>]).<span class="ruby-identifier">count</span>.<span class="ruby-identifier">length</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:pages_amount</span>] = <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>], <span class="ruby-identifier">limit</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_media_elements_with_tag-source -->
          
        </div>

        

        
      </div><!-- search_media_elements_with_tag-method -->

    
      <div id="method-i-search_media_elements_without_tag" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_media_elements_without_tag</span><span
            class="method-args">(offset, limit, filter, order_by)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="search_media_elements_without_tag-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 998</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_media_elements_without_tag</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">limit</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">order_by</span>) <span class="ruby-comment"># :doc:</span>
  <span class="ruby-identifier">resp</span> = {}
  <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">order_by</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">UPDATED_AT</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;updated_at DESC&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">SearchOrders</span><span class="ruby-operator">::</span><span class="ruby-constant">TITLE</span>
      <span class="ruby-identifier">order</span> = <span class="ruby-string">&#39;title ASC, updated_at DESC&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">count</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">query</span> = []
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">filter</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL_MEDIA_ELEMENTS</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>
      <span class="ruby-identifier">query</span> = <span class="ruby-constant">MediaElement</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">VIDEO</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-constant">Video</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>
      <span class="ruby-identifier">query</span> = <span class="ruby-constant">Video</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">AUDIO</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-constant">Audio</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>
      <span class="ruby-identifier">query</span> = <span class="ruby-constant">Audio</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Filters</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAGE</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-constant">Image</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span>
      <span class="ruby-identifier">query</span> = <span class="ruby-constant">Image</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;is_public = ? OR user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">order</span>).<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">offset</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">limit</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] = []
  <span class="ruby-identifier">query</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">q</span>.<span class="ruby-identifier">set_status</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">q</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>] = <span class="ruby-identifier">count</span>
  <span class="ruby-identifier">resp</span>[<span class="ruby-value">:pages_amount</span>] = <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">resp</span>[<span class="ruby-value">:records_amount</span>], <span class="ruby-identifier">limit</span>).<span class="ruby-identifier">ceil</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_media_elements_without_tag-source -->
          
        </div>

        

        
      </div><!-- search_media_elements_without_tag-method -->

    
    </section><!-- private-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

