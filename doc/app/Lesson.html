<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class Lesson - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/models/lesson.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">ActiveRecord::Base
  
</nav>

    <!-- Included Modules -->
<nav id="includes-section" class="section">
  <h3 class="section-header">Included Modules</h3>

  <ul class="link-list">
  
  
    <li><span class="include">Rails</span>
  
  
  </ul>
</nav>

    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-dashboard_emptied-3F">::dashboard_emptied?</a>
    
    <li><a href="#method-i-add_slide">#add_slide</a>
    
    <li><a href="#method-i-add_to_virtual_classroom">#add_to_virtual_classroom</a>
    
    <li><a href="#method-i-available-21">#available!</a>
    
    <li><a href="#method-i-available-3F">#available?</a>
    
    <li><a href="#method-i-bookmarked-3F">#bookmarked?</a>
    
    <li><a href="#method-i-buttons">#buttons</a>
    
    <li><a href="#method-i-copy">#copy</a>
    
    <li><a href="#method-i-cover">#cover</a>
    
    <li><a href="#method-i-destroy_with_notifications">#destroy_with_notifications</a>
    
    <li><a href="#method-i-dont_notify_changes">#dont_notify_changes</a>
    
    <li><a href="#method-i-in_virtual_classroom-3F">#in_virtual_classroom?</a>
    
    <li><a href="#method-i-liked-3F">#liked?</a>
    
    <li><a href="#method-i-modify">#modify</a>
    
    <li><a href="#method-i-not_notified-3F">#not_notified?</a>
    
    <li><a href="#method-i-notify_changes">#notify_changes</a>
    
    <li><a href="#method-i-publish">#publish</a>
    
    <li><a href="#method-i-reached_the_maximum_of_slides-3F">#reached_the_maximum_of_slides?</a>
    
    <li><a href="#method-i-remove_from_virtual_classroom">#remove_from_virtual_classroom</a>
    
    <li><a href="#method-i-set_status">#set_status</a>
    
    <li><a href="#method-i-status">#status</a>
    
    <li><a href="#method-i-tags">#tags</a>
    
    <li><a href="#method-i-tags-3D">#tags=</a>
    
    <li><a href="#method-i-unpublish">#unpublish</a>
    
    <li><a href="#method-i-visive_tags">#visive_tags</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Media.html">Media</a>
  
    <li><a href="./Media/Audio.html">Media::Audio</a>
  
    <li><a href="./Media/Audio/Editing.html">Media::Audio::Editing</a>
  
    <li><a href="./Media/Audio/Editing/Cmd.html">Media::Audio::Editing::Cmd</a>
  
    <li><a href="./Media/Audio/Editing/Cmd/Avconv.html">Media::Audio::Editing::Cmd::Avconv</a>
  
    <li><a href="./Media/Audio/Editing/Cmd/Concat.html">Media::Audio::Editing::Cmd::Concat</a>
  
    <li><a href="./Media/Audio/Editing/Cmd/Conversion.html">Media::Audio::Editing::Cmd::Conversion</a>
  
    <li><a href="./Media/Audio/Editing/Cmd/Crop.html">Media::Audio::Editing::Cmd::Crop</a>
  
    <li><a href="./Media/Audio/Editing/Cmd/Sox.html">Media::Audio::Editing::Cmd::Sox</a>
  
    <li><a href="./Media/Audio/Editing/Composer.html">Media::Audio::Editing::Composer</a>
  
    <li><a href="./Media/Audio/Editing/Composer/Job.html">Media::Audio::Editing::Composer::Job</a>
  
    <li><a href="./Media/Audio/Editing/Concat.html">Media::Audio::Editing::Concat</a>
  
    <li><a href="./Media/Audio/Editing/Conversion.html">Media::Audio::Editing::Conversion</a>
  
    <li><a href="./Media/Audio/Editing/Conversion/Job.html">Media::Audio::Editing::Conversion::Job</a>
  
    <li><a href="./Media/Audio/Editing/Crop.html">Media::Audio::Editing::Crop</a>
  
    <li><a href="./Media/Audio/Editing/Parameters.html">Media::Audio::Editing::Parameters</a>
  
    <li><a href="./Media/Audio/Uploader.html">Media::Audio::Uploader</a>
  
    <li><a href="./Media/Audio/Uploader/Validation.html">Media::Audio::Uploader::Validation</a>
  
    <li><a href="./Media/Cmd.html">Media::Cmd</a>
  
    <li><a href="./Media/Cmd/Avconv.html">Media::Cmd::Avconv</a>
  
    <li><a href="./Media/Cmd/Avprobe.html">Media::Cmd::Avprobe</a>
  
    <li><a href="./Media/Error.html">Media::Error</a>
  
    <li><a href="./Media/Image.html">Media::Image</a>
  
    <li><a href="./Media/Image/Editing.html">Media::Image::Editing</a>
  
    <li><a href="./Media/Image/Editing/AddTextToImage.html">Media::Image::Editing::AddTextToImage</a>
  
    <li><a href="./Media/Image/Editing/Cmd.html">Media::Image::Editing::Cmd</a>
  
    <li><a href="./Media/Image/Editing/Cmd/TextToImage.html">Media::Image::Editing::Cmd::TextToImage</a>
  
    <li><a href="./Media/Image/Editing/Crop.html">Media::Image::Editing::Crop</a>
  
    <li><a href="./Media/Image/Editing/ResizeToFill.html">Media::Image::Editing::ResizeToFill</a>
  
    <li><a href="./Media/InTmpDir.html">Media::InTmpDir</a>
  
    <li><a href="./Media/Info.html">Media::Info</a>
  
    <li><a href="./Media/Logging.html">Media::Logging</a>
  
    <li><a href="./Media/Logging/ClassMethods.html">Media::Logging::ClassMethods</a>
  
    <li><a href="./Media/Logging/InstanceMethods.html">Media::Logging::InstanceMethods</a>
  
    <li><a href="./Media/Shared.html">Media::Shared</a>
  
    <li><a href="./Media/Shared/InstanceMethods.html">Media::Shared::InstanceMethods</a>
  
    <li><a href="./Media/SimilarDurations.html">Media::SimilarDurations</a>
  
    <li><a href="./Media/Thread.html">Media::Thread</a>
  
    <li><a href="./Media/Uploader.html">Media::Uploader</a>
  
    <li><a href="./Media/Video.html">Media::Video</a>
  
    <li><a href="./Media/Video/Editing.html">Media::Video::Editing</a>
  
    <li><a href="./Media/Video/Editing/Cmd.html">Media::Video::Editing::Cmd</a>
  
    <li><a href="./Media/Video/Editing/Cmd/AudioStreamToFile.html">Media::Video::Editing::Cmd::AudioStreamToFile</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Avconv.html">Media::Video::Editing::Cmd::Avconv</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Concat.html">Media::Video::Editing::Cmd::Concat</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Concat/Mp4.html">Media::Video::Editing::Cmd::Concat::Mp4</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Concat/Webm.html">Media::Video::Editing::Cmd::Concat::Webm</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Conversion.html">Media::Video::Editing::Cmd::Conversion</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Crop.html">Media::Video::Editing::Cmd::Crop</a>
  
    <li><a href="./Media/Video/Editing/Cmd/ExtractFrame.html">Media::Video::Editing::Cmd::ExtractFrame</a>
  
    <li><a href="./Media/Video/Editing/Cmd/GenerateTransitionFrames.html">Media::Video::Editing::Cmd::GenerateTransitionFrames</a>
  
    <li><a href="./Media/Video/Editing/Cmd/ImageToVideo.html">Media::Video::Editing::Cmd::ImageToVideo</a>
  
    <li><a href="./Media/Video/Editing/Cmd/MergeWebmVideoStreams.html">Media::Video::Editing::Cmd::MergeWebmVideoStreams</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Mp3ToWav.html">Media::Video::Editing::Cmd::Mp3ToWav</a>
  
    <li><a href="./Media/Video/Editing/Cmd/ReplaceAudio.html">Media::Video::Editing::Cmd::ReplaceAudio</a>
  
    <li><a href="./Media/Video/Editing/Cmd/Transition.html">Media::Video::Editing::Cmd::Transition</a>
  
    <li><a href="./Media/Video/Editing/Cmd/TrimAudioFile.html">Media::Video::Editing::Cmd::TrimAudioFile</a>
  
    <li><a href="./Media/Video/Editing/Cmd/VideoStreamToFile.html">Media::Video::Editing::Cmd::VideoStreamToFile</a>
  
    <li><a href="./Media/Video/Editing/Composer.html">Media::Video::Editing::Composer</a>
  
    <li><a href="./Media/Video/Editing/Composer/Job.html">Media::Video::Editing::Composer::Job</a>
  
    <li><a href="./Media/Video/Editing/Concat.html">Media::Video::Editing::Concat</a>
  
    <li><a href="./Media/Video/Editing/Conversion.html">Media::Video::Editing::Conversion</a>
  
    <li><a href="./Media/Video/Editing/Conversion/Job.html">Media::Video::Editing::Conversion::Job</a>
  
    <li><a href="./Media/Video/Editing/Crop.html">Media::Video::Editing::Crop</a>
  
    <li><a href="./Media/Video/Editing/ImageToVideo.html">Media::Video::Editing::ImageToVideo</a>
  
    <li><a href="./Media/Video/Editing/Parameters.html">Media::Video::Editing::Parameters</a>
  
    <li><a href="./Media/Video/Editing/ReplaceAudio.html">Media::Video::Editing::ReplaceAudio</a>
  
    <li><a href="./Media/Video/Editing/TextToVideo.html">Media::Video::Editing::TextToVideo</a>
  
    <li><a href="./Media/Video/Editing/Transition.html">Media::Video::Editing::Transition</a>
  
    <li><a href="./Media/Video/Uploader.html">Media::Video::Uploader</a>
  
    <li><a href="./Media/Video/Uploader/Validation.html">Media::Video::Uploader::Validation</a>
  
    <li><a href="./Admin.html">Admin</a>
  
    <li><a href="./Admin/DashboardController.html">Admin::DashboardController</a>
  
    <li><a href="./Admin/LessonsController.html">Admin::LessonsController</a>
  
    <li><a href="./Admin/MediaElementsController.html">Admin::MediaElementsController</a>
  
    <li><a href="./Admin/MessagesController.html">Admin::MessagesController</a>
  
    <li><a href="./Admin/ReportsController.html">Admin::ReportsController</a>
  
    <li><a href="./Admin/SettingsController.html">Admin::SettingsController</a>
  
    <li><a href="./Admin/UsersController.html">Admin::UsersController</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./User/Authentication.html">User::Authentication</a>
  
    <li><a href="./User/Authentication/ClassMethods.html">User::Authentication::ClassMethods</a>
  
    <li><a href="./User/Authentication/InstanceMethods.html">User::Authentication::InstanceMethods</a>
  
    <li><a href="./User/Confirmation.html">User::Confirmation</a>
  
    <li><a href="./User/Confirmation/ClassMethods.html">User::Confirmation::ClassMethods</a>
  
    <li><a href="./User/Confirmation/InstanceMethods.html">User::Confirmation::InstanceMethods</a>
  
    <li><a href="./Dumpable.html">Dumpable</a>
  
    <li><a href="./Dumpable/NoMethodError.html">Dumpable::NoMethodError</a>
  
    <li><a href="./EnvRelativePath.html">EnvRelativePath</a>
  
    <li><a href="./EnvRelativePath/ClassMethods.html">EnvRelativePath::ClassMethods</a>
  
    <li><a href="./FilenameToken.html">FilenameToken</a>
  
    <li><a href="./FilenameToken/InstanceMethods.html">FilenameToken::InstanceMethods</a>
  
    <li><a href="./TimeConvert.html">TimeConvert</a>
  
    <li><a href="./TimeConvert/TimeConverter.html">TimeConvert::TimeConverter</a>
  
    <li><a href="./Users.html">Users</a>
  
    <li><a href="./Users/SessionsController.html">Users::SessionsController</a>
  
    <li><a href="./Valid.html">Valid</a>
  
    <li><a href="./Valid/Validness.html">Valid::Validness</a>
  
    <li><a href="./AdminController.html">AdminController</a>
  
    <li><a href="./AdminHelper.html">AdminHelper</a>
  
    <li><a href="./AdminSearchForm.html">AdminSearchForm</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Audio.html">Audio</a>
  
    <li><a href="./AudioEditorController.html">AudioEditorController</a>
  
    <li><a href="./Bookmark.html">Bookmark</a>
  
    <li><a href="./ButtonDestinations.html">ButtonDestinations</a>
  
    <li><a href="./Buttons.html">Buttons</a>
  
    <li><a href="./ControllerInfo.html">ControllerInfo</a>
  
    <li><a href="./DashboardController.html">DashboardController</a>
  
    <li><a href="./EnhancedThread.html">EnhancedThread</a>
  
    <li><a href="./ErrorsLogger.html">ErrorsLogger</a>
  
    <li><a href="./ExceptionNotifierJob.html">ExceptionNotifierJob</a>
  
    <li><a href="./Filters.html">Filters</a>
  
    <li><a href="./Form.html">Form</a>
  
    <li><a href="./GalleriesController.html">GalleriesController</a>
  
    <li><a href="./Image.html">Image</a>
  
    <li><a href="./ImageEditorController.html">ImageEditorController</a>
  
    <li><a href="./ImageUploader.html">ImageUploader</a>
  
    <li><a href="./Lesson.html">Lesson</a>
  
    <li><a href="./LessonEditorController.html">LessonEditorController</a>
  
    <li><a href="./LessonViewerController.html">LessonViewerController</a>
  
    <li><a href="./LessonsController.html">LessonsController</a>
  
    <li><a href="./LessonsMediaElementsShared.html">LessonsMediaElementsShared</a>
  
    <li><a href="./Like.html">Like</a>
  
    <li><a href="./Location.html">Location</a>
  
    <li><a href="./MailerHelper.html">MailerHelper</a>
  
    <li><a href="./MailingListAddress.html">MailingListAddress</a>
  
    <li><a href="./MailingListGroup.html">MailingListGroup</a>
  
    <li><a href="./MailingListsController.html">MailingListsController</a>
  
    <li><a href="./MediaElement.html">MediaElement</a>
  
    <li><a href="./MediaElementsController.html">MediaElementsController</a>
  
    <li><a href="./MediaElementsSlide.html">MediaElementsSlide</a>
  
    <li><a href="./Notification.html">Notification</a>
  
    <li><a href="./NotificationsController.html">NotificationsController</a>
  
    <li><a href="./NotificationsJob.html">NotificationsJob</a>
  
    <li><a href="./PreloginController.html">PreloginController</a>
  
    <li><a href="./Report.html">Report</a>
  
    <li><a href="./ReportsController.html">ReportsController</a>
  
    <li><a href="./SchoolLevel.html">SchoolLevel</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchOrders.html">SearchOrders</a>
  
    <li><a href="./Slide.html">Slide</a>
  
    <li><a href="./Statistics.html">Statistics</a>
  
    <li><a href="./Statuses.html">Statuses</a>
  
    <li><a href="./Subject.html">Subject</a>
  
    <li><a href="./Tag.html">Tag</a>
  
    <li><a href="./Tagging.html">Tagging</a>
  
    <li><a href="./TagsController.html">TagsController</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersSubject.html">UsersSubject</a>
  
    <li><a href="./Video.html">Video</a>
  
    <li><a href="./VideoEditorController.html">VideoEditorController</a>
  
    <li><a href="./VirtualClassroomController.html">VirtualClassroomController</a>
  
    <li><a href="./VirtualClassroomLesson.html">VirtualClassroomLesson</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Lesson</h1>

  <div id="description" class="description">
    
<h2 id="label-Description">Description</h2>

<p>ActiveRecord class that corresponds to the table <code>lessons</code>.</p>

<h2 id="label-Fields">Fields</h2>
<ul><li>
<p><strong>user_id</strong>: id of the creator of the lesson</p>
</li><li>
<p><strong>school_level_id</strong>: id of the school level of the lesson
(which corresponds to the school level of its creator)</p>
</li><li>
<p><strong>subject_id</strong>: id of the subject of the lesson</p>
</li><li>
<p><strong>title</strong>: title</p>
</li><li>
<p><strong>description</strong>: description</p>
</li><li>
<p><strong>is_public</strong>: <code>true</code> if the lesson is visible by
other users</p>
</li><li>
<p><strong>parent_id</strong>: reference to another lesson, from which the
current lesson has been copied. The value is <code>nil</code> if the lesson
hasn&#39;t been copied</p>
</li><li>
<p><strong>copied_not_modified</strong>: boolean, set to <code>true</code>
only for lessons just copied and not modified yet</p>
</li><li>
<p><strong>token</strong>: token used in the public url of the lesson. Without
this token, if the lesson is private, the only user who can see it is the
creator</p>
</li><li>
<p><strong>metadata</strong>: contains two keys:</p>
<ul><li>
<p><code>available_video</code>: true if the lesson doesn&#39;t contain any
video in conversion</p>
</li><li>
<p><code>available_audio</code>: true if the lesson doesn&#39;t contain any
audio in conversion</p>
</li></ul>
</li><li>
<p><strong>notified</strong>: boolean, set to false only if the lesson has
been modified and its modification not notified to users who have a link of
the lesson</p>
</li></ul>

<h2 id="label-Associations">Associations</h2>
<ul><li>
<p><strong>user</strong>: reference to the <a href="User.html">User</a> who
created the lesson (<strong>belongs_to</strong>).</p>
</li><li>
<p><strong>subject</strong>: <a href="Subject.html">Subject</a> associated to
the lesson (<strong>belongs_to</strong>).</p>
</li><li>
<p><strong>school_level</strong>: <a href="SchoolLevel.html">SchoolLevel</a>
associated to the creator of the lesson and for transitivity to the lesson
(<strong>belongs_to</strong>).</p>
</li><li>
<p><strong>parent</strong>: original lesson from which the lesson was copied
(<strong>belongs_to</strong>).</p>
</li><li>
<p><strong>copies</strong>: lessons copied by this lesson
(<strong>has_many</strong>).</p>
</li><li>
<p><strong>bookmarks</strong>: links created by other users to this lesson
(see <a href="Bookmark.html">Bookmark</a>) (<strong>has_many</strong>).</p>
</li><li>
<p><strong>likes</strong>: likes on the lesson (see <a
href="Like.html">Like</a>) (<strong>has_many</strong>).</p>
</li><li>
<p><strong>reports</strong>: reports on the lesson (see <a
href="Report.html">Report</a>) (<strong>has_many</strong>).</p>
</li><li>
<p><strong>taggings</strong>: tags associated to the lesson (see <a
href="Tagging.html">Tagging</a>, <a href="Tag.html">Tag</a>)
(<strong>has_many</strong>).</p>
</li><li>
<p><strong>slides</strong>: slides composing the lesson (see <a
href="Slide.html">Slide</a>) (<strong>has_many</strong>).</p>
</li><li>
<p><strong>media_elements_slides</strong>: list of instances of media elements
inside slides of this lesson (see <a
href="MediaElementsSlide.html">MediaElementsSlide</a>) (through the class
<a href="Slide.html">Slide</a>) (<strong>has_many</strong>).</p>
</li><li>
<p><strong>media_elements</strong>: list of media elements attached to slides
of this lesson (see <a href="MediaElement.html">MediaElement</a>) (through
the class <a href="Slide.html">Slide</a> and <a
href="MediaElementsSlide.html">MediaElementsSlide</a>)
(<strong>has_many</strong>).</p>
</li><li>
<p><strong>virtual_classroom_lessons</strong>: copies of this lesson into the
Virtual Classroom of the creator or other users (see <a
href="VirtualClassroomLesson.html">VirtualClassroomLesson</a>)
(<strong>has_many</strong>).</p>
</li></ul>

<h2 id="label-Validations">Validations</h2>
<ul><li>
<p><strong>presence</strong> with numericality and existence of associated
record for <code>user_id</code>, <code>subject_id</code>,
<code>school_level_id</code></p>
</li><li>
<p><strong>presence</strong> for <code>title</code> and
<code>description</code></p>
</li><li>
<p><strong>presence</strong> of associated element, numericality for
<code>parent_id</code> and <code>parent_id</code> must different by
<code>id</code>, <strong>only if different by nil</strong></p>
</li><li>
<p><strong>inclusion</strong> of <code>is_public</code>,
<code>copied_not_modified</code>, <code>notified</code> in
[<code>true</code>, <code>false</code>]</p>
</li><li>
<p><strong>length</strong> of <code>title</code> and <code>description</code>
(values configured in the I18n translation file; only for title, if the
value is greater than 255 it&#39;s set to 255)</p>
</li><li>
<p><strong>uniqueness</strong> of the couple [<code>parent_id</code>,
<code>user_id</code>] <strong>if <code>parent_id</code> is not
null</strong></p>
</li><li>
<p><strong>if</strong> <strong>new</strong> <strong>record</strong>
<code>is_public</code> must be false</p>
</li><li>
<p><strong>if</strong> <strong>public</strong>
<code>copied_not_modified</code> must be false</p>
</li><li>
<p><strong>modifications</strong> <strong>not</strong>
<strong>available</strong> for the <code>user_id</code>,
<code>parent_id</code>, <code>token</code></p>
</li><li>
<p><strong>minimum</strong> <strong>number</strong> of tags (configurated in
settings.yml), <strong>only if the attribute <a
href="Lesson.html#attribute-i-validating_in_form">#validating_in_form</a>
is set as <code>true</code></strong></p>
</li></ul>

<h2 id="label-Callbacks">Callbacks</h2>
<ol><li>
<p><strong>before_destroy</strong> destroys associated bookmarks (see <a
href="Bookmark.html">Bookmark</a>)</p>
</li><li>
<p><strong>before_destroy</strong> destroys associated likes (see <a
href="Like.html">Like</a>)</p>
</li><li>
<p><strong>before_destroy</strong> destroys associated reports (see <a
href="Report.html">Report</a>)</p>
</li><li>
<p><strong>before_destroy</strong> destroys associated taggings (see <a
href="Tagging.html">Tagging</a>)</p>
</li><li>
<p><strong>before_create</strong> initializes both metadata values to
<code>true</code></p>
</li><li>
<p><strong>before_create</strong> creates a random encoded string and writes
it in <code>token</code></p>
</li><li>
<p><strong>after_save</strong> creates or updates the cover slide</p>
</li><li>
<p><strong>after_save</strong> updates taggings associated to the lesson (see
<a href="Tagging.html">Tagging</a>). If a <a href="Tag.html">Tag</a>
doesn&#39;t exist yet, it is created too. The tags are stored before the
validation in the private attribute <code>inner_tags</code></p>
</li></ol>

<h2 id="label-Database+callbacks">Database callbacks</h2>
<ol><li>
<p><strong>cascade</strong> <strong>destruction</strong> for the associated
table <a href="Like.html">Like</a></p>
</li><li>
<p><strong>cascade</strong> <strong>destruction</strong> for the associated
table <a href="Slide.html">Slide</a></p>
</li><li>
<p><strong>cascade</strong> <strong>destruction</strong> for the associated
table <a href="VirtualClassroomLesson.html">VirtualClassroomLesson</a></p>
</li><li>
<p><strong>set</strong> <strong>null</strong> <strong>on</strong>
<strong>destruction</strong> on the column <code>parent_id</code> of all
the lessons copied by the current lesson</p>
</li></ol>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="MAX_TITLE_LENGTH">MAX_TITLE_LENGTH
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-is_reportable" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">is_reportable</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-validating_in_form" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">validating_in_form</span><span
            class="attribute-access-type">[W]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-dashboard_emptied-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dashboard_emptied?</span><span
            class="method-args">(an_user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-c-dashboard_emptied-3F-label-Description">Description</h3>

<p>Checks whether the dashboard of a particular user is empty because he
picked all the suggested lessons and not because the database is empty.</p>

<h3 id="method-c-dashboard_emptied-3F-label-Args">Args</h3>
<ul><li>
<p><strong>user_id</strong>: the id of a <a href="User.html">User</a></p>
</li></ul>

<h3 id="method-c-dashboard_emptied-3F-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="dashboard_emptied-3F-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 261</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">dashboard_emptied?</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-identifier">subject_ids</span> = []
  <span class="ruby-constant">UsersSubject</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">an_user_id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">us</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">subject_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">us</span>.<span class="ruby-identifier">subject_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-string">&quot;INNER JOIN lessons ON lessons.id = bookmarks.bookmarkable_id AND bookmarks.bookmarkable_type = &#39;Lesson&#39;&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;lessons.is_public = ? AND lessons.user_id != ? AND lessons.subject_id IN (?) AND bookmarks.user_id = ?&#39;</span>, <span class="ruby-keyword">true</span>, <span class="ruby-identifier">an_user_id</span>, <span class="ruby-identifier">subject_ids</span>, <span class="ruby-identifier">an_user_id</span>).<span class="ruby-identifier">any?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- dashboard_emptied-3F-source -->
          
        </div>

        

        
      </div><!-- dashboard_emptied-3F-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-add_slide" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_slide</span><span
            class="method-args">(kind, position)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-add_slide-label-Description">Description</h3>

<p>Adds a slide of a specific type.</p>

<h3 id="method-i-add_slide-label-Args">Args</h3>
<ul><li>
<p><strong>kind</strong>: the template chosen for the new slide</p>
</li><li>
<p><strong>position</strong>: the position in which the new slide must be
inserted</p>
</li></ul>

<h3 id="method-i-add_slide-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="add_slide-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 614</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_slide</span>(<span class="ruby-identifier">kind</span>, <span class="ruby-identifier">position</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">Slide</span><span class="ruby-operator">::</span><span class="ruby-constant">KINDS_WITHOUT_COVER</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">kind</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">slide</span> = <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">slide</span>.<span class="ruby-identifier">kind</span> = <span class="ruby-identifier">kind</span>
    <span class="ruby-identifier">slide</span>.<span class="ruby-identifier">lesson_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">slide</span>.<span class="ruby-identifier">position</span> = <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;position DESC&#39;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">position</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">slide</span>.<span class="ruby-identifier">save</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">slide</span>.<span class="ruby-identifier">change_position</span>(<span class="ruby-identifier">position</span>) <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">modify</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">slide</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_slide-source -->
          
        </div>

        

        
      </div><!-- add_slide-method -->

    
      <div id="method-i-add_to_virtual_classroom" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_to_virtual_classroom</span><span
            class="method-args">(an_user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-add_to_virtual_classroom-label-Description">Description</h3>

<p>Creates a record of <a
href="VirtualClassroomLesson.html">VirtualClassroomLesson</a> for this
lesson. First it checks whether the record can be created or not (for
instance, it is not possible if the user is not owner of the lesson and
doesn&#39;t have a bookmark for it)</p>

<h3 id="method-i-add_to_virtual_classroom-label-Args">Args</h3>
<ul><li>
<p><strong>an_user_id</strong>: the id of the <a href="User.html">User</a> who
is adding the lesson to his Virtual Classroom</p>
</li></ul>

<h3 id="method-i-add_to_virtual_classroom-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="add_to_virtual_classroom-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 654</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_to_virtual_classroom</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_adding_to_virtual_classroom</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">an_user_id</span>).<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_adding_to_virtual_classroom</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">an_user_id</span>).<span class="ruby-identifier">any?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:lesson_already_in_virtual_classroom</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">vc</span> = <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">vc</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">an_user_id</span>
  <span class="ruby-identifier">vc</span>.<span class="ruby-identifier">lesson_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">vc</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:lesson_not_available_for_virtual_classroom</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_to_virtual_classroom-source -->
          
        </div>

        

        
      </div><!-- add_to_virtual_classroom-method -->

    
      <div id="method-i-available-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">available!</span><span
            class="method-args">(type, value=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-available-21-label-Description">Description</h3>

<p>Sets the value of one of the two metadata (<code>available_video</code> or
<code>available_audio</code>).</p>

<h3 id="method-i-available-21-label-Args">Args</h3>
<ul><li>
<p><strong>type</strong>: used to select which of the two metadata is going to
be set</p>
</li><li>
<p><strong>value</strong>: <code>true</code> for default.</p>
</li></ul>
          

          
          <div class="method-source-code" id="available-21-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 200</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">available!</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">value</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:&quot;available_#{type.to_s.downcase}=&quot;</span>, <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-identifier">value</span>
  <span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:metadata</span>, <span class="ruby-identifier">metadata</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- available-21-source -->
          
        </div>

        

        
      </div><!-- available-21-method -->

    
      <div id="method-i-available-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">available?</span><span
            class="method-args">(type=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-available-3F-label-Description">Description</h3>

<p>Checks whether the lesson is available for editing in the <a
href="Lesson.html">Lesson</a> Editor (if at least one between
<code>metadata</code>.<code>available_audio</code> and
<code>metadata</code>.<code>available_video</code> is false, the lesson is
not available)</p>

<h3 id="method-i-available-3F-label-Args">Args</h3>
<ul><li>
<p><strong>type</strong>: if the parameter is inserted explicitly, the methods
returns only the value for the specific type; otherwise it returns
<code>available_video</code> &amp;&amp; <code>available_audio</code>.</p>
</li></ul>

<h3 id="method-i-available-3F-label-Returns">Returns</h3>

<p>A boolean.</p>
          

          
          <div class="method-source-code" id="available-3F-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 182</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">available?</span>(<span class="ruby-identifier">type</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">type</span> = <span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;video&#39;</span>, <span class="ruby-string">&#39;audio&#39;</span>
    <span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:&quot;available_#{type}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">available_video</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">available_audio</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- available-3F-source -->
          
        </div>

        

        
      </div><!-- available-3F-method -->

    
      <div id="method-i-bookmarked-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bookmarked?</span><span
            class="method-args">(an_user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-bookmarked-3F-label-Description">Description</h3>

<p>Checks if the lesson has a bookmark for a particular user</p>

<h3 id="method-i-bookmarked-3F-label-Args">Args</h3>
<ul><li>
<p><strong>an_user_id</strong>: the id of the <a href="User.html">User</a></p>
</li></ul>

<h3 id="method-i-bookmarked-3F-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="bookmarked-3F-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 357</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bookmarked?</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">an_user_id</span>, <span class="ruby-value">:bookmarkable_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Lesson&#39;</span>, <span class="ruby-value">:bookmarkable_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">any?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- bookmarked-3F-source -->
          
        </div>

        

        
      </div><!-- bookmarked-3F-method -->

    
      <div id="method-i-buttons" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">buttons</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-buttons-label-Description">Description</h3>

<p>Returns the list of buttons available for the user who wants to see this
lesson. If the lesson status hasn&#39;t been set yet for that user, or the
lesson is not visible for him, it returns an empty array.</p>

<h3 id="method-i-buttons-label-Returns">Returns</h3>

<p>An array of keywords representing buttons (see <a
href="Buttons.html">Buttons</a>)</p>
          

          
          <div class="method-source-code" id="buttons-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 327</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">buttons</span>
  <span class="ruby-keyword">return</span> [] <span class="ruby-keyword">if</span> [<span class="ruby-ivar">@status</span>, <span class="ruby-ivar">@in_vc</span>, <span class="ruby-ivar">@liked</span>, <span class="ruby-ivar">@is_reportable</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-ivar">@status</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">PRIVATE</span>
    [<span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">PREVIEW</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">EDIT</span>, <span class="ruby-identifier">virtual_classroom_button</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLISH</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">COPY</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">DESTROY</span>]
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">COPIED</span>
    [<span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">PREVIEW</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">EDIT</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">DESTROY</span>]
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">LINKED</span>
    [<span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">PREVIEW</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">COPY</span>, <span class="ruby-identifier">virtual_classroom_button</span>, <span class="ruby-identifier">like_button</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">REMOVE</span>]
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLIC</span>
    [<span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">PREVIEW</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">ADD</span>, <span class="ruby-identifier">like_button</span>]
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">SHARED</span>
    [<span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">PREVIEW</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">EDIT</span>, <span class="ruby-identifier">virtual_classroom_button</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">UNPUBLISH</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">COPY</span>, <span class="ruby-constant">Buttons</span><span class="ruby-operator">::</span><span class="ruby-constant">DESTROY</span>]
  <span class="ruby-keyword">else</span>
    []
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- buttons-source -->
          
        </div>

        

        
      </div><!-- buttons-method -->

    
      <div id="method-i-copy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">copy</span><span
            class="method-args">(an_user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-copy-label-Description">Description</h3>

<p>Creates a copy of the lesson for a particular user. First, it checks if
that user is allowed to copy the lesson (he must be the owner of the
lesson, or alternatively he must have a bookmark for that lesson). Then the
method checks if the user hasn&#39;t already copied the lesson. Then it
copies, in sequence:</p>
<ol><li>
<p>the lesson with the cover</p>
</li><li>
<p>the slides (see <a href="Slide.html">Slide</a>)</p>
</li><li>
<p>the media elements attached (see <a
href="MediaElementsSlide.html">MediaElementsSlide</a>)</p>
</li><li>
<p>the tags (see <a href="Tagging.html">Tagging</a>)</p>
</li></ol>

<h3 id="method-i-copy-label-Args">Args</h3>
<ul><li>
<p><strong>an_user_id</strong>: the id of the <a href="User.html">User</a> who
is copying the lesson</p>
</li></ul>

<h3 id="method-i-copy-label-Returns">Returns</h3>

<p>If the process ended correctly, the object of the new lesson,  otherwise
<code>nil</code></p>
          

          
          <div class="method-source-code" id="copy-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 378</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">copy</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">||</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">an_user_id</span>).<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> (<span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">an_user_id</span>) <span class="ruby-operator">||</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">an_user_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:bookmarkable_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Lesson&#39;</span>, <span class="ruby-value">:bookmarkable_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">an_user_id</span>).<span class="ruby-identifier">empty?</span>)
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_copying</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:parent_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">an_user_id</span>).<span class="ruby-identifier">any?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:already_copied</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">copied_not_modified</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:just_copied</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">lesson</span> = <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">new</span> <span class="ruby-value">:subject_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">subject_id</span>, <span class="ruby-value">:school_level_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">school_level_id</span>, <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">title</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">description</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">copied_not_modified</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">an_user_id</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">parent_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">tags</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tags</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_copying</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">new_cover</span> = <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:position</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">new_cover</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_copying</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">cover</span> = <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:position</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">cover_image</span> = <span class="ruby-constant">MediaElementsSlide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:slide_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cover</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">cover_image</span>
      <span class="ruby-identifier">new_cover_image</span> = <span class="ruby-constant">MediaElementsSlide</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-identifier">new_cover_image</span>.<span class="ruby-identifier">media_element_id</span> = <span class="ruby-identifier">cover_image</span>.<span class="ruby-identifier">media_element_id</span>
      <span class="ruby-identifier">new_cover_image</span>.<span class="ruby-identifier">slide_id</span> = <span class="ruby-identifier">new_cover</span>.<span class="ruby-identifier">id</span>
      <span class="ruby-identifier">new_cover_image</span>.<span class="ruby-identifier">position</span> = <span class="ruby-value">1</span>
      <span class="ruby-identifier">new_cover_image</span>.<span class="ruby-identifier">alignment</span> = <span class="ruby-identifier">cover_image</span>.<span class="ruby-identifier">alignment</span>
      <span class="ruby-identifier">new_cover_image</span>.<span class="ruby-identifier">caption</span> = <span class="ruby-identifier">cover_image</span>.<span class="ruby-identifier">caption</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_cover_image</span>.<span class="ruby-identifier">save</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_copying</span>)
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;lesson_id = ? AND position &gt; 1&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:position</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">new_slide</span> = <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">new</span> <span class="ruby-value">:position</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">position</span>, <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">title</span>, <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">text</span>
      <span class="ruby-identifier">new_slide</span>.<span class="ruby-identifier">lesson_id</span> = <span class="ruby-identifier">lesson</span>.<span class="ruby-identifier">id</span>
      <span class="ruby-identifier">new_slide</span>.<span class="ruby-identifier">kind</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">kind</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_slide</span>.<span class="ruby-identifier">save</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_copying</span>)
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">MediaElementsSlide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:slide_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mes</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">new_content</span> = <span class="ruby-constant">MediaElementsSlide</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">new_content</span>.<span class="ruby-identifier">media_element_id</span> = <span class="ruby-identifier">mes</span>.<span class="ruby-identifier">media_element_id</span>
        <span class="ruby-identifier">new_content</span>.<span class="ruby-identifier">slide_id</span> = <span class="ruby-identifier">new_slide</span>.<span class="ruby-identifier">id</span>
        <span class="ruby-identifier">new_content</span>.<span class="ruby-identifier">position</span> = <span class="ruby-identifier">mes</span>.<span class="ruby-identifier">position</span>
        <span class="ruby-identifier">new_content</span>.<span class="ruby-identifier">alignment</span> = <span class="ruby-identifier">mes</span>.<span class="ruby-identifier">alignment</span>
        <span class="ruby-identifier">new_content</span>.<span class="ruby-identifier">caption</span> = <span class="ruby-identifier">mes</span>.<span class="ruby-identifier">caption</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_content</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_copying</span>)
          <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">lesson</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- copy-source -->
          
        </div>

        

        
      </div><!-- copy-method -->

    
      <div id="method-i-cover" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cover</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-cover-label-Description">Description</h3>

<p>Returns the cover slide of the lesson.</p>

<h3 id="method-i-cover-label-Returns">Returns</h3>

<p>An object of type <a href="Slide.html">Slide</a>, or <code>nil</code> if
the lesson is new_record</p>
          

          
          <div class="method-source-code" id="cover-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 244</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cover</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:kind</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Slide</span><span class="ruby-operator">::</span><span class="ruby-constant">COVER</span>, <span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- cover-source -->
          
        </div>

        

        
      </div><!-- cover-method -->

    
      <div id="method-i-destroy_with_notifications" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy_with_notifications</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-destroy_with_notifications-label-Description">Description</h3>

<p>Destroys the lesson and sends notifications to the users who had a <a
href="Bookmark.html">Bookmark</a> of it (the bookmarks are destroyed by the
<code>before_destroy</code> callback).</p>

<h3 id="method-i-destroy_with_notifications-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="destroy_with_notifications-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 576</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy_with_notifications</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:bookmarkable_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Lesson&#39;</span>, <span class="ruby-value">:bookmarkable_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">Notification</span>.<span class="ruby-identifier">send_to</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;notifications.lessons.destroyed&#39;</span>, <span class="ruby-value">:user_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-value">:lesson_title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">title</span>)
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_destroying</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- destroy_with_notifications-source -->
          
        </div>

        

        
      </div><!-- destroy_with_notifications-method -->

    
      <div id="method-i-dont_notify_changes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dont_notify_changes</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-dont_notify_changes-label-Description">Description</h3>

<p>Sets <code>notified</code> as <code>true</code> without sending the
notification of modifications (see <a
href="Lesson.html#method-i-notify_changes">#notify_changes</a>).</p>

<h3 id="method-i-dont_notify_changes-label-Returns">Returns</h3>

<p>A boolean.</p>
          

          
          <div class="method-source-code" id="dont_notify_changes-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 152</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dont_notify_changes</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">notified</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- dont_notify_changes-source -->
          
        </div>

        

        
      </div><!-- dont_notify_changes-method -->

    
      <div id="method-i-in_virtual_classroom-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">in_virtual_classroom?</span><span
            class="method-args">(an_user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-in_virtual_classroom-3F-label-Description">Description</h3>

<p>Checks if the lesson has a corresponding <a
href="VirtualClassroomLesson.html">VirtualClassroomLesson</a> for a
specific USer</p>

<h3 id="method-i-in_virtual_classroom-3F-label-Args">Args</h3>
<ul><li>
<p><strong>an_user_id</strong>: the id of the <a href="User.html">User</a></p>
</li></ul>

<h3 id="method-i-in_virtual_classroom-3F-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="in_virtual_classroom-3F-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 727</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">in_virtual_classroom?</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">an_user_id</span>, <span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">any?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- in_virtual_classroom-3F-source -->
          
        </div>

        

        
      </div><!-- in_virtual_classroom-3F-method -->

    
      <div id="method-i-liked-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">liked?</span><span
            class="method-args">(an_user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-liked-3F-label-Description">Description</h3>

<p>Checks if there is a record of <a href="Like.html">Like</a> for a
particular <a href="User.html">User</a></p>

<h3 id="method-i-liked-3F-label-Args">Args</h3>
<ul><li>
<p><strong>an_user_id</strong>: the id of the <a href="User.html">User</a></p>
</li></ul>

<h3 id="method-i-liked-3F-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="liked-3F-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 744</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">liked?</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-constant">Like</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">an_user_id</span>, <span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">any?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- liked-3F-source -->
          
        </div>

        

        
      </div><!-- liked-3F-method -->

    
      <div id="method-i-modify" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">modify</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-modify-label-Description">Description</h3>

<p>A method that sets all the fields that must be updated at any time the
lesson or one of its slides is modified (that is, this method is related to
the models <a href="Lesson.html">Lesson</a>, <a href="Slide.html">Slide</a>
and <a href="MediaElementsSlide.html">MediaElementsSlide</a>).</p>

<h3 id="method-i-modify-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="modify-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 468</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">modify</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">copied_not_modified</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">notified</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- modify-source -->
          
        </div>

        

        
      </div><!-- modify-method -->

    
      <div id="method-i-not_notified-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">not_notified?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-not_notified-3F-label-Description">Description</h3>

<p>Checks whether the user needs to notify modifications to other users who
have a link of the lesson.</p>

<h3 id="method-i-not_notified-3F-label-Returns">Returns</h3>

<p>A boolean.</p>
          

          
          <div class="method-source-code" id="not_notified-3F-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 165</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">not_notified?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">notified</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;bookmarkable_type = ? AND bookmarkable_id = ? AND created_at &lt; ?&#39;</span>, <span class="ruby-string">&#39;Lesson&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">updated_at</span>).<span class="ruby-identifier">any?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- not_notified-3F-source -->
          
        </div>

        

        
      </div><!-- not_notified-3F-method -->

    
      <div id="method-i-notify_changes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">notify_changes</span><span
            class="method-args">(msg)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-notify_changes-label-Description">Description</h3>

<p>Send a notification (containing the details of modifications) to all the
users who have a link of the lesson. This method is called only if the link
was created <strong>before</strong> that the lesson was modified. The
method also sets <code>notified</code> as <code>true</code>.</p>

<h3 id="method-i-notify_changes-label-Args">Args</h3>
<ul><li>
<p><strong>msg</strong>: details of the modifications</p>
</li></ul>

<h3 id="method-i-notify_changes-label-Returns">Returns</h3>

<p>A boolean.</p>
          

          
          <div class="method-source-code" id="notify_changes-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 132</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">notify_changes</span>(<span class="ruby-identifier">msg</span>)
  <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;bookmarkable_type = ? AND bookmarkable_id = ? AND created_at &lt; ?&#39;</span>, <span class="ruby-string">&#39;Lesson&#39;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">updated_at</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">bo</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">msg</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">send_to</span> <span class="ruby-identifier">bo</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;notifications.lessons.modified&#39;</span>, <span class="ruby-value">:user_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-value">:lesson_title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">title</span>, <span class="ruby-value">:link</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lesson_viewer_path</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>), <span class="ruby-value">:message</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;lessons.notify_modifications.empty_message&#39;</span>))
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">Notification</span>.<span class="ruby-identifier">send_to</span> <span class="ruby-identifier">bo</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;notifications.lessons.modified&#39;</span>, <span class="ruby-value">:user_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-value">:lesson_title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">title</span>, <span class="ruby-value">:link</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lesson_viewer_path</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>), <span class="ruby-value">:message</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">msg</span>[<span class="ruby-value">0</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;language_parameters.notification.message_length_for_public_lesson_modification&#39;</span>)])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">notified</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- notify_changes-source -->
          
        </div>

        

        
      </div><!-- notify_changes-method -->

    
      <div id="method-i-publish" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">publish</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-publish-label-Description">Description</h3>

<p>Sets <code>is_public</code> as <code>true</code> for the lesson and for
each private <a href="MediaElement.html">MediaElement</a> attached to the
lesson through <a href="MediaElementsSlide.html">MediaElementsSlide</a> and
<a href="Slide.html">Slide</a>.</p>

<h3 id="method-i-publish-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="publish-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 482</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">publish</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-identifier">pub_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">zone</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_publishing</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:already_published</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_publishing</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">MediaElementsSlide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:slide_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mes</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">me</span> = <span class="ruby-identifier">mes</span>.<span class="ruby-identifier">media_element</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">me</span>.<span class="ruby-identifier">is_public</span>
          <span class="ruby-identifier">me</span>.<span class="ruby-identifier">is_public</span> = <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">me</span>.<span class="ruby-identifier">publication_date</span> = <span class="ruby-identifier">pub_date</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">me</span>.<span class="ruby-identifier">save</span>
            <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_publishing</span>)
            <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">boo</span> = <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">new</span>
          <span class="ruby-identifier">boo</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span>
          <span class="ruby-identifier">boo</span>.<span class="ruby-identifier">bookmarkable_type</span> = <span class="ruby-string">&#39;MediaElement&#39;</span>
          <span class="ruby-identifier">boo</span>.<span class="ruby-identifier">bookmarkable_id</span> = <span class="ruby-identifier">me</span>.<span class="ruby-identifier">id</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">boo</span>.<span class="ruby-identifier">save</span>
            <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_publishing</span>)
            <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- publish-source -->
          
        </div>

        

        
      </div><!-- publish-method -->

    
      <div id="method-i-reached_the_maximum_of_slides-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reached_the_maximum_of_slides?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-reached_the_maximum_of_slides-3F-label-Description">Description</h3>

<p>Checks if the maximum number of slides has been reached by this lesson
(this number is configured in settings.yml)</p>

<h3 id="method-i-reached_the_maximum_of_slides-3F-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="reached_the_maximum_of_slides-3F-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 638</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reached_the_maximum_of_slides?</span>
  <span class="ruby-constant">Slide</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SETTINGS</span>[<span class="ruby-string">&#39;max_number_slides_in_a_lesson&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- reached_the_maximum_of_slides-3F-source -->
          
        </div>

        

        
      </div><!-- reached_the_maximum_of_slides-3F-method -->

    
      <div id="method-i-remove_from_virtual_classroom" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_from_virtual_classroom</span><span
            class="method-args">(an_user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-remove_from_virtual_classroom-label-Description">Description</h3>

<p>Removes the associated record of <a
href="VirtualClassroomLesson.html">VirtualClassroomLesson</a> for a
particular <a href="User.html">User</a>, if any</p>

<h3 id="method-i-remove_from_virtual_classroom-label-Args">Args</h3>
<ul><li>
<p><strong>an_user_id</strong>: the id of the <a href="User.html">User</a></p>
</li></ul>

<h3 id="method-i-remove_from_virtual_classroom-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="remove_from_virtual_classroom-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 690</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_from_virtual_classroom</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_removing_from_virtual_classroom</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">an_user_id</span>).<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_removing_from_virtual_classroom</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">vc</span> = <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:lesson_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">an_user_id</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">vc</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">vc</span>.<span class="ruby-identifier">remove_from_playlist</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_removing_from_virtual_classroom</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">VirtualClassroomLesson</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">vc</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">destroy</span>
  <span class="ruby-keyword">rescue</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_removing_from_virtual_classroom</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- remove_from_virtual_classroom-source -->
          
        </div>

        

        
      </div><!-- remove_from_virtual_classroom-method -->

    
      <div id="method-i-set_status" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_status</span><span
            class="method-args">(an_user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-set_status-label-Description">Description</h3>

<p>This function fills the attributes <a
href="Lesson.html#attribute-i-is_reportable">#is_reportable</a>, status,
in_vc and linked (the last three being private). If the model has the four
of these attributes different by <code>nil</code>, it means that the lesson
has a status and the application knows which functionalities are available
for the user who requested the lesson. If the status is <code>nil</code>,
it means that the user can&#39;t see that lesson.</p>

<h3 id="method-i-set_status-label-Args">Args</h3>
<ul><li>
<p><strong>an_user_id</strong>: the id of the user who is asking permission to
see the lesson.</p>
</li></ul>
          

          
          <div class="method-source-code" id="set_status-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 293</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_status</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">copied_not_modified</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">an_user_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span>
    <span class="ruby-ivar">@status</span> = <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">PRIVATE</span>
    <span class="ruby-ivar">@is_reportable</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">copied_not_modified</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">an_user_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span>
    <span class="ruby-ivar">@status</span> = <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">COPIED</span>
    <span class="ruby-ivar">@is_reportable</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">an_user_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">bookmarked?</span>(<span class="ruby-identifier">an_user_id</span>)
    <span class="ruby-ivar">@status</span> = <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">LINKED</span>
    <span class="ruby-ivar">@is_reportable</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">an_user_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">bookmarked?</span>(<span class="ruby-identifier">an_user_id</span>)
    <span class="ruby-ivar">@status</span> = <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">PUBLIC</span>
    <span class="ruby-ivar">@is_reportable</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">an_user_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_id</span>
    <span class="ruby-ivar">@status</span> = <span class="ruby-constant">Statuses</span><span class="ruby-operator">::</span><span class="ruby-constant">SHARED</span>
    <span class="ruby-ivar">@is_reportable</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@status</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@is_reportable</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@in_vc</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">in_virtual_classroom?</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-ivar">@liked</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">liked?</span>(<span class="ruby-identifier">an_user_id</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_status-source -->
          
        </div>

        

        
      </div><!-- set_status-method -->

    
      <div id="method-i-status" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">status</span><span
            class="method-args">(with_captions=false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-status-label-Description">Description</h3>

<p>Substitute for the attr_reader relative to the attribute
<code>status</code>.</p>

<h3 id="method-i-status-label-Args">Args</h3>
<ul><li>
<p><strong>with_captions</strong>: if <code>true</code> returns the translated
caption of the status (this means that it&#39;s used in the front-end),
otherwise it returns the status keyword (for default).</p>
</li></ul>

<h3 id="method-i-status-label-Returns">Returns</h3>

<p>A string, or a keyword representing the status (see <a
href="Statuses.html">Statuses</a>)</p>
          

          
          <div class="method-source-code" id="status-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 281</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">status</span>(<span class="ruby-identifier">with_captions</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-ivar">@status</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">with_captions</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Lesson</span>.<span class="ruby-identifier">status</span>(<span class="ruby-ivar">@status</span>) <span class="ruby-operator">:</span> <span class="ruby-ivar">@status</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- status-source -->
          
        </div>

        

        
      </div><!-- status-method -->

    
      <div id="method-i-tags" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tags</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-tags-label-Description">Description</h3>

<p>Used as (unproper) substitute for the attr_reader relative to the attribute
<code>tags</code>: it extracts the tags directly from the database</p>

<h3 id="method-i-tags-label-Returns">Returns</h3>

<p>An array of <a href="Tag.html">Tag</a> objects.</p>
          

          
          <div class="method-source-code" id="tags-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 213</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tags</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">get_friendly_tags</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-string">&#39;Lesson&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- tags-source -->
          
        </div>

        

        
      </div><!-- tags-method -->

    
      <div id="method-i-tags-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tags=</span><span
            class="method-args">(tags)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-tags-3D-label-Description">Description</h3>

<p>Used as (unproper) substitute for the attribute writer relative to the
attribute <code>tags</code>: the attribute <code>tags</code> is filled with
a string of words separated by comma. During the validation,
<code>tags</code> is converted in another attribute called
<code>inner_tags</code>: this attribute is an array of objects of type <a
href="Tag.html">Tag</a> (if the tag doesn&#39;t exist yet, the object is
new_record) ready to be saved together with their taggings in the
<code>after_save</code> validation.</p>

<h3 id="method-i-tags-3D-label-Args">Args</h3>

<p>Either an array of strings, or a string of words separated by comma</p>
          

          
          <div class="method-source-code" id="tags-3D-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 225</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tags=</span>(<span class="ruby-identifier">tags</span>)
  <span class="ruby-ivar">@tags</span> = 
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">tags</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
      <span class="ruby-identifier">tags</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
      <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:to_s</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;,&#39;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@tags</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- tags-3D-source -->
          
        </div>

        

        
      </div><!-- tags-3D-method -->

    
      <div id="method-i-unpublish" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unpublish</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-unpublish-label-Description">Description</h3>

<p>Sets <code>is_public</code> as <code>false</code>, deletes all bookmarks
(see <a href="Bookmark.html">Bookmark</a>) and copies in Virtual Classroom
(see <a href="VirtualClassroomLesson.html">VirtualClassroomLesson</a>)
associated to the present lesson. Also, sends a notification to all the
user who lost a bookmark of the lesson.</p>

<h3 id="method-i-unpublish-label-Returns">Returns</h3>

<p>A boolean</p>
          

          
          <div class="method-source-code" id="unpublish-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 534</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unpublish</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_unpublishing</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span>
    <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:already_unpublished</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Bookmark</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:bookmarkable_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Lesson&#39;</span>, <span class="ruby-value">:bookmarkable_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">begin</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">Notification</span>.<span class="ruby-identifier">send_to</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&#39;notifications.lessons.unpublished&#39;</span>, <span class="ruby-value">:user_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-value">:lesson_title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">title</span>)
          <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_unpublishing</span>)
          <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">b</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
        <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_unpublishing</span>)
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_public</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value">:problem_unpublishing</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">resp</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- unpublish-source -->
          
        </div>

        

        
      </div><!-- unpublish-method -->

    
      <div id="method-i-visive_tags" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">visive_tags</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h3 id="method-i-visive_tags-label-Description">Description</h3>

<p>Returns a string of tags separated by comma and space (“tag1, tag2, tag3”),
by calling a class method of <a href="Tag.html">Tag</a>. This is necessary
for the front end, since in the backend tags are managed without spaces and
with two additional commas in the beginning and in the end of the string
(“,tag1,tag2,tag3,”). It uses <a
href="Tagging.html#method-c-visive_tags">Tagging.visive_tags</a> (see also
<a
href="MediaElement.html#method-i-visive_tags">MediaElement#visive_tags</a>)</p>

<h3 id="method-i-visive_tags-label-Returns">Returns</h3>

<p>A string</p>
          

          
          <div class="method-source-code" id="visive_tags-source">
            <pre><span class="ruby-comment"># File app/models/lesson.rb, line 456</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">visive_tags</span>
  <span class="ruby-constant">Tagging</span>.<span class="ruby-identifier">visive_tags</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">tags</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- visive_tags-source -->
          
        </div>

        

        
      </div><!-- visive_tags-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

