function wrs_int_openNewFormulaEditor(e,t){_wrs_int_window_opened?_wrs_int_window.focus():(_wrs_int_window_opened=!0,_wrs_isNewElement=!0,_wrs_int_temporalIframe=e,_wrs_int_window=wrs_openEditorWindow(t,e,!0))}function wrs_int_openNewCAS(e,t){_wrs_int_window_opened?_wrs_int_window.focus():(_wrs_int_window_opened=!0,_wrs_isNewElement=!0,_wrs_int_temporalIframe=e,_wrs_int_window=wrs_openCASWindow(e,!0,t))}function wrs_int_doubleClickHandler(e,t,i){for(;!wrs_containsClass(i,"Wirisformula")&&!wrs_containsClass(i,"Wiriscas")&&i.parentNode;)i=i.parentNode;var n=i.nodeName.toLowerCase();if("img"==n||"iframe"==n||"span"==n)if(wrs_containsClass(i,"Wirisformula"))if(_wrs_int_wirisProperties={bgColor:e.settings.wirisimagebgcolor,symbolColor:e.settings.wirisimagesymbolcolor,transparency:e.settings.wiristransparency,fontSize:e.settings.wirisimagefontsize,numberColor:e.settings.wirisimagenumbercolor,identColor:e.settings.wirisimageidentcolor,color:e.settings.wirisimagecolor,dpi:e.settings.wirisdpi,backgroundColor:e.settings.wirisimagebackgroundcolor,fontFamily:e.settings.wirisfontfamily},_wrs_int_window_opened)_wrs_int_window.focus();else{var o=e.settings.language;e.settings.wirisformulaeditorlang&&(o=e.settings.wirisformulaeditorlang),_wrs_temporalImage=i,wrs_int_openExistingFormulaEditor(t,o)}else if(wrs_containsClass(i,"Wiriscas"))if(_wrs_int_window_opened)_wrs_int_window.focus();else{var o=e.settings.language;e.settings.wirisformulaeditorlang&&(o=e.settings.wirisformulaeditorlang),_wrs_temporalImage=i,wrs_int_openExistingCAS(t,o)}}function wrs_int_openExistingFormulaEditor(e,t){_wrs_int_window_opened=!0,_wrs_isNewElement=!1,_wrs_int_temporalIframe=e,_wrs_int_window=wrs_openEditorWindow(t,e,!0)}function wrs_int_openExistingCAS(e,t){_wrs_int_window_opened=!0,_wrs_isNewElement=!1,_wrs_int_temporalIframe=e,_wrs_int_window=wrs_openCASWindow(e,!0,t)}function wrs_int_mousedownHandler(e,t){"img"==t.nodeName.toLowerCase()&&(wrs_containsClass(t,"Wirisformula")||wrs_containsClass(t,"Wiriscas"))&&(_wrs_int_temporalImageResizing=t)}function wrs_int_mouseupHandler(){_wrs_int_temporalImageResizing&&setTimeout(function(){_wrs_int_temporalImageResizing.removeAttribute("style"),_wrs_int_temporalImageResizing.removeAttribute("width"),_wrs_int_temporalImageResizing.removeAttribute("height")},10)}function wrs_int_updateFormula(e,t,i){wrs_updateFormula(_wrs_int_temporalIframe.contentWindow,_wrs_int_temporalIframe.contentWindow,e,_wrs_int_wirisProperties,t,i)}function wrs_int_updateCAS(e,t,i,n){wrs_updateCAS(_wrs_int_temporalIframe.contentWindow,_wrs_int_temporalIframe.contentWindow,e,t,i,n)}function wrs_int_notifyWindowClosed(){_wrs_int_window_opened=!1}var _wrs_baseURL;if("undefined"==typeof _wrs_isMoodle24)_wrs_baseURL=tinymce.baseURL;else{var base=tinymce.baseURL,search="lib/editor/tinymce",pos=base.indexOf(search);_wrs_baseURL=tinymce.baseURL.substr(0,pos+search.length)}for(tinymce.ScriptLoader.load(_wrs_baseURL+"/plugins/tiny_mce_wiris/core/core.js");tinymce.ScriptLoader.isDone(_wrs_baseURL+"/plugins/tiny_mce_wiris/core/core.js"););var _wrs_conf_editorEnabled=!0,_wrs_conf_CASEnabled=!0,_wrs_conf_imageMathmlAttribute="data-mathml",_wrs_conf_CASMathmlAttribute="alt",_wrs_conf_editorPath=_wrs_baseURL+"/plugins/tiny_mce_wiris/integration/editor.php",_wrs_conf_editorAttributes="width=570, height=450, scroll=no, resizable=yes",_wrs_conf_CASPath=_wrs_baseURL+"/plugins/tiny_mce_wiris/integration/cas.php",_wrs_conf_CASAttributes="width=640, height=480, scroll=no, resizable=yes",_wrs_conf_createimagePath=_wrs_baseURL+"/plugins/tiny_mce_wiris/integration/createimage.php",_wrs_conf_createcasimagePath=_wrs_baseURL+"/plugins/tiny_mce_wiris/integration/createcasimage.php",_wrs_conf_getmathmlPath=_wrs_baseURL+"/plugins/tiny_mce_wiris/integration/getmathml.php",_wrs_conf_servicePath=_wrs_baseURL+"/plugins/tiny_mce_wiris/integration/service.php",_wrs_conf_getconfigPath=_wrs_baseURL+"/plugins/tiny_mce_wiris/integration/getconfig.php",_wrs_conf_saveMode="tags",_wrs_conf_parseModes=["latex"],_wrs_conf_defaultEditMode="images",_wrs_conf_enableAccessibility=!0,_wrs_conf_pluginBasePath=_wrs_baseURL+"/plugins/tiny_mce_wiris",_wrs_int_editorIcon=_wrs_baseURL+"/plugins/tiny_mce_wiris/core/icons/tiny_mce/formula.gif",_wrs_int_CASIcon=_wrs_baseURL+"/plugins/tiny_mce_wiris/core/icons/tiny_mce/cas.gif",_wrs_int_temporalIframe,_wrs_int_window,_wrs_int_window_opened=!1,_wrs_int_temporalImageResizing,_wrs_int_wirisProperties,_wrs_int_directionality,configuration={};if(".php"==_wrs_conf_getconfigPath.substr(_wrs_conf_getconfigPath.length-4)){var httpRequest;if("undefined"!=typeof XMLHttpRequest)if("Microsoft Internet Explorer"==navigator.appName&&-1!=navigator.appVersion.indexOf("MSIE 8.0"))try{httpRequest=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{httpRequest=new ActiveXObject("Microsoft.XMLHTTP")}catch(oc){}}else httpRequest=new XMLHttpRequest;else try{httpRequest=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{httpRequest=new ActiveXObject("Microsoft.XMLHTTP")}catch(oc){}}"/"==_wrs_conf_getconfigPath.substr(0,1)||"http://"==_wrs_conf_getconfigPath.substr(0,7)||"https://"==_wrs_conf_getconfigPath.substr(0,8)?httpRequest.open("GET",_wrs_conf_getconfigPath,!1):httpRequest.open("GET",_wrs_currentPath+_wrs_conf_getconfigPath,!1),httpRequest.send(null);try{configuration=eval("("+httpRequest.responseText+")")}catch(e){}}"wirisformulaeditoractive"in configuration&&(_wrs_conf_editorEnabled=1==configuration.wirisformulaeditoractive),"wiriscasactive"in configuration&&(_wrs_conf_CASEnabled=1==configuration.wiriscasactive),function(){tinymce.create("tinymce.plugins.tiny_mce_wiris",{init:function(e){var t;"undefined"!=typeof _wrs_isMoodle24&&_wrs_isMoodle24&&(e.settings.extended_valid_elements+=",img[*]"),e.onInit.add(function(e){function i(){if(window.wrs_initParse){var n=e.getParam("language");if(_wrs_int_directionality=e.getParam("directionality"),e.settings.wirisformulaeditorlang&&(n=e.settings.wirisformulaeditorlang),0==configuration.wirisparselatex){var s=wrs_arrayContains(_wrs_conf_parseModes,"latex");-1!=s&&_wrs_conf_parseModes.splice(s,1)}else if(1==configuration.wirisparselatex){var s=wrs_arrayContains(_wrs_conf_parseModes,"latex");-1==s&&_wrs_conf_parseModes.push("latex")}e.getParam("fullscreen_is_enabled")||e.setContent(wrs_initParse(o,n)),t=e.getContentAreaContainer().firstChild,wrs_initParseImgToIframes(t.contentWindow),wrs_addIframeEvents(t,function(t,i){wrs_int_doubleClickHandler(e,t,i)},wrs_int_mousedownHandler,wrs_int_mouseupHandler)}else setTimeout(i,50)}var n=e.getElement(),o="value"in n?n.value:n.innerHTML;i()}),e.onSaveContent.add(function(e,t){_wrs_int_wirisProperties={bgColor:e.settings.wirisimagebgcolor,symbolColor:e.settings.wirisimagesymbolcolor,transparency:e.settings.wiristransparency,fontSize:e.settings.wirisimagefontsize,numberColor:e.settings.wirisimagenumbercolor,identColor:e.settings.wirisimageidentcolor,color:e.settings.wirisimagecolor,dpi:e.settings.wirisdpi,backgroundColor:e.settings.wirisimagebackgroundcolor,fontFamily:e.settings.wirisfontfamily};var i=e.getParam("language");_wrs_int_directionality=e.getParam("directionality"),e.settings.wirisformulaeditorlang&&(i=e.settings.wirisformulaeditorlang),t.content=wrs_endParse(t.content,_wrs_int_wirisProperties,i)}),_wrs_conf_editorEnabled&&(e.addCommand("tiny_mce_wiris_openFormulaEditor",function(){_wrs_int_wirisProperties={bgColor:e.settings.wirisimagebgcolor,symbolColor:e.settings.wirisimagesymbolcolor,transparency:e.settings.wiristransparency,fontSize:e.settings.wirisimagefontsize,numberColor:e.settings.wirisimagenumbercolor,identColor:e.settings.wirisimageidentcolor,color:e.settings.wirisimagecolor,dpi:e.settings.wirisdpi,backgroundColor:e.settings.wirisimagebackgroundcolor,fontFamily:e.settings.wirisfontfamily};var i=e.getParam("language");_wrs_int_directionality=e.getParam("directionality"),e.settings.wirisformulaeditorlang&&(i=e.settings.wirisformulaeditorlang),wrs_int_openNewFormulaEditor(t,i)}),e.addButton("tiny_mce_wiris_formulaEditor",{title:"WIRIS editor",cmd:"tiny_mce_wiris_openFormulaEditor",image:_wrs_int_editorIcon})),_wrs_conf_CASEnabled&&(e.addCommand("tiny_mce_wiris_openCAS",function(){var i=e.settings.language;e.settings.wirisformulaeditorlang&&(i=e.settings.wirisformulaeditorlang),wrs_int_openNewCAS(t,i)}),e.addButton("tiny_mce_wiris_CAS",{title:"WIRIS cas",cmd:"tiny_mce_wiris_openCAS",image:_wrs_int_CASIcon}))},getInfo:function(){return{longname:"tiny_mce_wiris",author:"Juan Lao Tebar - Maths for More",authorurl:"http://www.wiris.com",infourl:"http://www.mathsformore.com",version:"1.0"}}}),tinymce.PluginManager.add("tiny_mce_wiris",tinymce.plugins.tiny_mce_wiris)}();