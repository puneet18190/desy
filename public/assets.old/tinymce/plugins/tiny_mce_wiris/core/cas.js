function getMathmlFromAppletCode(e){var t=document.getElementById("optionForm");appletObject=wrs_int_opener.wrs_createObject(e,document),t.width.value=parseInt(appletObject.width),t.height.value=parseInt(appletObject.height);for(var n=appletObject.childNodes,a="",r=0;r<n.length;++r)"xmlinitialtext"==n[r].name?a=n[r].value:"requestfirstevaluation"==n[r].name?t.executeonload.checked="true"==n[r].value?!0:!1:"toolbar"==n[r].name?t.toolbar.checked="floating"==n[r].value?!1:!0:"requestfocus"==n[r].name?t.focusonload.checked="true"==n[r].value?!0:!1:"level"==n[r].name&&(t.level.checked="primary"==n[r].value?!0:!1);return a}function createIframePath(e){var t=wrs_int_opener._wrs_conf_CASPath;t+=(-1==t.indexOf("?")?"?":"&")+"mode=applet&";for(var n in e)t+=wrs_int_opener.wrs_urlencode(n)+"="+wrs_int_opener.wrs_urlencode(e[n]);return t}function createIframe(e){var t=document.createElement("iframe");t.id="appletContainerIframe",t.src=createIframePath(e),t.width="100%",t.height="100%",t.frameBorder=0,wrs_int_opener.wrs_addEvent(t,"load",function(){function e(){try{n.isActive()?n.setXML(initialXML):setTimeout(e,50)}catch(t){setTimeout(e,50)}}if(initialXML.length>0){var n=t.contentWindow.document.getElementById("applet");e()}}),document.getElementById("appletContainer").appendChild(t)}function reloadIframe(e){var t=document.getElementById("appletContainerIframe"),n=t.contentWindow.document.getElementById("applet");initialXML=n.getXML(),t.src=createIframePath(e)}var wrs_int_opener,appletObject,initialXML="",closeFunction;if(window.opener)wrs_int_opener=window.opener,closeFunction=window.close;else for(wrs_int_opener=window.parent;wrs_int_opener.InnerDialogLoaded;)wrs_int_opener=wrs_int_opener.parent;window.parent.InnerDialogLoaded?(window.parent.InnerDialogLoaded(),closeFunction=window.parent.Cancel):window.opener.parent.FCKeditorAPI&&(wrs_int_opener=window.opener.parent),wrs_int_opener.wrs_addEvent(window,"load",function(){var e=document.getElementById("languageList");wrs_int_opener.wrs_addEvent(e,"change",function(){reloadIframe({lang:e.value})});var t;if(wrs_int_opener._wrs_isNewElement){for(var n=wrs_int_opener.wrs_getQueryParams(window),a=new Array,r=0;r<e.options.length;r++)a[r]=e.options[r].value;t="undefined"!=typeof n.lang&&-1!=wrs_int_opener.wrs_arrayContains(a,n.lang)?n.lang:"undefined"!=typeof n.lang&&-1!=wrs_int_opener.wrs_arrayContains(a,n.lang.substr(0,2))?n.lang.substr(0,2):wrs_int_opener._wrs_int_language}else{var o=wrs_int_opener._wrs_temporalImage.getAttribute(wrs_int_opener._wrs_conf_CASMathmlAttribute);initialXML=getMathmlFromAppletCode(wrs_int_opener.wrs_mathmlDecode(o));var t="",i=initialXML.indexOf('lang="');if(-1!=i){var l=initialXML.indexOf('"',i+6);-1!=l&&(t=initialXML.substring(i+6,l))}}createIframe({lang:t});for(var r=e.options.length-1;r>=0;--r)e.options[r].value==t&&(e.selectedIndex=r,r=0);wrs_int_opener.wrs_addEvent(document.getElementById("submit"),"click",function(){function e(){if(t.getSize().width!=a||t.getSize().height!=r)setTimeout(e,100);else{var n=t.getImageBase64("png");window.parent.InnerDialogLoaded&&window.parent.FCKBrowserInfo.IsIE?(closeFunction(),wrs_int_opener.wrs_int_updateCAS(o,n,a,r)):(wrs_int_opener.wrs_int_updateCAS(o,n,a,r),closeFunction())}}var t=document.getElementById("appletContainerIframe").contentWindow.document.getElementById("applet"),n=document.getElementById("optionForm"),a=parseInt(n.width.value),r=parseInt(n.height.value),o='<applet alt="WIRIS cas" class="Wiriscas" align="middle" ';o+='codebase="'+t.getAttribute("codebase")+'" ',o+='archive="'+t.getAttribute("archive")+'" ',o+='code="'+t.getAttribute("code")+'" ',o+='width="'+a+'" height="'+r+'">',o+='<param name="requestfirstevaluation" value="'+(n.executeonload.checked?"true":"false")+'"></param>',o+='<param name="toolbar" value="'+(n.toolbar.checked?"true":"floating")+'"></param>',o+='<param name="requestfocus" value="'+(n.focusonload.checked?"true":"false")+'"></param>',o+='<param name="level" value="'+(n.level.checked?"primary":"false")+'"></param>',o+='<param name="xmlinitialtext" value="'+wrs_int_opener.wrs_htmlentities(t.getXML())+'"></param>',o+='<param name="interface" value="false"></param><param name="commands" value="false"></param><param name="command" value="false"></param>',o+="</applet>",t.style.width=a+"px",t.style.height=r+"px",e()}),wrs_int_opener.wrs_addEvent(document.getElementById("cancel"),"click",function(){closeFunction()});var s=document.getElementById("submit");null!=strings.accept&&(s.value=strings.accept);var d=document.getElementById("cancel");null!=strings.cancel&&(d.value=strings.cancel),setInterval(function(){document.getElementById("appletContainer").style.height=document.getElementById("optionForm").offsetHeight-document.getElementById("controls").offsetHeight-5+"px"},100)}),wrs_int_opener.wrs_addEvent(window,"unload",function(){wrs_int_opener.wrs_int_notifyWindowClosed()});