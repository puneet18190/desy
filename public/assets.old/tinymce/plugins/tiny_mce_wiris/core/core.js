function wrs_addElementEvents(e,t,r,n){t&&wrs_addEvent(e,"dblclick",function(r){var n=r?r:window.event,s=n.srcElement?n.srcElement:n.target;t(e,s,n)}),r&&wrs_addEvent(e,"mousedown",function(t){var n=t?t:window.event,s=n.srcElement?n.srcElement:n.target;_wrs_temporalFocusElement=s,r(e,s,n)}),n&&wrs_addEvent(e,"mouseup",function(t){var r=t?t:window.event,s=r.srcElement?r.srcElement:r.target;n(e,s,r)})}function wrs_addEvent(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)}function wrs_addIframeEvents(e,t,r,n){wrs_addElementEvents(e.contentWindow.document,function(r,n,s){t(e,n,s)},function(t,n,s){r(e,n,s)},function(t,r,s){n(e,r,s)})}function wrs_addTextareaEvents(e,t){t&&wrs_addEvent(e,"click",function(r){var n=r?r:window.event;t(e,n)})}function wrs_appletCodeToImgObject(e,t,r,n,s){var a=wrs_createImageCASSrc(r),i=e.createElement("img");return i.src=a,i.align="middle",i.width=n,i.height=s,i.setAttribute(_wrs_conf_CASMathmlAttribute,wrs_mathmlEncode(t)),i.className=_wrs_conf_CASClassName,i}function wrs_arrayContains(e,t){for(var r=e.length-1;r>=0;--r)if(e[r]===t)return r;return-1}function wrs_containsClass(e,t){if(!("className"in e))return!1;for(var r=e.className.split(" "),n=r.length-1;n>=0;--n)if(r[n]==t)return!0;return!1}function wrs_convertOldXmlinitialtextAttribute(e){var t="value=",r=e.indexOf("xmlinitialtext"),n=e.indexOf(t,r),s=e.charAt(n+t.length),a=n+t.length+1,i=e.indexOf(s,a),o=e.substring(a,i),l=o.split("\xab").join("\xa7lt;");return l=l.split("\xbb").join("\xa7gt;"),l=l.split("&").join("\xa7"),l=l.split("\xa8").join("\xa7quot;"),e=e.split(o).join(l)}function wrs_createElement(e,t,r){void 0===t&&(t={}),void 0===r&&(r=document);var n;try{var s="<"+e;for(var a in t)s+=" "+a+'="'+wrs_htmlentities(t[a])+'"';s+=">",n=r.createElement(s)}catch(i){n=r.createElement(e);for(var a in t)n.setAttribute(a,t[a])}return n}function wrs_createHttpRequest(){if("file://"==_wrs_currentPath.substr(0,7))throw"Cross site scripting is only allowed for HTTP.";if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}return!1}function wrs_createImageCASSrc(e,t){var r={image:e,mml:t};return wrs_getContent(_wrs_conf_createcasimagePath,r)}function wrs_createImageSrc(e,t){var r=t?t:{};r.mml=e,window._wrs_conf_useDigestInsteadOfMathml&&_wrs_conf_useDigestInsteadOfMathml&&(r.returnDigest="true");var n=wrs_getContent(_wrs_conf_createimagePath,r);if(-1!=n.indexOf("@BASE@")){var s=_wrs_conf_createimagePath.split("/");s.pop(),n=n.split("@BASE@").join(s.join("/"))}return n}function wrs_createObject(e,t){function r(e){if(e.getAttribute&&"WirisParam"==e.getAttribute("wirisObject")){for(var n={},s=0;s<e.attributes.length;++s)null!==e.attributes[s].nodeValue&&(n[e.attributes[s].nodeName]=e.attributes[s].nodeValue);var a=wrs_createElement("param",n,t);a.NAME&&(a.name=a.NAME,a.value=a.VALUE),a.removeAttribute("wirisObject"),e.parentNode.replaceChild(a,e)}else if(e.getAttribute&&"WirisApplet"==e.getAttribute("wirisObject")){for(var n={},s=0;s<e.attributes.length;++s)null!==e.attributes[s].nodeValue&&(n[e.attributes[s].nodeName]=e.attributes[s].nodeValue);var i=wrs_createElement("applet",n,t);i.removeAttribute("wirisObject");for(var s=0;s<e.childNodes.length;++s)r(e.childNodes[s]),"param"==e.childNodes[s].nodeName.toLowerCase()&&(i.appendChild(e.childNodes[s]),--s);e.parentNode.replaceChild(i,e)}else for(var s=0;s<e.childNodes.length;++s)r(e.childNodes[s])}void 0===t&&(t=document),e=e.split("<applet ").join('<span wirisObject="WirisApplet" ').split("<APPLET ").join('<span wirisObject="WirisApplet" '),e=e.split("</applet>").join("</span>").split("</APPLET>").join("</span>"),e=e.split("<param ").join('<br wirisObject="WirisParam" ').split("<PARAM ").join('<br wirisObject="WirisParam" '),e=e.split("</param>").join("</br>").split("</PARAM>").join("</br>");var n=wrs_createElement("div",{},t);return n.innerHTML=e,r(n),n.firstChild}function wrs_createObjectCode(e){if(1==e.nodeType){for(var t="<"+e.tagName,r=0;r<e.attributes.length;++r)e.attributes[r].specified&&(t+=" "+e.attributes[r].name+'="'+wrs_htmlentities(e.attributes[r].value)+'"');if(e.childNodes.length>0){t+=">";for(var r=0;r<e.childNodes.length;++r)t+=wrs_createObjectCode(e.childNodes[r]);t+="</"+e.tagName+">"}else t+="DIV"==e.nodeName||"SCRIPT"==e.nodeName?"></"+e.tagName+">":"/>";return t}return 3==e.nodeType?wrs_htmlentities(e.nodeValue):""}function wrs_endParse(e,t,r){return e=wrs_endParseEditMode(e,t,r),wrs_endParseSaveMode(e)}function wrs_regexpIndexOf(e,t,r){var n=e.substring(r||0).search(t);return n>=0?n+(r||0):n}function wrs_endParseEditMode(e,t,r){if(void 0!==window._wrs_conf_parseModes&&-1!=wrs_arrayContains(_wrs_conf_parseModes,"latex")){for(var n="",s=0,a=e.indexOf("$$");-1!=a;){if(n+=e.substring(s,a),s=e.indexOf("$$",a+2),-1!=s){var i=e.substring(a+2,s);i=wrs_htmlentitiesDecode(i);var o=wrs_getMathMLFromLatex(i,!0),l=wrs_mathmlToImgObject(document,o,t,r);n+=wrs_createObjectCode(l),s+=2}else n+="$$",s=a+2;a=e.indexOf("$$",s)}n+=e.substring(s,e.length),e=n}if(window._wrs_conf_defaultEditMode&&"iframes"==_wrs_conf_defaultEditMode){for(var n="",c=' class="'+_wrs_conf_imageClassName+'"',_=e.indexOf(c),s=0;-1!=_;){a=_;for(var d=_,m=!1;d>=0&&!m;){var u=e.charAt(d);if('"'==u||"'"==u){var w=e.lastIndexOf(u,d);d=-1==w?-1:w}else"<"==u?(a=d,m=!0):">"==u&&(d=-1);--d}if(n+=e.substring(s,a),m){d=_;for(var f=1;d<e.length&&f>0;){var u=e.charAt(d);if('"'==u||"'"==u){var w=e.indexOf(u,d);d=-1==w?e.length:w}else"<"==u?d+1<e.length&&"/"==e.charAt(d+1)?(--f,0==f&&(s=e.indexOf(">",d)+1,-1==s&&(f=-1))):++f:">"==u&&"/"==e.charAt(d-1)&&(--f,0==f&&(s=d+1));++d}if(0==f){var g=e.substring(a,s),p=wrs_createObject(g),o=p.getAttribute(_wrs_conf_imageMathmlAttribute);null==o&&(o=p.getAttribute("alt"));var l=wrs_mathmlToImgObject(document,o,t,r);n+=wrs_createObjectCode(l)}else n+=e.charAt(_),s=_+1}else n+=e.charAt(_),s=_+1;_=e.indexOf(c,s)}n+=e.substring(s,e.length),e=n}return e}function wrs_endParseSaveMode(e){var t="",r=!1,n=!1;window._wrs_conf_saveMode&&("safeXml"==_wrs_conf_saveMode?(r=!0,n=!0):"xml"==_wrs_conf_saveMode&&(r=!0));for(var s=0,a=/<img/gi,i=a.source.length;a.test(e);){var o=a.lastIndex-i;t+=e.substring(s,o);for(var l=o+1;l<e.length&&o>=s;){var c=e.charAt(l);if('"'==c||"'"==c){var _=e.indexOf(c,l+1);l=-1==_?e.length:_}else">"==c&&(s=l+1);++l}if(o>s)return t+=e.substring(o,e.length);var d=e.substring(o,s);t+=wrs_getWIRISImageOutput(d,r,n)}return t+=e.substring(s,e.length)}function wrs_fireEvent(e,t){if(document.createEvent){var r=document.createEvent("HTMLEvents");return r.initEvent(t,!0,!0),!e.dispatchEvent(r)}var r=document.createEventObject();return e.fireEvent("on"+t,r)}function wrs_getCode(e,t){var r={};return r[e]=t,wrs_getContent(_wrs_conf_getmathmlPath,r)}function wrs_getContent(e,t){try{var r=wrs_createHttpRequest();if(r)return"/"==e.substr(0,1)||"http://"==e.substr(0,7)||"https://"==e.substr(0,8)?r.open("POST",e,!1):r.open("POST",_wrs_currentPath+e,!1),void 0!==t?(r.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),r.send(wrs_httpBuildQuery(t))):r.send(null),r.responseText;alert("Your browser is not compatible with AJAX technology. Please, use the latest version of Mozilla Firefox.")}catch(n){}return""}function wrs_getInnerHTML(e){for(var t="",r=0;r<e.childNodes.length;++r)t+=wrs_createObjectCode(e.childNodes[r]);return t}function wrs_getLatexFromMathML(e){var t={service:"mathml2latex",mml:e};return wrs_getContent(_wrs_conf_servicePath,t)}function wrs_getLatexFromTextNode(e,t){function r(e,t){for(var r=e.nodeValue.indexOf("$$",t);-1==r;){if(e=e.nextSibling,!e||3!=e.nodeType)return null;r=e.nodeValue.indexOf("$$")}return{node:e,position:r}}function n(e,t,r,n){if(e==r)return n>=t;for(;e&&e!=r;)e=e.nextSibling;return e==r}for(var s=e;s.previousSibling&&3==s.previousSibling.nodeType;)s=s.previousSibling;var a,i={node:s,position:0};do{var a=r(i.node,i.position);if(null==a||n(e,t,a.node,a.position))return null;var i=r(a.node,a.position+2);if(null==i)return null;i.position+=2}while(n(i.node,i.position,e,t));var o;if(a.node==i.node)o=a.node.nodeValue.substring(a.position+2,i.position-2);else{o=a.node.nodeValue.substring(a.position+2,a.node.nodeValue.length);var l=a.node;do l=l.nextSibling,o+=l==i.node?i.node.nodeValue.substring(0,i.position-2):l.nodeValue;while(l!=i.node)}return{latex:o,startNode:a.node,startPosition:a.position,endNode:i.node,endPosition:i.position}}function wrs_getMathMLFromLatex(e,t){var r={service:"latex2mathml",latex:e};t&&(r.saveLatex="");var n=wrs_getContent(_wrs_conf_servicePath,r);return n.split("\r").join("").split("\n").join(" ")}function wrs_getNodeLength(e){if(3==e.nodeType)return e.nodeValue.length;if(1==e.nodeType){var t=_wrs_staticNodeLengths[e.nodeName.toUpperCase()];void 0===t&&(t=0);for(var r=0;r<e.childNodes.length;++r)t+=wrs_getNodeLength(e.childNodes[r]);return t}return 0}function wrs_getQueryParams(e){var t={},r=e.location.search.indexOf("?");r=-1==r?0:r+1;for(var n=e.location.search.substr(r).split("&"),s=0;s<n.length;++s){var a=n[s].split("=",2);t[a[0]]=wrs_urldecode(a[1])}return t}function wrs_getSelectedItem(e,t,r){var n;if(t?(n=e.contentWindow,n.focus()):(n=window,e.focus()),document.selection&&!r){var s=n.document.selection.createRange();if(s.parentElement){if(s.htmlText.length>0)return 0==s.text.length?wrs_getSelectedItem(e,t,!0):null;n.document.execCommand("InsertImage",!1,"#");var a=s.parentElement();"IMG"!=a.nodeName.toUpperCase()&&(s.pasteHTML('<span id="wrs_openEditorWindow_temporalObject"></span>'),a=n.document.getElementById("wrs_openEditorWindow_temporalObject"));var i,o;return a.nextSibling&&3==a.nextSibling.nodeType?(i=a.nextSibling,o=0):a.previousSibling&&3==a.previousSibling.nodeType?(i=a.previousSibling,o=i.nodeValue.length):(i=n.document.createTextNode(""),a.parentNode.insertBefore(i,a),o=0),a.parentNode.removeChild(a),{node:i,caretPosition:o}}return s.length>1?null:{node:s.item(0)}}if(n.getSelection){var l=n.getSelection();try{var s=l.getRangeAt(0)}catch(c){var s=n.document.createRange()}var i=s.startContainer;if(3==i.nodeType)return s.startOffset!=s.endOffset?null:{node:i,caretPosition:s.startOffset};if(1==i.nodeType){var _=s.startOffset;if(i.childNodes[_])return{node:i.childNodes[_]}}}return null}function wrs_getWIRISImageOutput(e,t,r){var n=wrs_createObject(e);if(n){if(n.className==_wrs_conf_imageClassName){if(!t)return e;var s=n.getAttribute(_wrs_conf_imageMathmlAttribute);return null==s&&(s=n.getAttribute("alt")),r||(s=wrs_mathmlDecode(s)),s}if(n.className==_wrs_conf_CASClassName){var a=n.getAttribute(_wrs_conf_CASMathmlAttribute);a=wrs_mathmlDecode(a);var i=wrs_createObject(a);i.setAttribute("src",n.src);var o=wrs_createObjectCode(i);return r&&(o=wrs_mathmlEncode(o)),o}}return e}function wrs_htmlentities(e){return e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")}function wrs_htmlentitiesDecode(e){return e.split("&quot;").join('"').split("&gt;").join(">").split("&lt;").join("<").split("&amp;").join("&")}function wrs_httpBuildQuery(e){var t="";for(i in e)null!=e[i]&&(t+=wrs_urlencode(i)+"="+wrs_urlencode(e[i])+"&");return t}function wrs_initParse(e,t){return e=wrs_initParseSaveMode(e,t),wrs_initParseEditMode(e)}function wrs_initParseImgToIframes(e){if(window._wrs_conf_defaultEditMode&&"iframes"==_wrs_conf_defaultEditMode)for(var t=e.document.getElementsByTagName("img"),r=0;r<t.length;)if(t[r].className==_wrs_conf_imageClassName){var n=t[r].getAttribute(_wrs_conf_imageMathmlAttribute);null==n&&(n=t[r].getAttribute("alt"));var s=wrs_mathmlToIframeObject(e,wrs_mathmlDecode(n));t[r].parentNode.replaceChild(s,t[r])}else++r}function wrs_initParseEditMode(e){if(void 0!==window._wrs_conf_parseModes&&-1!=wrs_arrayContains(_wrs_conf_parseModes,"latex"))for(var t=wrs_getElementsByNameFromString(e,"img",!0),r='encoding="LaTeX">',n=0,s=0;s<t.length;++s){var a=e.substring(t[s].start+n,t[s].end+n);if(-1!=a.indexOf(' class="'+_wrs_conf_imageClassName+'"')){var i=" "+_wrs_conf_imageMathmlAttribute+'="',o=a.indexOf(i);if(-1==o&&(i=' alt="',o=a.indexOf(i)),-1!=o){o+=i.length;var l=a.indexOf('"',o),c=wrs_mathmlDecode(a.substring(o,l)),_=c.indexOf(r);if(-1!=_){_+=r.length;var d=c.indexOf("</annotation>",_),m=c.substring(_,d),u="$$"+wrs_htmlentitiesDecode(m)+"$$";e=e.substring(0,t[s].start+n)+u+e.substring(t[s].end+n),n+=u.length-(t[s].end-t[s].start)}}}}return e}function wrs_initParseSaveMode(e,t){window._wrs_conf_saveMode&&("safeXml"==_wrs_conf_saveMode?(e=wrs_mathmlDecodeSafeXmlEntities(e),e=wrs_parseSafeAppletsToObjects(e),e=wrs_parseMathmlToLatex(e,_wrs_safeXmlCharacters),e=wrs_parseMathmlToImg(e,_wrs_safeXmlCharacters,t)):"xml"==_wrs_conf_saveMode&&(e=wrs_parseMathmlToLatex(e,_wrs_xmlCharacters),e=wrs_parseMathmlToImg(e,_wrs_xmlCharacters,t)));for(var r=wrs_getElementsByNameFromString(e,"applet",!1),n=0,s=0;s<r.length;++s){var a=e.substring(r[s].start+n,r[s].end+n);if(-1!=a.indexOf(' class="'+_wrs_conf_CASClassName+'"')||-1!=a.toUpperCase().indexOf("WIRIS")){if(-1!=a.indexOf(' src="'))var i=a.indexOf(' src="')+' src="'.length,o=a.indexOf('"',i),l=a.substring(i,o);else{if("undefined"!=typeof _wrs_conf_pluginBasePath)var l=_wrs_conf_pluginBasePath+"/integration/showcasimage.php?formula=noimage";else var l="";if(-1==a.indexOf(' class="'+_wrs_conf_CASClassName+'"')){var c=a.indexOf(">"),_=a.substring(0,c),d=_.split(" width=").join(' class="Wiriscas" width=');a=a.split(_).join(d),a=a.split("'").join('"')}}var m='<img align="middle" class="'+_wrs_conf_CASClassName+'" '+_wrs_conf_CASMathmlAttribute+'="'+wrs_mathmlEncode(a)+'" src="'+l+'" />';e=e.substring(0,r[s].start+n)+m+e.substring(r[s].end+n),n+=m.length-(r[s].end-r[s].start)}}return e}function wrs_getElementsByNameFromString(e,t,r){var n=[],e=e.toLowerCase();t=t.toLowerCase();for(var s=e.indexOf("<"+t+" ");-1!=s;){var a;a=r?">":"</"+t+">";var i=e.indexOf(a,s);-1!=i?(i+=a.length,n.push({start:s,end:i})):i=s+1,s=e.indexOf("<"+t+" ",i)}return n}function wrs_insertElementOnSelection(e,t,r){try{if(t.focus(),_wrs_isNewElement)if(document.selection){var n=r.document.selection.createRange();if(r.document.execCommand("InsertImage",!1,e.src),"parentElement"in n||(r.document.execCommand("delete",!1),n=r.document.selection.createRange(),r.document.execCommand("InsertImage",!1,e.src)),"parentElement"in n){var s=n.parentElement();"IMG"==s.nodeName.toUpperCase()?s.parentNode.replaceChild(e,s):n.pasteHTML(wrs_createObjectCode(e))}}else{var a=!1;if(_wrs_androidRange)var a=!0,n=_wrs_androidRange;else{var i=r.getSelection();try{var n=i.getRangeAt(0)}catch(o){var n=r.document.createRange()}i.removeAllRanges()}n.deleteContents();var l=n.startContainer,c=n.startOffset;3==l.nodeType?(l=l.splitText(c),l.parentNode.insertBefore(e,l),l=l.parentNode):1==l.nodeType&&l.insertBefore(e,l.childNodes[c]),a||(n.selectNode(e),c=n.endOffset,i.collapse(l,c))}else if(_wrs_temporalRange)if(document.selection)_wrs_isNewElement=!0,_wrs_temporalRange.select(),wrs_insertElementOnSelection(e,t,r);else{{_wrs_temporalRange.startContainer}_wrs_temporalRange.deleteContents(),_wrs_temporalRange.insertNode(e)}else _wrs_temporalImage.parentNode.replaceChild(e,_wrs_temporalImage)}catch(o){}}function wrs_isMathmlInAttribute(e,t){var r="['\"][\\s]*=[\\s]*[\\w-]+",n="\"[^\"]*\"|'[^']*'",s="[\\s]*("+n+")[\\s]*=[\\s]*[\\w-]+[\\s]*",a="("+s+")*",i="^"+r+a+"[\\s]+gmi<",o=new RegExp(i),l=e.substring(0,t),c=l.split("").reverse().join(""),_=o.test(c);return _}function wrs_mathmlDecodeSafeXmlEntities(e){return e=e.split(_wrs_safeXmlCharactersEntities.tagOpener).join(_wrs_safeXmlCharacters.tagOpener),e=e.split(_wrs_safeXmlCharactersEntities.tagCloser).join(_wrs_safeXmlCharacters.tagCloser),e=e.split(_wrs_safeXmlCharactersEntities.doubleQuote).join(_wrs_safeXmlCharacters.doubleQuote),e=e.split(_wrs_safeXmlCharactersEntities.realDoubleQuote).join(_wrs_safeXmlCharacters.realDoubleQuote)}function wrs_mathmlDecode(e){return e=wrs_mathmlDecodeSafeXmlEntities(e),"_wrs_blackboard"in window&&window._wrs_blackboard&&(e=e.split(_wrs_safeBadBlackboardCharacters.ltElement).join(_wrs_safeGoodBlackboardCharacters.ltElement),e=e.split(_wrs_safeBadBlackboardCharacters.gtElement).join(_wrs_safeGoodBlackboardCharacters.gtElement),e=e.split(_wrs_safeBadBlackboardCharacters.ampElement).join(_wrs_safeGoodBlackboardCharacters.ampElement)),e=e.split(_wrs_safeXmlCharacters.tagOpener).join(_wrs_xmlCharacters.tagOpener),e=e.split(_wrs_safeXmlCharacters.tagCloser).join(_wrs_xmlCharacters.tagCloser),e=e.split(_wrs_safeXmlCharacters.doubleQuote).join(_wrs_xmlCharacters.doubleQuote),e=e.split(_wrs_safeXmlCharacters.ampersand).join(_wrs_xmlCharacters.ampersand),e=e.split(_wrs_safeXmlCharacters.quote).join(_wrs_xmlCharacters.quote),e=e.split("$").join("&")}function wrs_mathmlEncode(e){return e=e.split(_wrs_xmlCharacters.tagOpener).join(_wrs_safeXmlCharacters.tagOpener),e=e.split(_wrs_xmlCharacters.tagCloser).join(_wrs_safeXmlCharacters.tagCloser),e=e.split(_wrs_xmlCharacters.doubleQuote).join(_wrs_safeXmlCharacters.doubleQuote),e=e.split(_wrs_xmlCharacters.ampersand).join(_wrs_safeXmlCharacters.ampersand),e=e.split(_wrs_xmlCharacters.quote).join(_wrs_safeXmlCharacters.quote)}function wrs_mathmlEntities(e){for(var t="",r=0;r<e.length;++r)t+=e.charCodeAt(r)>128?"&#"+e.charCodeAt(r)+";":e.charAt(r);return t}function wrs_mathmlToAccessible(e,t){var r={service:"mathml2accessible",mml:e};return t&&(r.lang=t),wrs_getContent(_wrs_conf_servicePath,r)}function wrs_mathmlToIframeObject(e,t){function r(){function a(){e._wrs_viewer.isReady()?(n.style.height=s.style.height,n.style.width=s.style.width,n.style.verticalAlign=s.style.verticalAlign):setTimeout(a,100)}e.com&&e.com.wiris?("_wrs_viewer"in e||(e._wrs_viewer=new e.com.wiris.jsEditor.JsViewerMain(_wrs_conf_pluginBasePath+"/integration/editor"),e._wrs_viewer.insertCSS(null,e.document)),e._wrs_viewer.paintFormulaOnContainer(t,s,null),a()):setTimeout(r,100)}if(-1!=window.navigator.userAgent.toLowerCase().indexOf("webkit")){var n=e.document.createElement("span");n.className=_wrs_conf_imageClassName,n.setAttribute(_wrs_conf_imageMathmlAttribute,t),n.setAttribute("height","1"),n.setAttribute("width","1"),n.style.display="inline-block",n.style.cursor="pointer",n.style.webkitUserModify="read-only",n.style.webkitUserSelect="all";var s=e.document.createElement("span");if(s.style.display="inline",n.appendChild(s),!("_wrs_viewerAppended"in e)){var a=e.document.createElement("script");a.src=_wrs_conf_pluginBasePath+"/integration/editor/viewer.js",e.document.getElementsByTagName("head")[0].appendChild(a),e._wrs_viewerAppended=!0}return r(),n}e.document.wrs_assignIframeEvents=function(e){wrs_addEvent(e.contentWindow.document,"click",function(){wrs_fireEvent(e,"dblclick")})};var i=e.document.createElement("iframe");return i.className=_wrs_conf_imageClassName,i.setAttribute(_wrs_conf_imageMathmlAttribute,t),i.style.display="inline",i.style.border="none",i.setAttribute("height","1"),i.setAttribute("width","1"),i.setAttribute("scrolling","no"),i.setAttribute("frameBorder","0"),i.src=_wrs_conf_pluginBasePath+"/core/iframe.html#"+_wrs_conf_imageMathmlAttribute,i}function wrs_mathmlToImgObject(e,t,r,n){var s=e.createElement("img");s.align="middle",window._wrs_conf_enableAccessibility&&_wrs_conf_enableAccessibility&&(s.alt=wrs_mathmlToAccessible(t,n)),s.className=_wrs_conf_imageClassName;var a=wrs_createImageSrc(t,r);if(window._wrs_conf_useDigestInsteadOfMathml&&_wrs_conf_useDigestInsteadOfMathml){var i=a.split(":",2);s.setAttribute(_wrs_conf_imageMathmlAttribute,i[0]),s.src=i[1]}else s.setAttribute(_wrs_conf_imageMathmlAttribute,wrs_mathmlEncode(t)),s.src=a;return s}function wrs_openCASWindow(e,t,r){if(void 0===t&&(t=!0),_wrs_temporalRange=null,e){var n=wrs_getSelectedItem(e,t);null!=n&&void 0===n.caretPosition&&"IMG"==n.node.nodeName.toUpperCase()&&n.node.className==_wrs_conf_CASClassName&&(_wrs_temporalImage=n.node,_wrs_isNewElement=!1)}var s=_wrs_conf_CASPath;return r&&(s+="?lang="+r),window.open(s,"WIRISCAS",_wrs_conf_CASAttributes)}function wrs_openEditorWindow(e,t,r){var n=navigator.userAgent.toLowerCase(),s=n.indexOf("android")>-1;if(s){var a=t.contentWindow.getSelection();_wrs_androidRange=a.getRangeAt(0)}void 0===r&&(r=!0);var i=_wrs_conf_editorPath;e&&(i+="?lang="+e);var o=new Array("rtl","ltr");if("undefined"!=typeof _wrs_int_directionality&&-1!=wrs_arrayContains(o,_wrs_int_directionality)&&(i+="&dir="+_wrs_int_directionality),_wrs_editMode=window._wrs_conf_defaultEditMode?_wrs_conf_defaultEditMode:"images",_wrs_temporalRange=null,t){var l=wrs_getSelectedItem(t,r);if(null!=l)if(void 0===l.caretPosition)l.node.className==_wrs_conf_imageClassName&&("IMG"==l.node.nodeName.toUpperCase()?_wrs_editMode="images":"IFRAME"==l.node.nodeName.toUpperCase()&&(_wrs_editMode="iframes"),_wrs_temporalImage=l.node,_wrs_isNewElement=!1);else{var c=wrs_getLatexFromTextNode(l.node,l.caretPosition);if(null!=c){_wrs_editMode="latex";var _=wrs_getMathMLFromLatex(c.latex);_wrs_isNewElement=!1,_wrs_temporalImage=document.createElement("img"),_wrs_temporalImage.setAttribute(_wrs_conf_imageMathmlAttribute,wrs_mathmlEncode(_));var d=r?t.contentWindow:window;if(document.selection){for(var m=0,u=c.startNode.previousSibling;u;)m+=wrs_getNodeLength(u),u=u.previousSibling;_wrs_temporalRange=d.document.selection.createRange(),_wrs_temporalRange.moveToElementText(c.startNode.parentNode),_wrs_temporalRange.move("character",m+c.startPosition),_wrs_temporalRange.moveEnd("character",c.latex.length+4)}else _wrs_temporalRange=d.document.createRange(),_wrs_temporalRange.setStart(c.startNode,c.startPosition),_wrs_temporalRange.setEnd(c.endNode,c.endPosition)}}}return window.open(i,"WIRISeditor",_wrs_conf_editorAttributes)}function wrs_parseMathmlToLatex(e,t){for(var r,n,s,a="",i=t.tagOpener+"math",o=t.tagOpener+"/math"+t.tagCloser,l=t.tagOpener+"annotation encoding="+t.doubleQuote+"LaTeX"+t.doubleQuote+t.tagCloser,c=t.tagOpener+"/annotation"+t.tagCloser,_=e.indexOf(i),d=0;-1!=_;)a+=e.substring(d,_),d=e.indexOf(o,_),-1==d?d=e.length-1:d+=o.length,r=e.substring(_,d),n=r.indexOf(l),-1!=n?(n+=l.length,s=r.indexOf(c),a+="$$"+r.substring(n,s)+"$$"):a+=r,_=e.indexOf(i,d);return a+=e.substring(d,e.length)}function wrs_parseMathmlToImg(e,t,r){for(var n="",s=t.tagOpener+"math",a=t.tagOpener+"/math"+t.tagCloser,i=e.indexOf(s),o=0;-1!=i;){if(n+=e.substring(o,i),o=e.indexOf(a,i),-1==o?o=e.length-1:o+=a.length,wrs_isMathmlInAttribute(e,i))n+=e.substring(i,o);else{var l=e.substring(i,o);l=t==_wrs_safeXmlCharacters?wrs_mathmlDecode(l):wrs_mathmlEntities(l),n+=wrs_createObjectCode(wrs_mathmlToImgObject(document,l,null,r))}i=e.indexOf(s,o)}return n+=e.substring(o,e.length)}function wrs_parseSafeAppletsToObjects(e){for(var t,r="",n=_wrs_safeXmlCharacters.tagOpener+"APPLET",s=_wrs_safeXmlCharacters.tagOpener+"/APPLET"+_wrs_safeXmlCharacters.tagCloser,a=e.toUpperCase(),i=a.indexOf(n),o=0;-1!=i;)r+=e.substring(o,i),o=a.indexOf(s,i),-1==o?o=e.length-1:o+=s.length,t=wrs_convertOldXmlinitialtextAttribute(e.substring(i,o)),r+=wrs_mathmlDecode(t),i=a.indexOf(n,o);return r+=e.substring(o,e.length)}function wrs_removeEvent(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent&&e.detachEvent("on"+t,r)}function wrs_splitBody(e){var t="",r="",n=e.indexOf("<body");if(-1!=n&&(n=e.indexOf(">",n),-1!=n)){++n;var s=e.indexOf("</body>",n);-1==s&&(s=e.length),t=e.substring(0,n),r=e.substring(s,e.length),e=e.substring(n,s)}return{prefix:t,code:e,sufix:r}}function wrs_updateCAS(e,t,r,n,s,a){var i=wrs_appletCodeToImgObject(t.document,r,n,s,a);wrs_insertElementOnSelection(i,e,t)}function wrs_updateFormula(e,t,r,n,s,a){if("latex"==s){var i=wrs_getLatexFromMathML(r),o=t.document.createTextNode("$$"+i+"$$");wrs_insertElementOnSelection(o,e,t)}else if("iframes"==s){var l=wrs_mathmlToIframeObject(t,r);wrs_insertElementOnSelection(l,e,t)}else{var c=wrs_mathmlToImgObject(t.document,r,n,a);wrs_insertElementOnSelection(c,e,t)}}function wrs_updateTextarea(e,t){if(e&&t)if(e.focus(),null!=e.selectionStart)e.value=e.value.substring(0,e.selectionStart)+t+e.value.substring(e.selectionEnd,e.value.length);else{var r=document.selection.createRange();r.text=t}}function wrs_urldecode(e){return decodeURIComponent(e)}function wrs_urlencode(e){var t="";return t=encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/~/g,"%7E")}var _wrs_currentPath=window.location.toString().substr(0,window.location.toString().lastIndexOf("/")+1),_wrs_editMode,_wrs_isNewElement=!0,_wrs_temporalImage,_wrs_temporalFocusElement,_wrs_androidRange,_wrs_xmlCharacters={tagOpener:"<",tagCloser:">",doubleQuote:'"',ampersand:"&",quote:"'"},_wrs_safeXmlCharacters={tagOpener:"\xab",tagCloser:"\xbb",doubleQuote:"\xa8",ampersand:"\xa7",quote:"`",realDoubleQuote:"\xa8"},_wrs_safeXmlCharactersEntities={tagOpener:"&laquo;",tagCloser:"&raquo;",doubleQuote:"&uml;",realDoubleQuote:"&quot;"},_wrs_safeBadBlackboardCharacters={ltElement:"\xabmo\xbb<\xab/mo\xbb",gtElement:"\xabmo\xbb>\xab/mo\xbb",ampElement:"\xabmo\xbb&\xab/mo\xbb"},_wrs_safeGoodBlackboardCharacters={ltElement:"\xabmo\xbb\xa7lt;\xab/mo\xbb",gtElement:"\xabmo\xbb\xa7gt;\xab/mo\xbb",ampElement:"\xabmo\xbb\xa7amp;\xab/mo\xbb"},_wrs_staticNodeLengths={IMG:1,BR:1};window._wrs_conf_imageClassName||(_wrs_conf_imageClassName="Wirisformula"),window._wrs_conf_CASClassName||(_wrs_conf_CASClassName="Wiriscas");